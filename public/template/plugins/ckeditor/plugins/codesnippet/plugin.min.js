(function(){function a(d){CKEDITOR.tools.extend(this,d);this.queue=[];this.init?this.init(CKEDITOR.tools.bind(function(){for(var e;e=this.queue.pop();){e.call(this)}this.ready=!0},this)):this.ready=!0}function b(f){var d=f.config.codeSnippet_codeClass,j=/\r?\n/g,g=new CKEDITOR.dom.element("textarea");f.widgets.add("codeSnippet",{allowedContent:"pre; code(language-*)",requiredContent:"pre",styleableElements:"pre",template:'\x3cpre\x3e\x3ccode class\x3d"'+d+'"\x3e\x3c/code\x3e\x3c/pre\x3e',dialog:"codeSnippet",pathName:f.lang.codesnippet.pathName,mask:!0,parts:{pre:"pre",code:"code"},highlight:function(){var h=this,k=this.data,e=function(l){h.parts.code.setHtml(c?l:l.replace(j,"\x3cbr\x3e"))};e(CKEDITOR.tools.htmlEncode(k.code));f._.codesnippet.highlighter.highlight(k.code,k.lang,function(l){f.fire("lockSnapshot");e(l);f.fire("unlockSnapshot")})},data:function(){var h=this.data,e=this.oldData;h.code&&this.parts.code.setHtml(CKEDITOR.tools.htmlEncode(h.code));e&&h.lang!=e.lang&&this.parts.code.removeClass("language-"+e.lang);h.lang&&(this.parts.code.addClass("language-"+h.lang),this.highlight());this.oldData=CKEDITOR.tools.copy(h)},upcast:function(q,r){if("pre"==q.name){for(var n=[],p=q.children,m,h=p.length-1;0<=h;h--){m=p[h],m.type==CKEDITOR.NODE_TEXT&&m.value.match(i)||n.push(m)}var o;if(1==n.length&&"code"==(o=n[0]).name&&1==o.children.length&&o.children[0].type==CKEDITOR.NODE_TEXT){if(n=f._.codesnippet.langsRegex.exec(o.attributes["class"])){r.lang=n[1]}g.setHtml(o.getHtml());r.code=g.getValue();o.addClass(d);return q}}},downcast:function(e){var h=e.getFirst("code");h.children.length=0;h.removeClass(d);h.add(new CKEDITOR.htmlParser.text(CKEDITOR.tools.htmlEncode(this.data.code)));return e}});var i=/^[\s\n\r]*$/}var c=!CKEDITOR.env.ie||8<CKEDITOR.env.version;CKEDITOR.plugins.add("codesnippet",{requires:"widget,dialog",lang:"ar,bg,ca,cs,da,de,de-ch,el,en,en-gb,eo,es,et,eu,fa,fi,fr,fr-ca,gl,he,hr,hu,id,it,ja,km,ko,ku,lt,lv,nb,nl,no,pl,pt,pt-br,ro,ru,sk,sl,sq,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"codesnippet",hidpi:!0,beforeInit:function(d){d._.codesnippet={};this.setHighlighter=function(e){d._.codesnippet.highlighter=e;e=d._.codesnippet.langs=d.config.codeSnippet_languages||e.languages;d._.codesnippet.langsRegex=new RegExp("(?:^|\\s)language-("+CKEDITOR.tools.objectKeys(e).join("|")+")(?:\\s|$)")}},onLoad:function(){CKEDITOR.dialog.add("codeSnippet",this.path+"dialogs/codesnippet.js")},init:function(d){d.ui.addButton&&d.ui.addButton("CodeSnippet",{label:d.lang.codesnippet.button,command:"codeSnippet",toolbar:"insert,10"})},afterInit:function(f){var d=this.path;b(f);if(!f._.codesnippet.highlighter){var g=new CKEDITOR.plugins.codesnippet.highlighter({languages:{apache:"Apache",bash:"Bash",coffeescript:"CoffeeScript",cpp:"C++",cs:"C#",css:"CSS",diff:"Diff",html:"HTML",http:"HTTP",ini:"INI",java:"Java",javascript:"JavaScript",json:"JSON",makefile:"Makefile",markdown:"Markdown",nginx:"Nginx",objectivec:"Objective-C",perl:"Perl",php:"PHP",python:"Python",ruby:"Ruby",sql:"SQL",vbscript:"VBScript",xhtml:"XHTML",xml:"XML"},init:function(i){var j=this;c&&CKEDITOR.scriptLoader.load(d+"lib/highlight/highlight.pack.js",function(){j.hljs=window.hljs;i()});f.addContentsCss&&f.addContentsCss(d+"lib/highlight/styles/"+f.config.codeSnippet_theme+".css")},highlighter:function(h,e,i){(h=this.hljs.highlightAuto(h,this.hljs.getLanguage(e)?[e]:void 0))&&i(h.value)}});this.setHighlighter(g)}}});CKEDITOR.plugins.codesnippet={highlighter:a};a.prototype.highlight=function(){var d=arguments;this.ready?this.highlighter.apply(this,d):this.queue.push(function(){this.highlighter.apply(this,d)})}})();CKEDITOR.config.codeSnippet_codeClass="hljs";CKEDITOR.config.codeSnippet_theme="default";