CKEDITOR.plugins.add("iframedialog",{requires:"dialog",onLoad:function(){CKEDITOR.dialog.addIframe=function(p,q,r,c,o,b,m){r={type:"iframe",src:r,width:"100%",height:"100%"};r.onContentLoad="function"==typeof b?b:function(){var e=this.getElement().$.contentWindow;if(e.onDialogEvent){var d=this.getDialog(),f=function(a){return e.onDialogEvent(a)};d.on("ok",f);d.on("cancel",f);d.on("resize",f);d.on("hide",function(g){d.removeListener("ok",f);d.removeListener("cancel",f);d.removeListener("resize",f);g.removeListener()});e.onDialogEvent({name:"load",sender:this,editor:d._.editor})}};var j={title:q,minWidth:c,minHeight:o,contents:[{id:"iframe",label:q,expand:!0,elements:[r],style:"width:"+r.width+";height:"+r.height}]},i;for(i in m){j[i]=m[i]}this.add(p,function(){return j})};(function(){var a=function(q,r,c){if(!(3>arguments.length)){var o=this._||(this._={}),p=r.onContentLoad&&CKEDITOR.tools.bind(r.onContentLoad,this),n=CKEDITOR.tools.cssLength(r.width),j=CKEDITOR.tools.cssLength(r.height);o.frameId=CKEDITOR.tools.getNextId()+"_iframe";q.on("load",function(){CKEDITOR.document.getById(o.frameId).getParent().setStyles({width:n,height:j})});var i={src:"%2",id:o.frameId,frameborder:0,allowtransparency:!0},b=[];"function"==typeof r.onContentLoad&&(i.onload="CKEDITOR.tools.callFunction(%1);");CKEDITOR.ui.dialog.uiElement.call(this,q,r,b,"iframe",{width:n,height:j},i,"");c.push('\x3cdiv style\x3d"width:'+n+";height:"+j+';" id\x3d"'+this.domId+'"\x3e\x3c/div\x3e');b=b.join("");q.on("show",function(){var d=CKEDITOR.document.getById(o.frameId).getParent(),e=CKEDITOR.tools.addFunction(p),e=b.replace("%1",e).replace("%2",CKEDITOR.tools.htmlEncode(r.src));d.setHtml(e)})}};a.prototype=new CKEDITOR.ui.dialog.uiElement;CKEDITOR.dialog.addUIElement("iframe",{build:function(e,c,b){return new a(e,c,b)}})})()}});