(function(){function aA(g){this.editor=g;this.registered={};this.instances={};this.selected=[];this.widgetHoldingFocusedEditable=this.focused=null;this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}};ah(this);ag(this);this.on("checkWidgets",af);this.editor.on("contentDomInvalidated",this.checkWidgets,this);ae(this);ad(this);ac(this);ab(this);s(this)}function aC(n,g,t,r,q){var p=n.editor;CKEDITOR.tools.extend(this,r,{editor:p,id:g,inline:"span"==t.getParent().getName(),element:t,data:CKEDITOR.tools.extend({},"function"==typeof r.defaults?r.defaults():r.defaults),dataReady:!1,inited:!1,ready:!1,edit:aC.prototype.edit,focusedEditable:null,definition:r,repository:n,draggable:!1!==r.draggable,_:{downcastFn:r.downcast&&"string"==typeof r.downcast?r.downcasts[r.downcast]:r.downcast}},!0);n.fire("instanceCreated",this);o(this,r);this.init&&this.init();this.inited=!0;(n=this.element.data("cke-widget-data"))&&this.setData(JSON.parse(decodeURIComponent(n)));q&&this.setData(q);this.data.classes||this.setData("classes",this.getClasses());this.dataReady=!0;ay(this);this.fire("data",this.data);this.isInited()&&p.editable().contains(this.wrapper)&&(this.ready=!0,this.fire("ready"))}function az(n,g,p){CKEDITOR.dom.element.call(this,g.$);this.editor=n;this._={};g=this.filter=p.filter;CKEDITOR.dtd[this.getName()].p?(this.enterMode=g?g.getAllowedEnterMode(n.enterMode):n.enterMode,this.shiftEnterMode=g?g.getAllowedEnterMode(n.shiftEnterMode,!0):n.shiftEnterMode):this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}function m(n,g){n.addCommand(g.name,{exec:function(q,w){function v(){q.widgets.finalizeCreation(r)}var u=q.widgets.focused;if(u&&u.name==g.name){u.edit()}else{if(g.insert){g.insert()}else{if(g.template){var u="function"==typeof g.defaults?g.defaults():g.defaults,u=CKEDITOR.dom.element.createFromHtml(g.template.output(u)),t,p=q.widgets.wrapElement(u,g.name),r=new CKEDITOR.dom.documentFragment(p.getDocument());r.append(p);(t=q.widgets.initOn(u,g,w&&w.startupData))?(u=t.once("edit",function(x){if(x.data.dialog){t.once("dialog",function(y){y=y.data;var A,z;A=y.once("ok",v,null,null,20);z=y.once("cancel",function(B){B.data&&!1===B.data.hide||q.widgets.destroy(t,!0)});y.once("hide",function(){A.removeListener();z.removeListener()})})}else{v()}},null,null,999),t.edit(),u.removeListener()):v()}}}},allowedContent:g.allowedContent,requiredContent:g.requiredContent,contentForms:g.contentForms,contentTransformations:g.contentTransformations})}function l(n,g){function r(w,t,v){var u=CKEDITOR.tools.getIndex(n._.upcasts,function(x){return x[2]>v});0>u&&(u=n._.upcasts.length);n._.upcasts.splice(u,0,[w,t,v])}var q=g.upcast,p=g.upcastPriority||10;if(q){if("string"==typeof q){for(q=q.split(",");q.length;){r(g.upcasts[q.pop()],g.name,p)}}else{r(q,g.name,p)}}}function ax(n,g){n.focused=null;if(g.isInited()){var p=g.editor.checkDirty();n.fire("widgetBlurred",{widget:g});g.setFocused(!1);!p&&g.editor.resetDirty()}}function af(w){w=w.data;if("wysiwyg"==this.editor.mode){var v=this.editor.editable(),u=this.instances,t,r,q,p;if(v){for(t in u){u[t].isReady()&&!v.contains(u[t].wrapper)&&this.destroy(u[t],!0)}if(w&&w.initOnlyNew){u=this.initOnAll()}else{var g=v.find(".cke_widget_wrapper"),u=[];t=0;for(r=g.count();t<r;t++){q=g.getItem(t);if(p=!this.getByElement(q,!0)){w:{p=k;for(var n=q;n=n.getParent();){if(p(n)){p=!0;break w}}p=!1}p=!p}p&&v.contains(q)&&(q.addClass("cke_widget_new"),u.push(this.initOn(q.getFirst(aC.isDomWidgetElement))))}}w&&w.focusInited&&1==u.length&&u[0].focus()}}}function aw(n,g,q){if(!q.allowedContent){return null}var p=this._.filters[n];p||(this._.filters[n]=p={});(n=p[g])||(p[g]=n=new CKEDITOR.filter(q.allowedContent));return n}function j(n){var g=[],q=n._.upcasts,p=n._.upcastCallbacks;return{toBeWrapped:g,iterator:function(u){var x,w,t,v,r;if("data-cke-widget-wrapper" in u.attributes){return(u=u.getFirst(aC.isParserWidgetElement))&&g.push([u]),!1}if("data-widget" in u.attributes){return g.push([u]),!1}if(r=q.length){if(u.attributes["data-cke-widget-upcasted"]){return !1}v=0;for(x=p.length;v<x;++v){if(!1===p[v](u)){return}}for(v=0;v<r;++v){if(x=q[v],t={},w=x[0](u,t)){return w instanceof CKEDITOR.htmlParser.element&&(u=w),u.attributes["data-cke-widget-data"]=encodeURIComponent(JSON.stringify(t)),u.attributes["data-cke-widget-upcasted"]=1,g.push([u,x[1]]),!1}}}}}}function av(g){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off","class":"cke_widget_wrapper cke_widget_new cke_widget_"+(g?"inline":"block")}}function au(n,g,r){if(n.type==CKEDITOR.NODE_ELEMENT){var q=CKEDITOR.dtd[n.name];if(q&&!q[r.name]){var q=n.split(g),p=n.parent;g=q.getIndex();n.children.length||(--g,n.remove());q.children.length||q.remove();return au(p,g,r)}}n.add(r,g)}function at(n,g){return"boolean"==typeof n.inline?n.inline:!!CKEDITOR.dtd.$inline[g]}function k(g){return g.hasAttribute("data-cke-temp")}function aB(n,g,r,q){var p=n.editor;p.fire("lockSnapshot");r?(q=r.data("cke-widget-editable"),q=g.editables[q],n.widgetHoldingFocusedEditable=g,g.focusedEditable=q,r.addClass("cke_widget_editable_focused"),q.filter&&p.setActiveFilter(q.filter),p.setActiveEnterMode(q.enterMode,q.shiftEnterMode)):(q||g.focusedEditable.removeClass("cke_widget_editable_focused"),g.focusedEditable=null,n.widgetHoldingFocusedEditable=null,p.setActiveFilter(null),p.setActiveEnterMode(null,null));p.fire("unlockSnapshot")}function i(g){g.contextMenu&&g.contextMenu.addListener(function(n){if(n=g.widgets.getByElement(n,!0)){return n.fire("contextMenu",{})}})}function h(n,g){return CKEDITOR.tools.trim(g)}function ab(n){var g=n.editor,p=CKEDITOR.plugins.lineutils;g.on("dragstart",function(r){var q=r.data.target;aC.isDomDragHandler(q)&&(q=n.getByElement(q),r.data.dataTransfer.setData("cke/widget-id",q.id),g.focus(),q.focus())});g.on("drop",function(u){var t=u.data.dataTransfer,r=t.getData("cke/widget-id"),q=t.getTransferType(g),t=g.createRange();""!==r&&q===CKEDITOR.DATA_TRANSFER_CROSS_EDITORS?u.cancel():""!==r&&q==CKEDITOR.DATA_TRANSFER_INTERNAL&&(r=n.instances[r])&&(t.setStartBefore(r.wrapper),t.setEndAfter(r.wrapper),u.data.dragRange=t,delete CKEDITOR.plugins.clipboard.dragStartContainerChildCount,delete CKEDITOR.plugins.clipboard.dragEndContainerChildCount,u.data.dataTransfer.setData("text/html",g.editable().getHtmlFromRange(t).getHtml()),g.widgets.destroy(r,!0))});g.on("contentDom",function(){var q=g.editable();CKEDITOR.tools.extend(n,{finder:new p.finder(g,{lookups:{"default":function(t){if(!t.is(CKEDITOR.dtd.$listItem)&&t.is(CKEDITOR.dtd.$block)&&!aC.isDomNestedEditable(t)&&!n._.draggedWidget.wrapper.contains(t)){var r=aC.getNestedEditable(q,t);if(r){t=n._.draggedWidget;if(n.getByElement(r)==t){return}r=CKEDITOR.filter.instances[r.data("cke-filter")];t=t.requiredContent;if(r&&t&&!r.check(t)){return}}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}}),locator:new p.locator(g),liner:new p.liner(g,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},!0)})}function ad(n){var g=n.editor;g.on("contentDom",function(){var t=g.editable(),r=t.isInline()?t:g.document,q,p;t.attachListener(r,"mousedown",function(v){var u=v.data.getTarget();if(!u.type){return !1}q=n.getByElement(u);p=0;q&&(q.inline&&u.type==CKEDITOR.NODE_ELEMENT&&u.hasAttribute("data-cke-widget-drag-handler")?(p=1,n.focused!=q&&g.getSelection().removeAllRanges()):aC.getNestedEditable(q.wrapper,u)?q=null:(v.data.preventDefault(),CKEDITOR.env.ie||q.focus()))});t.attachListener(r,"mouseup",function(){p&&q&&q.wrapper&&(p=0,q.focus())});CKEDITOR.env.ie&&t.attachListener(r,"mouseup",function(){setTimeout(function(){q&&q.wrapper&&t.contains(q.wrapper)&&(q.focus(),q=null)})})});g.on("doubleclick",function(q){var p=n.getByElement(q.data.element);if(p&&!aC.getNestedEditable(p.wrapper,q.data.element)){return p.fire("doubleclick",{element:q.data.element})}},null,null,1)}function ac(g){g.editor.on("key",function(n){var r=g.focused,q=g.widgetHoldingFocusedEditable,p;r?p=r.fire("key",{keyCode:n.data.keyCode}):q&&(r=n.data.keyCode,n=q.focusedEditable,r==CKEDITOR.CTRL+65?(r=n.getBogus(),q=q.editor.createRange(),q.selectNodeContents(n),r&&q.setEndAt(r,CKEDITOR.POSITION_BEFORE_START),q.select(),p=!1):8==r||46==r?(p=q.editor.getSelection().getRanges(),q=p[0],p=!(1==p.length&&q.collapsed&&q.checkBoundaryOfElement(n,CKEDITOR[8==r?"START":"END"]))):p=void 0);return p},null,null,1)}function s(n){function g(q){n.focused&&ar(n.focused,"cut"==q.name)}var p=n.editor;p.on("contentDom",function(){var q=p.editable();q.attachListener(q,"copy",g);q.attachListener(q,"cut",g)})}function ae(n){var g=n.editor;g.on("selectionCheck",function(){n.fire("checkSelection")});n.on("checkSelection",n.checkSelection,n);g.on("selectionChange",function(r){var q=(r=aC.getNestedEditable(g.editable(),r.data.selection.getStartElement()))&&n.getByElement(r),p=n.widgetHoldingFocusedEditable;p?p===q&&p.focusedEditable.equals(r)||(aB(n,p,null),q&&r&&aB(n,q,r)):q&&r&&aB(n,q,r)});g.on("dataReady",function(){aq(n).commit()});g.on("blur",function(){var p;(p=n.focused)&&ax(n,p);(p=n.widgetHoldingFocusedEditable)&&aB(n,p,null)})}function ag(n){var g=n.editor,p={};g.on("toDataFormat",function(q){var t=CKEDITOR.tools.getNextNumber(),r=[];q.data.downcastingSessionId=t;p[t]=r;q.data.dataValue.forEach(function(w){var u=w.attributes,v;if("data-cke-widget-id" in u){if(u=n.instances[u["data-cke-widget-id"]]){v=w.getFirst(aC.isParserWidgetElement),r.push({wrapper:w,element:v,widget:u,editables:{}}),"1"!=v.attributes["data-cke-widget-keep-attr"]&&delete v.attributes["data-widget"]}}else{if("data-cke-widget-editable" in u){return r[r.length-1].editables[u["data-cke-widget-editable"]]=w,!1}}},CKEDITOR.NODE_ELEMENT,!0)},null,null,8);g.on("toDataFormat",function(u){if(u.data.downcastingSessionId){u=p[u.data.downcastingSessionId];for(var r,x,v,t,w,q;r=u.shift();){x=r.widget;v=r.element;t=x._.downcastFn&&x._.downcastFn.call(x,v);for(q in r.editables){w=r.editables[q],delete w.attributes.contenteditable,w.setHtml(x.editables[q].getData())}t||(t=v);r.wrapper.replaceWith(t)}}},null,null,13);g.on("contentDomUnload",function(){n.destroyAll(!0)})}function ah(n){var g=n.editor,q,p;g.on("toHtml",function(r){var w=j(n),v;for(r.data.dataValue.forEach(w.iterator,CKEDITOR.NODE_ELEMENT,!0);v=w.toBeWrapped.pop();){var t=v[0],u=t.parent;u.type==CKEDITOR.NODE_ELEMENT&&u.attributes["data-cke-widget-wrapper"]&&u.replaceWith(t);n.wrapElement(v[0],v[1])}q=r.data.protectedWhitespaces?3==r.data.dataValue.children.length&&aC.isParserWidgetWrapper(r.data.dataValue.children[1]):1==r.data.dataValue.children.length&&aC.isParserWidgetWrapper(r.data.dataValue.children[0])},null,null,8);g.on("dataReady",function(){if(p){for(var w=g.editable().find(".cke_widget_wrapper"),v,u,r=0,t=w.count();r<t;++r){v=w.getItem(r),u=v.getFirst(aC.isDomWidgetElement),u.type==CKEDITOR.NODE_ELEMENT&&u.data("widget")?(u.replace(v),n.wrapElement(u)):v.remove()}}p=0;n.destroyAll(!0);n.initOnAll()});g.on("loadSnapshot",function(r){/data-cke-widget/.test(r.data)&&(p=1);n.destroyAll(!0)},null,null,9);g.on("paste",function(r){r=r.data;r.dataValue=r.dataValue.replace(f,h);r.range&&(r=aC.getNestedEditable(g.editable(),r.range.startContainer))&&(r=CKEDITOR.filter.instances[r.data("cke-filter")])&&g.setActiveFilter(r)});g.on("afterInsertHtml",function(r){r.data.intoRange?n.checkWidgets({initOnlyNew:!0}):(g.fire("lockSnapshot"),n.checkWidgets({initOnlyNew:!0,focusInited:q}),g.fire("unlockSnapshot"))})}function aq(n){var g=n.selected,r=[],q=g.slice(0),p=null;return{select:function(t){0>CKEDITOR.tools.indexOf(g,t)&&r.push(t);t=CKEDITOR.tools.indexOf(q,t);0<=t&&q.splice(t,1);return this},focus:function(t){p=t;return this},commit:function(){var v=n.focused!==p,t,u;n.editor.fire("lockSnapshot");for(v&&(t=n.focused)&&ax(n,t);t=q.pop();){g.splice(CKEDITOR.tools.indexOf(g,t),1),t.isInited()&&(u=t.editor.checkDirty(),t.setSelected(!1),!u&&t.editor.resetDirty())}v&&p&&(u=n.editor.checkDirty(),n.focused=p,n.fire("widgetFocused",{widget:p}),p.setFocused(!0),!u&&n.editor.resetDirty());for(;t=r.pop();){g.push(t),t.setSelected(!0)}n.editor.fire("unlockSnapshot")}}}function am(n,g,t){var r=0;g=al(g);var q=n.data.classes||{},p;if(g){for(q=CKEDITOR.tools.clone(q);p=g.pop();){t?q[p]||(r=q[p]=1):q[p]&&(delete q[p],r=1)}r&&n.setData("classes",q)}}function ak(g){g.cancel()}function ar(C,B){var A=C.editor,z=A.document;if(!z.getById("cke_copybin")){var y=A.blockless||CKEDITOR.env.ie?"span":"div",x=z.createElement(y),v=z.createElement(y),y=CKEDITOR.env.ie&&9>CKEDITOR.env.version;v.setAttributes({id:"cke_copybin","data-cke-temp":"1"});x.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"});x.setStyle("ltr"==A.config.contentsLangDirection?"left":"right","-5000px");var w=A.createRange();w.setStartBefore(C.wrapper);w.setEndAfter(C.wrapper);x.setHtml('\x3cspan data-cke-copybin-start\x3d"1"\x3e\x3c/span\x3e'+A.editable().getHtmlFromRange(w).getHtml()+'\x3cspan data-cke-copybin-end\x3d"1"\x3e\x3c/span\x3e');A.fire("saveSnapshot");A.fire("lockSnapshot");v.append(x);A.editable().append(v);var u=A.on("selectionChange",ak,null,null,0),t=C.repository.on("checkSelection",ak,null,null,0);if(y){var r=z.getDocumentElement().$,q=r.scrollTop}w=A.createRange();w.selectNodeContents(x);w.select();y&&(r.scrollTop=q);setTimeout(function(){B||C.focus();v.remove();u.removeListener();t.removeListener();A.fire("unlockSnapshot");B&&(C.repository.del(C),A.fire("saveSnapshot"))},100)}}function al(g){return(g=(g=g.getDefinition().attributes)&&g["class"])?g.split(/\s+/):null}function aj(){var n=CKEDITOR.document.getActive(),g=this.editor,p=g.editable();(p.isInline()?p:g.document.getWindow().getFrame()).equals(n)&&g.focusManager.focus(p)}function ai(){CKEDITOR.env.gecko&&this.editor.unlockSelection();CKEDITOR.env.webkit||(this.editor.forceNextSelectionCheck(),this.editor.selectionChange(1))}function e(n){var g=null;n.on("data",function(){var p=this.data.classes,q;if(g!=p){for(q in g){p&&p[q]||this.removeClass(q)}for(q in p){this.addClass(q)}g=p}})}function d(g){g.on("data",function(){if(g.wrapper){var n=this.getLabel?this.getLabel():this.editor.lang.widget.label.replace(/%1/,this.pathName||this.element.getName());g.wrapper.setAttribute("role","region");g.wrapper.setAttribute("aria-label",n)}},null,null,9999)}function c(n){if(n.draggable){var g=n.editor,q=n.wrapper.getLast(aC.isDomDragHandlerContainer),p;q?p=q.findOne("img"):(q=new CKEDITOR.dom.element("span",g.document),q.setAttributes({"class":"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+g.plugins.widget.path+"images/handle.png)"}),p=new CKEDITOR.dom.element("img",g.document),p.setAttributes({"class":"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:CKEDITOR.tools.transparentImageData,width:15,title:g.lang.widget.move,height:15,role:"presentation"}),n.inline&&p.setAttribute("draggable","true"),q.append(p),n.wrapper.append(q));n.wrapper.on("dragover",function(r){r.data.preventDefault()});n.wrapper.on("mouseenter",n.updateDragHandlerPosition,n);setTimeout(function(){n.on("data",n.updateDragHandlerPosition,n)},50);if(!n.inline&&(p.on("mousedown",b,n),CKEDITOR.env.ie&&9>CKEDITOR.env.version)){p.on("dragstart",function(r){r.data.preventDefault(!0)})}n.dragHandlerContainer=q}}function b(E){function D(){var g;for(r.reset();g=y.pop();){g.removeListener()}var G=w;g=E.sender;var F=this.repository.finder,q=this.repository.liner,p=this.editor,n=this.editor.editable();CKEDITOR.tools.isEmpty(q.visible)||(G=F.getRange(G[0]),this.focus(),p.fire("drop",{dropRange:G,target:G.startContainer}));n.removeClass("cke_widget_dragging");q.hideVisible();p.fire("dragend",{target:g})}var C=this.repository.finder,B=this.repository.locator,A=this.repository.liner,z=this.editor,x=z.editable(),y=[],w=[],v,u;this.repository._.draggedWidget=this;var t=C.greedySearch(),r=CKEDITOR.tools.eventsBuffer(50,function(){v=B.locate(t);w=B.sort(u,1);w.length&&(A.prepare(t,v),A.placeLine(w[0]),A.cleanup())});x.addClass("cke_widget_dragging");y.push(x.on("mousemove",function(g){u=g.data.$.clientY;r.input()}));z.fire("dragstart",{target:E.sender});y.push(z.document.once("mouseup",D,this));x.isInline()||y.push(CKEDITOR.document.once("mouseup",D,this))}function a(n){var g,q,p=n.editables;n.editables={};if(n.editables){for(g in p){q=p[g],n.initEditable(g,"string"==typeof q?{selector:q}:q)}}}function an(n){if(n.mask){var g=n.wrapper.findOne(".cke_widget_mask");g||(g=new CKEDITOR.dom.element("img",n.editor.document),g.setAttributes({src:CKEDITOR.tools.transparentImageData,"class":"cke_reset cke_widget_mask"}),n.wrapper.append(g));n.mask=g}}function aD(n){if(n.parts){var g={},q,p;for(p in n.parts){q=n.wrapper.findOne(n.parts[p]),g[p]=q}n.parts=g}}function o(n,g){ap(n);aD(n);a(n);an(n);c(n);e(n);d(n);if(CKEDITOR.env.ie&&9>CKEDITOR.env.version){n.wrapper.on("dragstart",function(p){var q=p.data.getTarget();aC.getNestedEditable(n,q)||n.inline&&aC.isDomDragHandler(q)||p.data.preventDefault()})}n.wrapper.removeClass("cke_widget_new");n.element.addClass("cke_widget_element");n.on("key",function(p){p=p.data.keyCode;if(13==p){n.edit()}else{if(p==CKEDITOR.CTRL+67||p==CKEDITOR.CTRL+88){ar(n,p==CKEDITOR.CTRL+88);return}if(p in ao||CKEDITOR.CTRL&p||CKEDITOR.ALT&p){return}}return !1},null,null,999);n.on("doubleclick",function(p){n.edit()&&p.cancel()});if(g.data){n.on("data",g.data)}if(g.edit){n.on("edit",g.edit)}}function ap(g){(g.wrapper=g.element.getParent()).setAttribute("data-cke-widget-id",g.id)}function ay(g){g.element.data("cke-widget-data",encodeURIComponent(JSON.stringify(g.data)))}CKEDITOR.plugins.add("widget",{lang:"af,ar,bg,ca,cs,cy,da,de,de-ch,el,en,en-gb,eo,es,eu,fa,fi,fr,gl,he,hr,hu,id,it,ja,km,ko,ku,lv,nb,nl,no,pl,pt,pt-br,ru,sk,sl,sq,sv,tr,tt,ug,uk,vi,zh,zh-cn",requires:"lineutils,clipboard",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover\x3e.cke_widget_element{outline:2px solid yellow;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid yellow}.cke_widget_wrapper.cke_widget_focused\x3e.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #ace}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:15px;height:0;display:none;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover\x3e.cke_widget_drag_handler_container{height:15px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:15px;height:15px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}")},beforeInit:function(g){g.widgets=new aA(g)},afterInit:function(n){var g=n.widgets.registered,r,q,p;for(q in g){r=g[q],(p=r.button)&&n.ui.addButton&&n.ui.addButton(CKEDITOR.tools.capitalize(r.name,!0),{label:p,command:r.name,toolbar:"insert,10"})}i(n)}});aA.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(n,g){g=CKEDITOR.tools.prototypedCopy(g);g.name=n;g._=g._||{};this.editor.fire("widgetDefinition",g);g.template&&(g.template=new CKEDITOR.template(g.template));m(this.editor,g);l(this,g);return this.registered[n]=g},addUpcastCallback:function(g){this._.upcastCallbacks.push(g)},checkSelection:function(){var n=this.editor.getSelection(),g=n.getSelectedElement(),q=aq(this),p;if(g&&(p=this.getByElement(g,!0))){return q.focus(p).select(p).commit()}n=n.getRanges()[0];if(!n||n.collapsed){return q.commit()}n=new CKEDITOR.dom.walker(n);for(n.evaluator=aC.isDomWidgetWrapper;g=n.next();){q.select(this.getByElement(g))}q.commit()},checkWidgets:function(g){this.fire("checkWidgets",CKEDITOR.tools.copy(g||{}))},del:function(n){if(this.focused===n){var g=n.editor,q=g.createRange(),p;(p=q.moveToClosestEditablePosition(n.wrapper,!0))||(p=q.moveToClosestEditablePosition(n.wrapper,!1));p&&g.getSelection().selectRanges([q])}n.wrapper.remove();this.destroy(n,!0)},destroy:function(n,g){this.widgetHoldingFocusedEditable===n&&aB(this,n,null,g);n.destroy(g);delete this.instances[n.id];this.fire("instanceDestroyed",n)},destroyAll:function(n,g){var t,r,q=this.instances;if(g&&!n){r=g.find(".cke_widget_wrapper");for(var q=r.count(),p=0;p<q;++p){(t=this.getByElement(r.getItem(p),!0))&&this.destroy(t)}}else{for(r in q){t=q[r],this.destroy(t,n)}}},finalizeCreation:function(g){(g=g.getFirst())&&aC.isDomWidgetWrapper(g)&&(this.editor.insertElement(g),g=this.getByElement(g),g.ready=!0,g.fire("ready"),g.focus())},getByElement:function(){function n(p){return p.is(g)&&p.data("cke-widget-id")}var g={div:1,span:1};return function(p,t){if(!p){return null}var r=n(p);if(!t&&!r){var q=this.editor.editable();do{p=p.getParent()}while(p&&!p.equals(q)&&!(r=n(p)))}return this.instances[r]||null}}(),initOn:function(n,g,q){g?"string"==typeof g&&(g=this.registered[g]):g=this.registered[n.data("widget")];if(!g){return null}var p=this.wrapElement(n,g.name);return p?p.hasClass("cke_widget_new")?(n=new aC(this,this._.nextId++,n,g,q),n.isInited()?this.instances[n.id]=n:null):this.getByElement(n):null},initOnAll:function(n){n=(n||this.editor.editable()).find(".cke_widget_new");for(var g=[],q,p=n.count();p--;){(q=this.initOn(n.getItem(p).getFirst(aC.isDomWidgetElement)))&&g.push(q)}return g},onWidget:function(n){var g=Array.prototype.slice.call(arguments);g.shift();for(var q in this.instances){var p=this.instances[q];p.name==n&&p.on.apply(p,g)}this.on("instanceCreated",function(r){r=r.data;r.name==n&&r.on.apply(r,g)})},parseElementClasses:function(n){if(!n){return null}n=CKEDITOR.tools.trim(n).split(/\s+/);for(var g,q={},p=0;g=n.pop();){-1==g.indexOf("cke_")&&(q[g]=p=1)}return p?q:null},wrapElement:function(n,g){var t=null,r,q;if(n instanceof CKEDITOR.dom.element){r=this.registered[g||n.data("widget")];if(!r){return null}if((t=n.getParent())&&t.type==CKEDITOR.NODE_ELEMENT&&t.data("cke-widget-wrapper")){return t}n.hasAttribute("data-cke-widget-keep-attr")||n.data("cke-widget-keep-attr",n.data("widget")?1:0);g&&n.data("widget",g);q=at(r,n.getName());t=new CKEDITOR.dom.element(q?"span":"div");t.setAttributes(av(q));t.data("cke-display-name",r.pathName?r.pathName:n.getName());n.getParent(!0)&&t.replace(n);n.appendTo(t)}else{if(n instanceof CKEDITOR.htmlParser.element){r=this.registered[g||n.attributes["data-widget"]];if(!r){return null}if((t=n.parent)&&t.type==CKEDITOR.NODE_ELEMENT&&t.attributes["data-cke-widget-wrapper"]){return t}"data-cke-widget-keep-attr" in n.attributes||(n.attributes["data-cke-widget-keep-attr"]=n.attributes["data-widget"]?1:0);g&&(n.attributes["data-widget"]=g);q=at(r,n.name);t=new CKEDITOR.htmlParser.element(q?"span":"div",av(q));t.attributes["data-cke-display-name"]=r.pathName?r.pathName:n.name;r=n.parent;var p;r&&(p=n.getIndex(),n.remove());t.add(n);r&&au(r,p,t)}}return t},_tests_createEditableFilter:aw};CKEDITOR.event.implementOn(aA.prototype);aC.prototype={addClass:function(g){this.element.addClass(g)},applyStyle:function(g){am(this,g,1)},checkStyleActive:function(n){n=al(n);var g;if(!n){return !1}for(;g=n.pop();){if(!this.hasClass(g)){return !1}}return !0},destroy:function(n){this.fire("destroy");if(this.editables){for(var g in this.editables){this.destroyEditable(g,n)}}n||("0"==this.element.data("cke-widget-keep-attr")&&this.element.removeAttribute("data-widget"),this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]),this.element.removeClass("cke_widget_element"),this.element.replace(this.wrapper));this.wrapper=null},destroyEditable:function(n,g){var p=this.editables[n];p.removeListener("focus",ai);p.removeListener("blur",aj);this.editor.focusManager.remove(p);g||(this.repository.destroyAll(!1,p),p.removeClass("cke_widget_editable"),p.removeClass("cke_widget_editable_focused"),p.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"]));delete this.editables[n]},edit:function(){var n={dialog:this.dialog},g=this;if(!1===this.fire("edit",n)||!n.dialog){return !1}this.editor.openDialog(n.dialog,function(p){var r,q;!1!==g.fire("dialog",p)&&(r=p.on("show",function(){p.setupContent(g)}),q=p.on("ok",function(){var u,t=g.on("data",function(v){u=1;v.cancel()},null,null,0);g.editor.fire("saveSnapshot");p.commitContent(g);t.removeListener();u&&(g.fire("data",g.data),g.editor.fire("saveSnapshot"))}),p.once("hide",function(){r.removeListener();q.removeListener()}))});return !0},getClasses:function(){return this.repository.parseElementClasses(this.element.getAttribute("class"))},hasClass:function(g){return this.element.hasClass(g)},initEditable:function(n,g){var p=this._findOneNotNested(g.selector);return p&&p.is(CKEDITOR.dtd.$editable)?(p=new az(this.editor,p,{filter:aw.call(this.repository,this.name,n,g)}),this.editables[n]=p,p.setAttributes({contenteditable:"true","data-cke-widget-editable":n,"data-cke-enter-mode":p.enterMode}),p.filter&&p.data("cke-filter",p.filter.id),p.addClass("cke_widget_editable"),p.removeClass("cke_widget_editable_focused"),g.pathName&&p.data("cke-display-name",g.pathName),this.editor.focusManager.add(p),p.on("focus",ai,this),CKEDITOR.env.ie&&p.on("blur",aj,this),p._.initialSetData=!0,p.setData(p.getHtml()),!0):!1},_findOneNotNested:function(n){n=this.wrapper.find(n);for(var g,q,p=0;p<n.count();p++){if(g=n.getItem(p),q=g.getAscendant(aC.isDomWidgetWrapper),this.wrapper.equals(q)){return g}}return null},isInited:function(){return !(!this.wrapper||!this.inited)},isReady:function(){return this.isInited()&&this.ready},focus:function(){var n=this.editor.getSelection();if(n){var g=this.editor.checkDirty();n.fake(this.wrapper);!g&&this.editor.resetDirty()}this.editor.focus()},removeClass:function(g){this.element.removeClass(g)},removeStyle:function(g){am(this,g,0)},setData:function(n,g){var r=this.data,q=0;if("string"==typeof n){r[n]!==g&&(r[n]=g,q=1)}else{var p=n;for(n in p){r[n]!==p[n]&&(q=1,r[n]=p[n])}}q&&this.dataReady&&(ay(this),this.fire("data",r));return this},setFocused:function(g){this.wrapper[g?"addClass":"removeClass"]("cke_widget_focused");this.fire(g?"focus":"blur");return this},setSelected:function(g){this.wrapper[g?"addClass":"removeClass"]("cke_widget_selected");this.fire(g?"select":"deselect");return this},updateDragHandlerPosition:function(){var n=this.editor,g=this.element.$,p=this._.dragHandlerOffset,g={x:g.offsetLeft,y:g.offsetTop-15};p&&g.x==p.x&&g.y==p.y||(p=n.checkDirty(),n.fire("lockSnapshot"),this.dragHandlerContainer.setStyles({top:g.y+"px",left:g.x+"px",display:"block"}),n.fire("unlockSnapshot"),!p&&n.resetDirty(),this._.dragHandlerOffset=g)}};CKEDITOR.event.implementOn(aC.prototype);aC.getNestedEditable=function(n,g){return !g||g.equals(n)?null:aC.isDomNestedEditable(g)?g:aC.getNestedEditable(n,g.getParent())};aC.isDomDragHandler=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.hasAttribute("data-cke-widget-drag-handler")};aC.isDomDragHandlerContainer=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.hasClass("cke_widget_drag_handler_container")};aC.isDomNestedEditable=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.hasAttribute("data-cke-widget-editable")};aC.isDomWidgetElement=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.hasAttribute("data-widget")};aC.isDomWidgetWrapper=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.hasAttribute("data-cke-widget-wrapper")};aC.isParserWidgetElement=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&!!g.attributes["data-widget"]};aC.isParserWidgetWrapper=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&!!g.attributes["data-cke-widget-wrapper"]};az.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(g){this._.initialSetData||this.editor.widgets.destroyAll(!1,this);this._.initialSetData=!1;g=this.editor.dataProcessor.toHtml(g,{context:this.getName(),filter:this.filter,enterMode:this.enterMode});this.setHtml(g);this.editor.widgets.initOnAll(this)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});var f=/^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?<\/span>([\s\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?<\/span>(?:<\/(?:div|span)>)?(?:<\/(?:div|span)>)?$/i,ao={37:1,38:1,39:1,40:1,8:1,46:1};(function(){function n(){}function g(q,p,r){return r&&this.checkElement(q)?(q=r.widgets.getByElement(q,!0))&&q.checkStyleActive(this):!1}CKEDITOR.style.addCustomHandler({type:"widget",setup:function(p){this.widget=p.widget},apply:function(p){p instanceof CKEDITOR.editor&&this.checkApplicable(p.elementPath(),p)&&p.widgets.focused.applyStyle(this)},remove:function(p){p instanceof CKEDITOR.editor&&this.checkApplicable(p.elementPath(),p)&&p.widgets.focused.removeStyle(this)},checkActive:function(q,p){return this.checkElementMatch(q.lastElement,0,p)},checkApplicable:function(q,p){return p instanceof CKEDITOR.editor?this.checkElement(q.lastElement):!1},checkElementMatch:g,checkElementRemovable:g,checkElement:function(p){return aC.isDomWidgetWrapper(p)?(p=p.getFirst(aC.isDomWidgetElement))&&p.data("widget")==this.widget:!1},buildPreview:function(p){return p||this._.definition.name},toAllowedContentRules:function(q){if(!q){return null}q=q.widgets.registered[this.widget];var p,r={};if(!q){return null}if(q.styleableElements){p=this.getClassesArray();if(!p){return null}r[q.styleableElements]={classes:p,propertiesOnly:!0};return r}return q.styleToAllowedContentRules?q.styleToAllowedContentRules(this):null},getClassesArray:function(){var p=this._.definition.attributes&&this._.definition.attributes["class"];return p?CKEDITOR.tools.trim(p).split(/\s+/):null},applyToRange:n,removeFromRange:n,applyToObject:n})})();CKEDITOR.plugins.widget=aC;aC.repository=aA;aC.nestedEditable=az})();