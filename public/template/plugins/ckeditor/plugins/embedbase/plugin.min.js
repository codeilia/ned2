(function(){var a={_attachScript:function(b,g){var f=new CKEDITOR.dom.element("script");f.setAttribute("src",b);f.on("error",g);CKEDITOR.document.getBody().append(f);return f},sendRequest:function(n,p,o,i){function f(){m&&(m.remove(),delete CKEDITOR._.jsonpCallbacks[l],m=null)}var j={};p=p||{};var l=CKEDITOR.tools.getNextNumber(),m;p.callback="CKEDITOR._.jsonpCallbacks["+l+"]";CKEDITOR._.jsonpCallbacks[l]=function(b){setTimeout(function(){f();o(b)})};m=this._attachScript(n.output(p),function(){f();i&&i()});j.cancel=f;return j}};CKEDITOR.plugins.add("embedbase",{lang:"cs,da,de,de-ch,en,eo,eu,fr,gl,id,it,ko,ku,nb,nl,pl,pt-br,ru,sv,tr,ug,uk,zh,zh-cn",requires:"widget,notificationaggregator",onLoad:function(){CKEDITOR._.jsonpCallbacks={}},init:function(){CKEDITOR.dialog.add("embedBase",this.path+"dialogs/embedbase.js")}});CKEDITOR.plugins.embedBase={createWidgetBaseDefinition:function(b){var g,f=b.lang.embedbase;return{mask:!0,template:"\x3cdiv\x3e\x3c/div\x3e",pathName:f.pathName,_cache:{},urlRegExp:/^((https?:)?\/\/|www\.)/i,init:function(){this.on("sendRequest",function(c){this._sendRequest(c.data)},this,null,999);this.on("dialog",function(c){c.data.widget=this},this);this.on("handleResponse",function(d){if(!d.data.html){var c=this._responseToHtml(d.data.url,d.data.response);null!==c?d.data.html=c:(d.data.errorMessage="unsupportedUrl",d.cancel())}},this,null,999)},loadContent:function(i,h){function m(c){j.response=c;l.editor.widgets.instances[l.id]?l._handleResponse(j)&&(l._cacheResponse(i,c),h.callback&&h.callback()):(CKEDITOR.warn("embedbase-widget-invalid"),j.task&&j.task.done())}h=h||{};var l=this,k=this._getCachedResponse(i),j={noNotifications:h.noNotifications,url:i,callback:m,errorCallback:function(c){l._handleError(j,c);h.errorCallback&&h.errorCallback(c)}};if(k){setTimeout(function(){m(k)})}else{return h.noNotifications||(j.task=this._createTask()),this.fire("sendRequest",j),j}},isUrlValid:function(c){return this.urlRegExp.test(c)&&!1!==this.fire("validateUrl",c)},getErrorMessage:function(e,d,h){(h=b.lang.embedbase[e+(h||"")])||(h=e);return(new CKEDITOR.template(h)).output({url:d||""})},_sendRequest:function(e){var d=this,h=a.sendRequest(this.providerUrl,{url:encodeURIComponent(e.url)},e.callback,function(){e.errorCallback("fetchingFailed")});e.cancel=function(){h.cancel();d.fire("requestCanceled",e)}},_handleResponse:function(d){var c={url:d.url,html:"",response:d.response};if(!1!==this.fire("handleResponse",c)){return d.task&&d.task.done(),this._setContent(d.url,c.html),!0}d.errorCallback(c.errorMessage);return !1},_handleError:function(d,c){d.task&&(d.task.cancel(),d.noNotifications||b.showNotification(this.getErrorMessage(c,d.url),"warning"))},_responseToHtml:function(d,c){return"photo"==c.type?'\x3cimg src\x3d"'+CKEDITOR.tools.htmlEncodeAttr(c.url)+'" alt\x3d"'+CKEDITOR.tools.htmlEncodeAttr(c.title||"")+'" style\x3d"max-width:100%;height:auto" /\x3e':"video"==c.type||"rich"==c.type?(c.html=c.html.replace(/<iframe/g,'\x3ciframe tabindex\x3d"-1"'),c.html):null},_setContent:function(d,c){this.setData("url",d);this.element.setHtml(c)},_createTask:function(){if(!g||g.isFinished()){g=new CKEDITOR.plugins.notificationAggregator(b,f.fetchingMany,f.fetchingOne),g.on("finished",function(){g.notification.hide()})}return g.createTask()},_cacheResponse:function(d,c){this._cache[d]=c},_getCachedResponse:function(c){return this._cache[c]}}},_jsonp:a}})();