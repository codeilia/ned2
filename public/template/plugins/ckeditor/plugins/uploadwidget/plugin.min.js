(function(){CKEDITOR.plugins.add("uploadwidget",{lang:"cs,da,de,de-ch,el,en,eo,eu,fr,gl,hu,id,it,km,ko,ku,nb,nl,pl,pt,pt-br,ru,sv,tr,ug,uk,zh,zh-cn",requires:"widget,clipboard,filetools,notificationaggregator",init:function(b){b.filter.allow("*[!data-widget,!data-cke-upload-id]")}});CKEDITOR.fileTools||(CKEDITOR.fileTools={});CKEDITOR.tools.extend(CKEDITOR.fileTools,{addUploadWidget:function(f,k,j){var h=CKEDITOR.fileTools,c=f.uploadRepository,i=j.supportedTypes?10:20;if(j.fileToElement){f.on("paste",function(g){g=g.data;var p=g.dataTransfer,d=p.getFilesCount(),a=j.loadMethod||"loadAndUpload",o,e;if(!g.dataValue&&d){for(e=0;e<d;e++){if(o=p.getFile(e),!j.supportedTypes||h.isTypeSupported(o,j.supportedTypes)){var b=j.fileToElement(o);o=c.create(o);b&&(o[a](j.uploadUrl),CKEDITOR.fileTools.markElement(b,k,o.id),"loadAndUpload"!=a&&"upload"!=a||CKEDITOR.fileTools.bindNotifications(f,o),g.dataValue+=b.getOuterHtml())}}}},null,null,i)}CKEDITOR.tools.extend(j,{downcast:function(){return new CKEDITOR.htmlParser.text("")},init:function(){var g=this,m=this.wrapper.findOne("[data-cke-upload-id]").data("cke-upload-id"),a=c.loaders[m],l=CKEDITOR.tools.capitalize,n,b;a.on("update",function(d){if(g.wrapper&&g.wrapper.getParent()){f.fire("lockSnapshot");d="on"+l(a.status);if("function"!==typeof g[d]||!1!==g[d](a)){b="cke_upload_"+a.status,g.wrapper&&b!=n&&(n&&g.wrapper.removeClass(n),g.wrapper.addClass(b),n=b),"error"!=a.status&&"abort"!=a.status||f.widgets.del(g)}f.fire("unlockSnapshot")}else{f.editable().find('[data-cke-upload-id\x3d"'+m+'"]').count()||a.abort(),d.removeListener()}});a.update()},replaceWith:function(a,q){if(""===a.trim()){f.widgets.del(this)}else{var p=this==f.widgets.focused,o=f.editable(),r=f.createRange(),n,m;p||(m=f.getSelection().createBookmarks());r.setStartBefore(this.wrapper);r.setEndAfter(this.wrapper);p&&(n=r.createBookmark());o.insertHtmlIntoRange(a,r,q);f.widgets.checkWidgets({initOnlyNew:!0});f.widgets.destroy(this,!0);p?(r.moveToBookmark(n),r.select()):f.getSelection().selectBookmarks(m)}}});f.widgets.add(k,j)},markElement:function(b,f,c){b.setAttributes({"data-cke-upload-id":c,"data-widget":f})},bindNotifications:function(f,j){function i(){h=f._.uploadWidgetNotificaionAggregator;if(!h||h.isFinished()){h=f._.uploadWidgetNotificaionAggregator=new CKEDITOR.plugins.notificationAggregator(f,f.lang.uploadwidget.uploadMany,f.lang.uploadwidget.uploadOne),h.once("finished",function(){var a=h.getTaskCount();0===a?h.notification.hide():h.notification.update({message:1==a?f.lang.uploadwidget.doneOne:f.lang.uploadwidget.doneMany.replace("%1",a),type:"success",important:1})})}}var h,c=null;j.on("update",function(){!c&&j.uploadTotal&&(i(),c=h.createTask({weight:j.uploadTotal}));c&&"uploading"==j.status&&c.update(j.uploaded)});j.on("uploaded",function(){c&&c.done()});j.on("error",function(){c&&c.cancel();f.showNotification(j.message,"warning")});j.on("abort",function(){c&&c.cancel();f.showNotification(f.lang.uploadwidget.abort,"info")})}})})();