CKEDITOR.plugins.add("notification",{lang:"cs,da,de,de-ch,en,eo,eu,fr,gl,id,it,km,ko,ku,nb,nl,pl,pt,pt-br,ru,sv,tr,ug,uk,zh,zh-cn",requires:"toolbar",init:function(c){function d(e){var f=new CKEDITOR.dom.element("div");f.setStyles({position:"fixed","margin-left":"-9999px"});f.setAttributes({"aria-live":"assertive","aria-atomic":"true"});f.setText(e);CKEDITOR.document.getBody().append(f);setTimeout(function(){f.remove()},100)}c._.notificationArea=new Area(c);c.showNotification=function(f,j,i){var h,b;"progress"==j?h=i:b=i;f=new CKEDITOR.plugins.notification(c,{message:f,type:j,progress:h,duration:b});f.show();return f};c.on("key",function(b){if(27==b.data.keyCode){var a=c._.notificationArea.notifications;a.length&&(d(c.lang.notification.closed),a[a.length-1].hide(),b.cancel())}})}});function Notification(c,d){CKEDITOR.tools.extend(this,d,{editor:c,id:"cke-"+CKEDITOR.tools.getUniqueId(),area:c._.notificationArea});d.type||(this.type="info");this.element=this._createElement();c.plugins.clipboard&&CKEDITOR.plugins.clipboard.preventDefaultDropOnElement(this.element)}Notification.prototype={show:function(){!1!==this.editor.fire("notificationShow",{notification:this})&&(this.area.add(this),this._hideAfterTimeout())},update:function(f){var h=!0;!1===this.editor.fire("notificationUpdate",{notification:this,options:f})&&(h=!1);var l=this.element,k=l.findOne(".cke_notification_message"),j=l.findOne(".cke_notification_progress"),i=f.type;l.removeAttribute("role");f.progress&&"progress"!=this.type&&(i="progress");i&&(l.removeClass(this._getClass()),l.removeAttribute("aria-label"),this.type=i,l.addClass(this._getClass()),l.setAttribute("aria-label",this.type),"progress"!=this.type||j?"progress"!=this.type&&j&&j.remove():(j=this._createProgressElement(),j.insertBefore(k)));void 0!==f.message&&(this.message=f.message,k.setHtml(this.message));void 0!==f.progress&&(this.progress=f.progress,j&&j.setStyle("width",this._getPercentageProgress()));h&&f.important&&(l.setAttribute("role","alert"),this.isVisible()||this.area.add(this));this.duration=f.duration;this._hideAfterTimeout()},hide:function(){!1!==this.editor.fire("notificationHide",{notification:this})&&this.area.remove(this)},isVisible:function(){return 0<=CKEDITOR.tools.indexOf(this.area.notifications,this)},_createElement:function(){var e=this,f,h,g=this.editor.lang.common.close;f=new CKEDITOR.dom.element("div");f.addClass("cke_notification");f.addClass(this._getClass());f.setAttributes({id:this.id,role:"alert","aria-label":this.type});"progress"==this.type&&f.append(this._createProgressElement());h=new CKEDITOR.dom.element("p");h.addClass("cke_notification_message");h.setHtml(this.message);f.append(h);h=CKEDITOR.dom.element.createFromHtml('\x3ca class\x3d"cke_notification_close" href\x3d"javascript:void(0)" title\x3d"'+g+'" role\x3d"button" tabindex\x3d"-1"\x3e\x3cspan class\x3d"cke_label"\x3eX\x3c/span\x3e\x3c/a\x3e');f.append(h);h.on("click",function(){e.editor.focus();e.hide()});return f},_getClass:function(){return"progress"==this.type?"cke_notification_info":"cke_notification_"+this.type},_createProgressElement:function(){var a=new CKEDITOR.dom.element("span");a.addClass("cke_notification_progress");a.setStyle("width",this._getPercentageProgress());return a},_getPercentageProgress:function(){return Math.round(100*(this.progress||0))+"%"},_hideAfterTimeout:function(){var c=this,d;this._hideTimeoutId&&clearTimeout(this._hideTimeoutId);if("number"==typeof this.duration){d=this.duration}else{if("info"==this.type||"success"==this.type){d="number"==typeof this.editor.config.notification_duration?this.editor.config.notification_duration:5000}}d&&(c._hideTimeoutId=setTimeout(function(){c.hide()},d))}};function Area(c){var d=this;this.editor=c;this.notifications=[];this.element=this._createElement();this._uiBuffer=CKEDITOR.tools.eventsBuffer(10,this._layout,this);this._changeBuffer=CKEDITOR.tools.eventsBuffer(500,this._layout,this);c.on("destroy",function(){d._removeListeners();d.element.remove()})}Area.prototype={add:function(a){this.notifications.push(a);this.element.append(a.element);1==this.element.getChildCount()&&(CKEDITOR.document.getBody().append(this.element),this._attachListeners());this._layout()},remove:function(c){var d=CKEDITOR.tools.indexOf(this.notifications,c);0>d||(this.notifications.splice(d,1),c.element.remove(),this.element.getChildCount()||(this._removeListeners(),this.element.remove()))},_createElement:function(){var d=this.editor,e=d.config,f=new CKEDITOR.dom.element("div");f.addClass("cke_notifications_area");f.setAttribute("id","cke_notifications_area_"+d.name);f.setStyle("z-index",e.baseFloatZIndex-2);return f},_attachListeners:function(){var c=CKEDITOR.document.getWindow(),d=this.editor;c.on("scroll",this._uiBuffer.input);c.on("resize",this._uiBuffer.input);d.on("change",this._changeBuffer.input);d.on("floatingSpaceLayout",this._layout,this,null,20);d.on("blur",this._layout,this,null,20)},_removeListeners:function(){var c=CKEDITOR.document.getWindow(),d=this.editor;c.removeListener("scroll",this._uiBuffer.input);c.removeListener("resize",this._uiBuffer.input);d.removeListener("change",this._changeBuffer.input);d.removeListener("floatingSpaceLayout",this._layout);d.removeListener("blur",this._layout)},_layout:function(){function D(){E.setStyle("left",w(s+B.width-z-x))}var E=this.element,C=this.editor,B=C.ui.contentsElement.getClientRect(),A=C.ui.contentsElement.getDocumentPosition(),C=C.ui.space("top"),y=C.getClientRect(),u=E.getClientRect(),v,z=this._notificationWidth,x=this._notificationMargin;v=CKEDITOR.document.getWindow();var o=v.getScrollPosition(),j=v.getViewPaneSize(),i=CKEDITOR.document.getBody(),F=i.getDocumentPosition(),w=CKEDITOR.tools.cssLength;z&&x||(v=this.element.getChild(0),z=this._notificationWidth=v.getClientRect().width,x=this._notificationMargin=parseInt(v.getComputedStyle("margin-left"),10)+parseInt(v.getComputedStyle("margin-right"),10));C.isVisible()&&y.bottom>B.top&&y.bottom<B.bottom-u.height?E.setStyles({position:"fixed",top:w(y.bottom)}):0<B.top?E.setStyles({position:"absolute",top:w(A.y)}):A.y+B.height-u.height>o.y?E.setStyles({position:"fixed",top:0}):E.setStyles({position:"absolute",top:w(A.y+B.height-u.height)});var s="fixed"==E.getStyle("position")?B.left:"static"!=i.getComputedStyle("position")?A.x-F.x:A.x;B.width<z+x?A.x+z+x>o.x+j.width?D():E.setStyle("left",w(s)):A.x+z+x>o.x+j.width?E.setStyle("left",w(s)):A.x+B.width/2+z/2+x>o.x+j.width?E.setStyle("left",w(s-A.x+o.x+j.width-z-x)):0>B.left+B.width-z-x?D():0>B.left+B.width/2-z/2?E.setStyle("left",w(s-A.x+o.x)):E.setStyle("left",w(s+B.width/2-z/2-x/2))}};CKEDITOR.plugins.notification=Notification;