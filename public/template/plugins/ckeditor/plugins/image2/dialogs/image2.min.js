CKEDITOR.dialog.add("image2",function(al){function ac(){var b=this.getValue().match(ab);(b=!(!b||0===parseInt(b[1],10)))||alert(aq["invalid"+CKEDITOR.tools.capitalize(this.id)]);return b}function d(){function c(g,f){e.push(b.once(g,function(k){for(var h;h=e.pop();){h.removeListener()}f(k)}))}var b=aa.createElement("img"),e=[];return function(g,f,h){c("load",function(){var k=Y(b);f.call(h,b,k.width,k.height)});c("error",function(){f(null)});c("abort",function(){f(null)});b.setAttribute("src",(T.baseHref||"")+g+"?"+Math.random().toString(16).substring(2))}}function X(){var b=this.getValue();Z(!1);b!==Q.data.src?(V(b,function(e,f,c){Z(!0);if(!e){return ak(!1)}an.setValue(!1===al.config.image2_prefillDimensions?0:f);am.setValue(!1===al.config.image2_prefillDimensions?0:c);W=f;U=c;ak(S.checkHasNaturalRatio(e))}),aj=!0):aj?(Z(!0),an.setValue(ah),am.setValue(ag),aj=!1):Z(!0)}function R(){if(ap){var f=this.getValue();if(f&&(f.match(ab)||ak(!1),"0"!==f)){var e="width"==this.id,g=ah||W,h=ag||U,f=e?Math.round(f/g*h):Math.round(f/h*g);isNaN(f)||(e?am:an).setValue(f)}}}function ak(b){if(ao){if("boolean"==typeof b){if(o){return}ap=b}else{b=an.getValue(),o=!0,(ap=!ap)&&b&&(b*=ag/ah,isNaN(b)||am.setValue(Math.round(b)))}ao[ap?"removeClass":"addClass"]("cke_btn_unlocked");ao.setAttribute("aria-checked",ap);CKEDITOR.env.hc&&ao.getChild(0).setHtml(ap?CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢")}}function Z(b){b=b?"enable":"disable";an[b]();am[b]()}var ab=/(^\s*(\d+)(px)?\s*$)|^$/i,s=CKEDITOR.tools.getNextId(),l=CKEDITOR.tools.getNextId(),ar=al.lang.image2,aq=al.lang.common,a=(new CKEDITOR.template('\x3cdiv\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+ar.lockRatio+'" class\x3d"cke_btn_locked" id\x3d"{lockButtonId}" role\x3d"checkbox"\x3e\x3cspan class\x3d"cke_icon"\x3e\x3c/span\x3e\x3cspan class\x3d"cke_label"\x3e'+ar.lockRatio+'\x3c/span\x3e\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+ar.resetSize+'" class\x3d"cke_btn_reset" id\x3d"{resetButtonId}" role\x3d"button"\x3e\x3cspan class\x3d"cke_label"\x3e'+ar.resetSize+"\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e")).output({lockButtonId:s,resetButtonId:l}),S=CKEDITOR.plugins.image2,T=al.config,ai=al.widgets.registered.image.features,Y=S.getNatural,aa,Q,j,V,ah,ag,W,U,aj,ap,o,ao,ae,an,am,af,ad=!(!T.filebrowserImageBrowseUrl&&!T.filebrowserBrowseUrl),i=[{id:"src",type:"text",label:aq.url,onKeyup:X,onChange:X,setup:function(b){this.setValue(b.data.src)},commit:function(b){b.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(ar.urlMissing)}];ad&&i.push({type:"button",id:"browse",style:"display:inline-block;margin-top:14px;",align:"center",label:al.lang.common.browseServer,hidden:!0,filebrowser:"info:src"});return{title:ar.title,minWidth:250,minHeight:100,onLoad:function(){aa=this._.element.getDocument();V=d()},onShow:function(){Q=this.widget;j=Q.parts.image;aj=o=ap=!1;af=Y(j);W=ah=af.width;U=ag=af.height},contents:[{id:"info",label:ar.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],children:i}]},{id:"alt",type:"text",label:ar.alt,setup:function(b){this.setValue(b.data.alt)},commit:function(b){b.setData("alt",this.getValue())}},{type:"hbox",widths:["25%","25%","50%"],requiredContent:ai.dimension.requiredContent,children:[{type:"text",width:"45px",id:"width",label:aq.width,validate:ac,onKeyUp:R,onLoad:function(){an=this},setup:function(b){this.setValue(b.data.width)},commit:function(b){b.setData("width",this.getValue())}},{type:"text",id:"height",width:"45px",label:aq.height,validate:ac,onKeyUp:R,onLoad:function(){am=this},setup:function(b){this.setValue(b.data.height)},commit:function(b){b.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:18px;width:40px;height:20px;",onLoad:function(){function e(b){b.on("mouseover",function(){this.addClass("cke_btn_over")},b);b.on("mouseout",function(){this.removeClass("cke_btn_over")},b)}var c=this.getDialog();ao=aa.getById(s);ae=aa.getById(l);ao&&(c.addFocusable(ao,4+ad),ao.on("click",function(b){ak();b.data&&b.data.preventDefault()},this.getDialog()),e(ao));ae&&(c.addFocusable(ae,5+ad),ae.on("click",function(b){aj?(an.setValue(W),am.setValue(U)):(an.setValue(ah),am.setValue(ag));b.data&&b.data.preventDefault()},this),e(ae))},setup:function(b){ak(b.data.lock)},commit:function(b){b.setData("lock",ap)},html:a}]},{type:"hbox",id:"alignment",requiredContent:ai.align.requiredContent,children:[{id:"align",type:"radio",items:[[aq.alignNone,"none"],[aq.alignLeft,"left"],[aq.alignCenter,"center"],[aq.alignRight,"right"]],label:aq.align,setup:function(b){this.setValue(b.data.align)},commit:function(b){b.setData("align",this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:ar.captioned,requiredContent:ai.caption.requiredContent,setup:function(b){this.setValue(b.data.hasCaption)},commit:function(b){b.setData("hasCaption",this.getValue())}}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:ar.uploadTab,elements:[{type:"file",id:"upload",label:ar.btnUpload,style:"height:40px"},{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:ar.btnUpload,"for":["Upload","upload"]}]}]}});