CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function a(d){var b=this._;b.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(d),b.on?b.panel.hide():b.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(d){var b=d.panel||{};delete d.panel;this.base(d);this.document=b.parent&&b.parent.getDocument()||CKEDITOR.document;b.block={attributes:b.attributes};this.hasArrow=b.toolbarRelated=!0;this.click=a;this._={panelDefinition:b}},statics:{handler:{create:function(b){return new CKEDITOR.ui.panelButton(b)}}},proto:{createPanel:function(n){var i=this._;if(!i.panel){var k=this._.panelDefinition,l=this._.panelDefinition.block,j=k.parent||CKEDITOR.document.getBody(),m=this._.panel=new CKEDITOR.ui.floatPanel(n,j,k),k=m.addBlock(i.id,l),h=this;m.onShow=function(){h.className&&this.element.addClass(h.className+"_panel");h.setState(CKEDITOR.TRISTATE_ON);i.on=1;h.editorFocus&&n.focus();if(h.onOpen){h.onOpen()}};m.onHide=function(b){h.className&&this.element.getFirst().removeClass(h.className+"_panel");h.setState(h.modes&&h.modes[n.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);i.on=0;if(!b&&h.onClose){h.onClose()}};m.onEscape=function(){m.hide(1);h.document.getById(i.id).focus()};if(this.onBlock){this.onBlock(m,k)}k.onHide=function(){i.on=0;h.setState(CKEDITOR.TRISTATE_OFF)}}}}})},beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}});CKEDITOR.UI_PANELBUTTON="panelbutton";