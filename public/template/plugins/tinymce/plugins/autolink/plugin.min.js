tinymce.PluginManager.add("autolink",function(e){var b;var a=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;if(e.settings.autolink_pattern){a=e.settings.autolink_pattern}e.on("keydown",function(h){if(h.keyCode==13){return d(e)}});if(tinymce.Env.ie){e.on("focus",function(){if(!b){b=true;try{e.execCommand("AutoUrlDetect",false,true)}catch(h){}}});return}e.on("keypress",function(h){if(h.keyCode==41){return f(e)}});e.on("keyup",function(h){if(h.keyCode==32){return c(e)}});function f(h){g(h,-1,"(",true)}function c(h){g(h,0,"",true)}function d(h){g(h,-1,"",false)}function g(q,l,i){var h,n,k,w,t,v,o,m,p,u;function j(y,z){if(z<0){z=0}if(y.nodeType==3){var x=y.data.length;if(z>x){z=x}}return z}function s(x,y){if(x.nodeType!=1||x.hasChildNodes()){h.setStart(x,j(x,y))}else{h.setStartBefore(x)}}function r(x,y){if(x.nodeType!=1||x.hasChildNodes()){h.setEnd(x,j(x,y))}else{h.setEndAfter(x)}}if(q.selection.getNode().tagName=="A"){return}h=q.selection.getRng(true).cloneRange();if(h.startOffset<5){m=h.endContainer.previousSibling;if(!m){if(!h.endContainer.firstChild||!h.endContainer.firstChild.nextSibling){return}m=h.endContainer.firstChild.nextSibling}p=m.length;s(m,p);r(m,p);if(h.endOffset<5){return}n=h.endOffset;w=m}else{w=h.endContainer;if(w.nodeType!=3&&w.firstChild){while(w.nodeType!=3&&w.firstChild){w=w.firstChild}if(w.nodeType==3){s(w,0);r(w,w.nodeValue.length)}}if(h.endOffset==1){n=2}else{n=h.endOffset-1-l}}k=n;do{s(w,n>=2?n-2:0);r(w,n>=1?n-1:0);n-=1;u=h.toString()}while(u!=" "&&u!==""&&u.charCodeAt(0)!=160&&(n-2)>=0&&u!=i);if(h.toString()==i||h.toString().charCodeAt(0)==160){s(w,n);r(w,k);n+=1}else{if(h.startOffset===0){s(w,0);r(w,k)}else{s(w,n);r(w,k)}}v=h.toString();if(v.charAt(v.length-1)=="."){r(w,k-1)}v=h.toString();o=v.match(a);if(o){if(o[1]=="www."){o[1]="http://www."}else{if(/@$/.test(o[1])&&!/^mailto:/.test(o[1])){o[1]="mailto:"+o[1]}}t=q.selection.getBookmark();q.selection.setRng(h);q.execCommand("createlink",false,o[1]+o[2]);q.selection.moveToBookmark(t);q.nodeChanged()}}});