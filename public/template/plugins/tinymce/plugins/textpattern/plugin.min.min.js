tinymce.PluginManager.add("textpattern",function(o){var t=true,s;s=o.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];function k(){if(t){s.sort(function(a,b){if(a.start.length>b.start.length){return -1}if(a.start.length<b.start.length){return 1}return 0});t=false}return s}function q(a){var b=k();for(var c=0;c<b.length;c++){if(a.indexOf(b[c].start)!==0){continue}if(b[c].end&&a.lastIndexOf(b[c].end)!=a.length-b[c].end.length){continue}return b[c]}}function m(e,f,d){var b,a,c;b=k();for(c=0;c<b.length;c++){a=b[c];if(a.end&&e.substr(f-a.end.length-d,a.end.length)==a.end){return a}}}function p(h){var x,e,g,f,d,z,i,c,a,j,y;function b(){f=f.splitText(z);f.splitText(d-z-j);f.deleteData(0,a.start.length);f.deleteData(f.data.length-a.end.length,a.end.length)}x=o.selection;e=o.dom;if(!x.isCollapsed()){return}g=x.getRng(true);f=g.startContainer;d=g.startOffset;i=f.data;j=h?1:0;if(f.nodeType!=3){return}a=m(i,d,j);if(!a){return}z=Math.max(0,d-j);z=i.lastIndexOf(a.start,z-a.end.length-1);if(z===-1){return}c=e.createRng();c.setStart(f,z);c.setEnd(f,d-j);a=q(c.toString());if(!a||!a.end){return}if(f.data.length<=a.start.length+a.end.length){return}y=o.formatter.get(a.format);if(y&&y[0].inline){b();o.formatter.apply(a.format,{},f);return f}}function l(){var i,c,f,v,e,j,a,b,g,h,d;i=o.selection;c=o.dom;if(!i.isCollapsed()){return}a=c.getParent(i.getStart(),"p");if(a){g=new tinymce.dom.TreeWalker(a,a);while((e=g.next())){if(e.nodeType==3){v=e;break}}if(v){b=q(v.data);if(!b){return}h=i.getRng(true);f=h.startContainer;d=h.startOffset;if(v==f){d=Math.max(0,d-b.start.length)}if(tinymce.trim(v.data).length==b.start.length){return}if(b.format){j=o.formatter.get(b.format);if(j&&j[0].block){v.deleteData(0,b.start.length);o.formatter.apply(b.format,{},v);h.setStart(f,d);h.collapse(true);i.setRng(h)}}if(b.cmd){o.undoManager.transact(function(){v.deleteData(0,b.start.length);o.execCommand(b.cmd)})}}}}function r(){var b,a;a=p();if(a){b=o.dom.createRng();b.setStart(a,a.data.length);b.setEnd(a,a.data.length);o.selection.setRng(b)}l()}function n(){var e,a,b,c,d;e=p(true);if(e){d=o.dom;a=e.data.slice(-1);if(/[\u00a0 ]/.test(a)){e.deleteData(e.data.length-1,1);b=d.doc.createTextNode(a);if(e.nextSibling){d.insertAfter(b,e.nextSibling)}else{e.parentNode.appendChild(b)}c=d.createRng();c.setStart(b,1);c.setEnd(b,1);o.selection.setRng(c)}}}o.on("keydown",function(a){if(a.keyCode==13&&!tinymce.util.VK.modifierPressed(a)){r()}},true);o.on("keyup",function(a){if(a.keyCode==32&&!tinymce.util.VK.modifierPressed(a)){n()}});this.getPatterns=k;this.setPatterns=function(a){s=a;t=true}});