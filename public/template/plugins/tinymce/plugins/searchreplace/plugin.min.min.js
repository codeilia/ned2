(function(){function f(a){return a&&a.nodeType==1&&a.contentEditable==="false"}function d(m,B,E,F,z){var A,y=[],G,v=0,c;var H,D,w;c=B.ownerDocument;H=z.getBlockElements();D=z.getWhiteSpaceElements();w=z.getShortEndedElements();function b(i,h){h=h||0;if(!i[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}var g=i.index;if(h>0){var j=i[h];if(!j){throw"Invalid capture group"}g+=i[0].indexOf(j);i[0]=j}return[g,g+i[0].length,[i[0]]]}function a(h){var g;if(h.nodeType===3){return h.data}if(D[h.nodeName]&&!H[h.nodeName]){return""}g="";if(f(h)){return"\n"}if(H[h.nodeName]||w[h.nodeName]){g+="\n"}if((h=h.firstChild)){do{g+=a(h)}while((h=h.nextSibling))}return g}function x(o,l,g){var q,h,j,p,s=[],i=0,n=o,k=l.shift(),r=0;out:while(true){if(H[n.nodeName]||w[n.nodeName]||f(n)){i++}if(n.nodeType===3){if(!h&&n.length+i>=k[1]){h=n;p=k[1]-i}else{if(q){s.push(n)}}if(!q&&n.length+i>k[0]){q=n;j=k[0]-i}i+=n.length}if(q&&h){n=g({startNode:q,startNodeIndex:j,endNode:h,endNodeIndex:p,innerNodes:s,match:k[2],matchIndex:r});i-=(h.length-p);q=null;h=null;s=[];k=l.shift();r++;if(!k){break}}else{if((!D[n.nodeName]||H[n.nodeName])&&n.firstChild){if(!f(n)){n=n.firstChild;continue}}else{if(n.nextSibling){n=n.nextSibling;continue}}}while(true){if(n.nextSibling){n=n.nextSibling;break}else{if(n.parentNode!==o){n=n.parentNode}else{break out}}}}}function C(h){var g;if(typeof h!="function"){var i=h.nodeType?h:c.createElement(h);g=function(l,j){var k=i.cloneNode(false);k.setAttribute("data-mce-index",j);if(l){k.appendChild(c.createTextNode(l))}return k}}else{g=h}return function(j){var s,u,R,p=j.startNode,P=j.endNode,q=j.matchIndex;if(p===P){var n=p;R=n.parentNode;if(j.startNodeIndex>0){s=c.createTextNode(n.data.substring(0,j.startNodeIndex));R.insertBefore(s,n)}var r=g(j.match[0],q);R.insertBefore(r,n);if(j.endNodeIndex<n.length){u=c.createTextNode(n.data.substring(j.endNodeIndex));R.insertBefore(u,n)}n.parentNode.removeChild(n);return r}s=c.createTextNode(p.data.substring(0,j.startNodeIndex));u=c.createTextNode(P.data.substring(j.endNodeIndex));var N=g(p.data.substring(j.startNodeIndex),q);var O=[];for(var k=0,l=j.innerNodes.length;k<l;++k){var o=j.innerNodes[k];var t=g(o.data,q);o.parentNode.replaceChild(t,o);O.push(t)}var Q=g(P.data.substring(0,j.endNodeIndex),q);R=p.parentNode;R.insertBefore(s,p);R.insertBefore(N,p);R.removeChild(p);R=P.parentNode;R.insertBefore(Q,P);R.insertBefore(u,P);R.removeChild(P);return Q}}G=a(B);if(!G){return}if(m.global){while((A=m.exec(G))){y.push(b(A,F))}}else{A=G.match(m);y.push(b(A,F))}if(y.length){v=y.length;x(B,y,C(E))}return v}function e(s){var b=this,q=-1;function p(){var j={},g;g=tinymce.trim(s.selection.getContent({format:"text"}));function k(){i.statusbar.find("#next").disabled(!v(q+1).length);i.statusbar.find("#prev").disabled(!v(q-1).length)}function h(){s.windowManager.alert("Could not find the specified string.",function(){i.find("#find")[0].focus()})}var i=s.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){s.focus();b.done()},onSubmit:function(m){var n,z,l,y;m.preventDefault();z=i.find("#case").checked();y=i.find("#words").checked();l=i.find("#find").value();if(!l.length){b.done(false);i.statusbar.items().slice(1).disabled(true);return}if(j.text==l&&j.caseState==z&&j.wholeWord==y){if(v(q+1).length===0){h();return}b.next();k();return}n=b.find(l,z,y);if(!n){h()}i.statusbar.items().slice(1).disabled(n===0);k();j={text:l,caseState:z,wholeWord:y}},buttons:[{text:"Find",subtype:"primary",onclick:function(){i.submit()}},{text:"Replace",disabled:true,onclick:function(){if(!b.replace(i.find("#replace").value())){i.statusbar.items().slice(1).disabled(true);q=-1;j={}}}},{text:"Replace all",disabled:true,onclick:function(){b.replace(i.find("#replace").value(),true,true);i.statusbar.items().slice(1).disabled(true);j={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:true,onclick:function(){b.prev();k()}},{text:"Next",name:"next",disabled:true,onclick:function(){b.next();k()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:g},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}b.init=function(g){g.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:p,separator:"before",context:"edit"});g.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:p});g.addCommand("SearchReplace",p);g.shortcuts.add("Meta+F","",p)};function o(g){var h=g.getAttribute("data-mce-index");if(typeof h=="number"){return""+h}return h}function r(g){var h,i;i=s.dom.create("span",{"data-mce-bogus":1});i.className="mce-match-marker";h=s.getBody();b.done(false);return d(g,h,i,false,s.schema)}function t(g){var h=g.parentNode;if(g.firstChild){h.insertBefore(g.firstChild,g)}g.parentNode.removeChild(g)}function v(j){var k,h=[];k=tinymce.toArray(s.getBody().getElementsByTagName("span"));if(k.length){for(var i=0;i<k.length;i++){var g=o(k[i]);if(g===null||!g.length){continue}if(g===j.toString()){h.push(k[i])}}}return h}function c(j){var h=q,g=s.dom;j=j!==false;if(j){h++}else{h--}g.removeClass(v(q),"mce-match-marker-selected");var i=v(h);if(i.length){g.addClass(v(h),"mce-match-marker-selected");s.selection.scrollIntoView(i[0]);return h}return -1}function u(h){var g=s.dom,i=h.parentNode;g.remove(h);if(g.isEmpty(i)){g.remove(i)}}b.find=function(g,h,j){g=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");g=j?"\\b"+g+"\\b":g;var i=r(new RegExp(g,h?"g":"gi"));if(i){q=-1;q=c(true)}return i};b.next=function(){var g=c(true);if(g!==-1){q=g}};b.prev=function(){var g=c(false);if(g!==-1){q=g}};function a(g){var h=o(g);return h!==null&&h.length>0}b.replace=function(k,n,l){var A,j,h,m,B,z=q,i;n=n!==false;h=s.getBody();j=tinymce.grep(tinymce.toArray(h.getElementsByTagName("span")),a);for(A=0;A<j.length;A++){var g=o(j[A]);m=B=parseInt(g,10);if(l||m===q){if(k.length){j[A].firstChild.nodeValue=k;t(j[A])}else{u(j[A])}while(j[++A]){m=parseInt(o(j[A]),10);if(m===B){u(j[A])}else{A--;break}}if(n){z--}}else{if(B>q){j[A].setAttribute("data-mce-index",B-1)}}}s.undoManager.add();q=z;if(n){i=v(z+1).length>0;b.next()}else{i=v(z-1).length>0;b.prev()}return !l&&i};b.done=function(k){var j,l,i,h;l=tinymce.toArray(s.getBody().getElementsByTagName("span"));for(j=0;j<l.length;j++){var g=o(l[j]);if(g!==null&&g.length){if(g===q.toString()){if(!i){i=l[j].firstChild}h=l[j].firstChild}t(l[j])}}if(i&&h){var m=s.dom.createRng();m.setStart(i,0);m.setEnd(h,h.data.length);if(k!==false){s.selection.setRng(m)}return m}}}tinymce.PluginManager.add("searchreplace",e)})();