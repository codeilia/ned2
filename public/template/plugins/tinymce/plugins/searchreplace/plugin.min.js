(function(){function c(d){return d&&d.nodeType==1&&d.contentEditable==="false"}function b(o,g,d,u,i){var h,j=[],t,n=0,p;var s,e,l;p=g.ownerDocument;s=i.getBlockElements();e=i.getWhiteSpaceElements();l=i.getShortEndedElements();function q(v,w){w=w||0;if(!v[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}var x=v.index;if(w>0){var y=v[w];if(!y){throw"Invalid capture group"}x+=v[0].indexOf(y);v[0]=y}return[x,x+v[0].length,[v[0]]]}function r(v){var m;if(v.nodeType===3){return v.data}if(e[v.nodeName]&&!s[v.nodeName]){return""}m="";if(c(v)){return"\n"}if(s[v.nodeName]||l[v.nodeName]){m+="\n"}if((v=v.firstChild)){do{m+=r(v)}while((v=v.nextSibling))}return m}function k(x,z,D){var v,C,A,w,E=[],B=0,y=x,m=z.shift(),F=0;out:while(true){if(s[y.nodeName]||l[y.nodeName]||c(y)){B++}if(y.nodeType===3){if(!C&&y.length+B>=m[1]){C=y;w=m[1]-B}else{if(v){E.push(y)}}if(!v&&y.length+B>m[0]){v=y;A=m[0]-B}B+=y.length}if(v&&C){y=D({startNode:v,startNodeIndex:A,endNode:C,endNodeIndex:w,innerNodes:E,match:m[2],matchIndex:F});B-=(C.length-w);v=null;C=null;E=[];m=z.shift();F++;if(!m){break}}else{if((!e[y.nodeName]||s[y.nodeName])&&y.firstChild){if(!c(y)){y=y.firstChild;continue}}else{if(y.nextSibling){y=y.nextSibling;continue}}}while(true){if(y.nextSibling){y=y.nextSibling;break}else{if(y.parentNode!==x){y=y.parentNode}else{break out}}}}}function f(w){var m;if(typeof w!="function"){var v=w.nodeType?w:p.createElement(w);m=function(y,x){var z=v.cloneNode(false);z.setAttribute("data-mce-index",x);if(y){z.appendChild(p.createTextNode(y))}return z}}else{m=w}return function(D){var K,x,E,z=D.startNode,G=D.endNode,L=D.matchIndex;if(z===G){var A=z;E=A.parentNode;if(D.startNodeIndex>0){K=p.createTextNode(A.data.substring(0,D.startNodeIndex));E.insertBefore(K,A)}var y=m(D.match[0],L);E.insertBefore(y,A);if(D.endNodeIndex<A.length){x=p.createTextNode(A.data.substring(D.endNodeIndex));E.insertBefore(x,A)}A.parentNode.removeChild(A);return y}K=p.createTextNode(z.data.substring(0,D.startNodeIndex));x=p.createTextNode(G.data.substring(D.endNodeIndex));var I=m(z.data.substring(D.startNodeIndex),L);var H=[];for(var C=0,B=D.innerNodes.length;C<B;++C){var M=D.innerNodes[C];var J=m(M.data,L);M.parentNode.replaceChild(J,M);H.push(J)}var F=m(G.data.substring(0,D.endNodeIndex),L);E=z.parentNode;E.insertBefore(K,z);E.insertBefore(I,z);E.removeChild(z);E=G.parentNode;E.insertBefore(F,G);E.insertBefore(x,G);E.removeChild(G);return F}}t=r(g);if(!t){return}if(o.global){while((h=o.exec(t))){j.push(q(h,u))}}else{h=t.match(o);j.push(q(h,u))}if(j.length){n=j.length;k(g,j,f(d))}return n}function a(g){var m=this,i=-1;function j(){var p={},s;s=tinymce.trim(g.selection.getContent({format:"text"}));function o(){q.statusbar.find("#next").disabled(!d(i+1).length);q.statusbar.find("#prev").disabled(!d(i-1).length)}function r(){g.windowManager.alert("Could not find the specified string.",function(){q.find("#find")[0].focus()})}var q=g.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){g.focus();m.done()},onSubmit:function(w){var v,t,x,u;w.preventDefault();t=q.find("#case").checked();u=q.find("#words").checked();x=q.find("#find").value();if(!x.length){m.done(false);q.statusbar.items().slice(1).disabled(true);return}if(p.text==x&&p.caseState==t&&p.wholeWord==u){if(d(i+1).length===0){r();return}m.next();o();return}v=m.find(x,t,u);if(!v){r()}q.statusbar.items().slice(1).disabled(v===0);o();p={text:x,caseState:t,wholeWord:u}},buttons:[{text:"Find",subtype:"primary",onclick:function(){q.submit()}},{text:"Replace",disabled:true,onclick:function(){if(!m.replace(q.find("#replace").value())){q.statusbar.items().slice(1).disabled(true);i=-1;p={}}}},{text:"Replace all",disabled:true,onclick:function(){m.replace(q.find("#replace").value(),true,true);q.statusbar.items().slice(1).disabled(true);p={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:true,onclick:function(){m.prev();o()}},{text:"Next",name:"next",disabled:true,onclick:function(){m.next();o()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:s},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}m.init=function(o){o.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:j,separator:"before",context:"edit"});o.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:j});o.addCommand("SearchReplace",j);o.shortcuts.add("Meta+F","",j)};function k(p){var o=p.getAttribute("data-mce-index");if(typeof o=="number"){return""+o}return o}function h(q){var p,o;o=g.dom.create("span",{"data-mce-bogus":1});o.className="mce-match-marker";p=g.getBody();m.done(false);return b(q,p,o,false,g.schema)}function f(p){var o=p.parentNode;if(p.firstChild){o.insertBefore(p.firstChild,p)}p.parentNode.removeChild(p)}function d(p){var o,r=[];o=tinymce.toArray(g.getBody().getElementsByTagName("span"));if(o.length){for(var q=0;q<o.length;q++){var s=k(o[q]);if(s===null||!s.length){continue}if(s===p.toString()){r.push(o[q])}}}return r}function l(o){var q=i,r=g.dom;o=o!==false;if(o){q++}else{q--}r.removeClass(d(i),"mce-match-marker-selected");var p=d(q);if(p.length){r.addClass(d(q),"mce-match-marker-selected");g.selection.scrollIntoView(p[0]);return q}return -1}function e(p){var q=g.dom,o=p.parentNode;q.remove(p);if(q.isEmpty(o)){q.remove(o)}}m.find=function(r,q,o){r=r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");r=o?"\\b"+r+"\\b":r;var p=h(new RegExp(r,q?"g":"gi"));if(p){i=-1;i=l(true)}return p};m.next=function(){var o=l(true);if(o!==-1){i=o}};m.prev=function(){var o=l(false);if(o!==-1){i=o}};function n(p){var o=k(p);return o!==null&&o.length>0}m.replace=function(y,v,x){var t,o,q,w,s,u=i,p;v=v!==false;q=g.getBody();o=tinymce.grep(tinymce.toArray(q.getElementsByTagName("span")),n);for(t=0;t<o.length;t++){var r=k(o[t]);w=s=parseInt(r,10);if(x||w===i){if(y.length){o[t].firstChild.nodeValue=y;f(o[t])}else{e(o[t])}while(o[++t]){w=parseInt(k(o[t]),10);if(w===s){e(o[t])}else{t--;break}}if(v){u--}}else{if(s>i){o[t].setAttribute("data-mce-index",s-1)}}}g.undoManager.add();i=u;if(v){p=d(u+1).length>0;m.next()}else{p=d(u-1).length>0;m.prev()}return !x&&p};m.done=function(q){var r,p,s,t;p=tinymce.toArray(g.getBody().getElementsByTagName("span"));for(r=0;r<p.length;r++){var u=k(p[r]);if(u!==null&&u.length){if(u===i.toString()){if(!s){s=p[r].firstChild}t=p[r].firstChild}f(p[r])}}if(s&&t){var o=g.dom.createRng();o.setStart(s,0);o.setEnd(t,t.data.length);if(q!==false){g.selection.setRng(o)}return o}}}tinymce.PluginManager.add("searchreplace",a)})();