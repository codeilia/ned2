tinymce.PluginManager.add("importcss",function(m){var p=this,l=tinymce.each;function n(a){var b=tinymce.Env.cacheSuffix;if(typeof a=="string"){a=a.replace("?"+b,"").replace("&"+b,"")}return a}function i(c){var b=m.settings,a=b.skin!==false?b.skin||"lightgray":false;if(a){var d=b.skin_url;if(d){d=m.documentBaseURI.toAbsolute(d)}else{d=tinymce.baseURL+"/skins/"+a}return c===d+"/content"+(m.inline?".inline":"")+".min.css"}return false}function o(a){if(typeof a=="string"){return function(b){return b.indexOf(a)!==-1}}else{if(a instanceof RegExp){return function(b){return a.test(b)}}}return a}function j(f,b){var c=[],d={};function e(g,h){var v=g.href,t;v=n(v);if(!v||!b(v,h)||i(v)){return}l(g.imports,function(q){e(q,true)});try{t=g.cssRules||g.rules}catch(u){}l(t,function(q){if(q.styleSheet){e(q.styleSheet,true)}else{if(q.selectorText){l(q.selectorText.split(","),function(r){c.push(tinymce.trim(r))})}}})}l(m.contentCSS,function(g){d[g]=true});if(!b){b=function(h,g){return g||d[h]}}try{l(f.styleSheets,function(g){e(g)})}catch(a){}return c}function k(a){var f;var d=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(a);if(!d){return}var e=d[1];var c=d[2].substr(1).split(".").join(" ");var b=tinymce.makeMap("a,img");if(d[1]){f={title:a};if(m.schema.getTextBlockElements()[e]){f.block=e}else{if(m.schema.getBlockElements()[e]||b[e.toLowerCase()]){f.selector=e}else{f.inline=e}}}else{if(d[2]){f={inline:"span",title:a.substr(1),classes:c}}}if(m.settings.importcss_merge_classes!==false){f.classes=c}else{f.attributes={"class":c}}return f}m.on("renderFormatsMenu",function(f){var b=m.settings,c={};var d=b.importcss_selector_converter||k;var g=o(b.importcss_selector_filter),a=f.control;if(!m.settings.importcss_append){a.items().remove()}var e=[];tinymce.each(b.importcss_groups,function(h){h=tinymce.extend({},h);h.filter=o(h.filter);e.push(h)});l(j(f.doc||m.getDoc(),o(b.importcss_file_filter)),function(z){if(z.indexOf(".mce-")===-1){if(!c[z]&&(!g||g(z))){var v=d.call(p,z),h;if(v){var w=v.name||tinymce.DOM.uniqueId();if(e){for(var y=0;y<e.length;y++){if(!e[y].filter||e[y].filter(z)){if(!e[y].item){e[y].item={text:e[y].title,menu:[]}}h=e[y].item.menu;break}}}m.formatter.register(w,v);var x=tinymce.extend({},a.settings.itemDefaults,{text:v.title,format:w});if(h){h.push(x)}else{a.add(x)}}c[z]=true}}});l(e,function(h){a.add(h.item)});f.control.renderNew()});p.convertSelectorToFormat=k});