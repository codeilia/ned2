tinymce.PluginManager.add("visualchars",function(j){var g=this,h;function i(v){var z,x,w,e=j.getBody(),d,B=j.selection,A,b;var c,y;c={"\u00a0":"nbsp","\u00ad":"shy"};function a(k){return'<span data-mce-bogus="1" class="mce-'+c[k]+'">'+k+"</span>"}function C(){var k,l="";for(k in c){l+=k}return new RegExp("["+l+"]","g")}function u(){var k,l="";for(k in c){if(l){l+=","}l+="span.mce-"+c[k]}return l}h=!h;g.state=h;j.fire("VisualChars",{state:h});y=C();if(v){b=B.getBookmark()}if(h){x=[];tinymce.walk(e,function(k){if(k.nodeType==3&&k.nodeValue&&y.test(k.nodeValue)){x.push(k)}},"childNodes");for(w=0;w<x.length;w++){d=x[w].nodeValue;d=d.replace(y,a);A=j.dom.create("div",null,d);while((z=A.lastChild)){j.dom.insertAfter(z,x[w])}j.dom.remove(x[w])}}else{x=j.dom.select(u(),e);for(w=x.length-1;w>=0;w--){j.dom.remove(x[w],1)}}B.moveToBookmark(b)}function f(){var a=this;j.on("VisualChars",function(b){a.active(b.state)})}j.addCommand("mceVisualChars",i);j.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:f});j.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:f,selectable:true,context:"view",prependToContext:true});j.on("beforegetcontent",function(a){if(h&&a.format!="raw"&&!a.draft){h=true;i(false)}})});