tinymce.PluginManager.add("template",function(n){var l=tinymce.each;function m(a){return function(){var b=n.settings.templates;if(typeof b=="function"){b(a);return}if(typeof b=="string"){tinymce.util.XHR.send({url:b,success:function(c){a(tinymce.util.JSON.parse(c))}})}else{a(b)}}}function j(b){var f,c=[],d;if(!b||b.length===0){var a=n.translate("No templates defined.");n.notificationManager.open({text:a,type:"info"});return}tinymce.each(b,function(g){c.push({selected:!c.length,text:g.title,value:{url:g.url,content:g.content,description:g.description}})});function e(g){var h=g.control.value();function r(w){if(w.indexOf("<html>")==-1){var q="";tinymce.each(n.contentCSS,function(s){q+='<link type="text/css" rel="stylesheet" href="'+n.documentBaseURI.toAbsolute(s)+'">'});var x=n.settings.body_class||"";if(x.indexOf("=")!=-1){x=n.getParam("body_class","","hash");x=x[n.id]||""}w=("<!DOCTYPE html><html><head>"+q+'</head><body class="'+x+'">'+w+"</body></html>")}w=o(w,"template_preview_replace_values");var v=f.find("iframe")[0].getEl().contentWindow.document;v.open();v.write(w);v.close()}if(h.url){tinymce.util.XHR.send({url:h.url,success:function(q){d=q;r(d)}})}else{d=h.content;r(d)}f.find("#description")[0].text(g.control.value().description)}f=n.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:c,onselect:e}}]},{type:"label",name:"description",label:"Description",text:"\u00a0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){p(false,d)},width:n.getParam("template_popup_width",600),height:n.getParam("template_popup_height",500)});f.find("listbox")[0].fire("select")}function i(d,a){var e="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var g="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var b="January February March April May June July August September October November December".split(" ");function c(h,t){h=""+h;if(h.length<t){for(var s=0;s<(t-h.length);s++){h="0"+h}}return h}a=a||new Date();d=d.replace("%D","%m/%d/%Y");d=d.replace("%r","%I:%M:%S %p");d=d.replace("%Y",""+a.getFullYear());d=d.replace("%y",""+a.getYear());d=d.replace("%m",c(a.getMonth()+1,2));d=d.replace("%d",c(a.getDate(),2));d=d.replace("%H",""+c(a.getHours(),2));d=d.replace("%M",""+c(a.getMinutes(),2));d=d.replace("%S",""+c(a.getSeconds(),2));d=d.replace("%I",""+((a.getHours()+11)%12+1));d=d.replace("%p",""+(a.getHours()<12?"AM":"PM"));d=d.replace("%B",""+n.translate(b[a.getMonth()]));d=d.replace("%b",""+n.translate(g[a.getMonth()]));d=d.replace("%A",""+n.translate(f[a.getDay()]));d=d.replace("%a",""+n.translate(e[a.getDay()]));d=d.replace("%%","%");return d}function k(b){var a=n.dom,c=n.getParam("template_replace_values");l(a.select("*",b),function(d){l(c,function(f,e){if(a.hasClass(d,e)){if(typeof c[e]=="function"){c[e](d)}}})})}function o(b,a){l(n.getParam(a),function(c,d){if(typeof c=="function"){c=c(d)}b=b.replace(new RegExp("\\{\\$"+d+"\\}","g"),c)});return b}function p(a,d){var c,f,g=n.dom,b=n.selection.getContent();d=o(d,"template_replace_values");c=g.create("div",null,d);f=g.select(".mceTmpl",c);if(f&&f.length>0){c=g.create("div",null);c.appendChild(f[0].cloneNode(true))}function e(h,s){return new RegExp("\\b"+s+"\\b","g").test(h.className)}l(g.select("*",c),function(h){if(e(h,n.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))){h.innerHTML=i(n.getParam("template_cdate_format",n.getLang("template.cdate_format")))}if(e(h,n.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){h.innerHTML=i(n.getParam("template_mdate_format",n.getLang("template.mdate_format")))}if(e(h,n.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))){h.innerHTML=b}});k(c);n.execCommand("mceInsertContent",false,c.innerHTML);n.addVisual()}n.addCommand("mceInsertTemplate",p);n.addButton("template",{title:"Insert template",onclick:m(j)});n.addMenuItem("template",{text:"Insert template",onclick:m(j),context:"insert"});n.on("PreProcess",function(a){var b=n.dom;l(b.select("div",a.node),function(c){if(b.hasClass(c,"mceTmpl")){l(b.select("*",c),function(d){if(b.hasClass(d,n.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){d.innerHTML=i(n.getParam("template_mdate_format",n.getLang("template.mdate_format")))}});k(c)}})})});