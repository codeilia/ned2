tinymce.PluginManager.add("lists",function(d){var i=this;function h(j){return d.$.contains(d.getBody(),j)}function f(j){return j&&j.nodeName=="BR"}function a(j){return j&&(/^(OL|UL|DL)$/).test(j.nodeName)&&h(j)}function c(j){return j.parentNode.firstChild==j}function b(j){return j.parentNode.lastChild==j}function g(j){return j&&!!d.schema.getTextBlockElements()[j.nodeName]}function e(j){return j===d.getBody()}d.on("init",function(){var x=d.dom,D=d.selection;function t(G,F){var E=x.isEmpty(G);if(F&&x.select("span[data-mce-type=bookmark]").length>0){return false}return E}function p(E){var F={};function G(K){var I,H,J;H=E[K?"startContainer":"endContainer"];J=E[K?"startOffset":"endOffset"];if(H.nodeType==1){I=x.create("span",{"data-mce-type":"bookmark"});if(H.hasChildNodes()){J=Math.min(J,H.childNodes.length-1);if(K){H.insertBefore(I,H.childNodes[J])}else{x.insertAfter(I,H.childNodes[J])}}else{H.appendChild(I)}H=I;J=0}F[K?"startContainer":"endContainer"]=H;F[K?"startOffset":"endOffset"]=J}G(true);if(!E.collapsed){G()}return F}function l(F){function G(L){var H,J,I;function K(N){var O=N.parentNode.firstChild,M=0;while(O){if(O==N){return M}if(O.nodeType!=1||O.getAttribute("data-mce-type")!="bookmark"){M++}O=O.nextSibling}return -1}H=I=F[L?"startContainer":"endContainer"];J=F[L?"startOffset":"endOffset"];if(!H){return}if(H.nodeType==1){J=K(H);H=H.parentNode;x.remove(I)}F[L?"startContainer":"endContainer"]=H;F[L?"startOffset":"endOffset"]=J}G(true);G();var E=x.createRng();E.setStart(F.startContainer,F.startOffset);if(F.endContainer){E.setEnd(F.endContainer,F.endOffset)}D.setRng(E)}function j(E,I){var K,F,H=x.createFragment(),G;var J=d.schema.getBlockElements();if(d.settings.forced_root_block){I=I||d.settings.forced_root_block}if(I){F=x.create(I);if(F.tagName===d.settings.forced_root_block){x.setAttribs(F,d.settings.forced_root_block_attrs)}H.appendChild(F)}if(E){while((K=E.firstChild)){var L=K.nodeName;if(!G&&(L!="SPAN"||K.getAttribute("data-mce-type")!="bookmark")){G=true}if(J[L]){H.appendChild(K);F=null}else{if(I){if(!F){F=x.create(I);H.appendChild(F)}F.appendChild(K)}else{H.appendChild(K)}}}}if(!d.settings.forced_root_block){H.appendChild(x.create("br"))}else{if(!G&&(!tinymce.Env.ie||tinymce.Env.ie>10)){F.appendChild(x.create("br",{"data-mce-bogus":"1"}))}}return H}function B(){return tinymce.grep(D.getSelectedBlocks(),function(E){return/^(LI|DT|DD)$/.test(E.nodeName)})}function w(H,E,L){var G,F,I,J;function K(M){tinymce.each(I,function(N){M.parentNode.insertBefore(N,E.parentNode)});x.remove(M)}I=x.select('span[data-mce-type="bookmark"]',H);L=L||j(E);G=x.createRng();G.setStartAfter(E);G.setEndAfter(H);F=G.extractContents();for(J=F.firstChild;J;J=J.firstChild){if(J.nodeName=="LI"&&x.isEmpty(J)){x.remove(J);break}}if(!x.isEmpty(F)){x.insertAfter(F,H)}x.insertAfter(L,H);if(t(E.parentNode)){K(E.parentNode)}x.remove(E);if(t(H)){x.remove(H)}}var v=function(E,H){var F=d.dom.getStyle(E,"list-style-type",true);var G=d.dom.getStyle(H,"list-style-type",true);return F===G};function C(E){var F,G;F=E.nextSibling;if(F&&a(F)&&F.nodeName==E.nodeName&&v(E,F)){while((G=F.firstChild)){E.appendChild(G)}x.remove(F)}F=E.previousSibling;if(F&&a(F)&&F.nodeName==E.nodeName&&v(E,F)){while((G=F.firstChild)){E.insertBefore(G,E.firstChild)}x.remove(F)}}function m(E){tinymce.each(tinymce.grep(x.select("ol,ul",E)),function(G){var H,F=G.parentNode;if(F.nodeName=="LI"&&F.firstChild==G){H=F.previousSibling;if(H&&H.nodeName=="LI"){H.appendChild(G);if(t(F)){x.remove(F)}}}if(a(F)){H=F.previousSibling;if(H&&H.nodeName=="LI"){H.appendChild(G)}}})}function s(F){var G=F.parentNode,E=G.parentNode,I;function H(J){if(t(J)){x.remove(J)}}if(e(G)){return true}if(F.nodeName=="DD"){x.rename(F,"DT");return true}if(c(F)&&b(F)){if(E.nodeName=="LI"){x.insertAfter(F,E);H(E);x.remove(G)}else{if(a(E)){x.remove(G,true)}else{E.insertBefore(j(F),G);x.remove(G)}}return true}else{if(c(F)){if(E.nodeName=="LI"){x.insertAfter(F,E);F.appendChild(G);H(E)}else{if(a(E)){E.insertBefore(F,G)}else{E.insertBefore(j(F),G);x.remove(F)}}return true}else{if(b(F)){if(E.nodeName=="LI"){x.insertAfter(F,E)}else{if(a(E)){x.insertAfter(F,G)}else{x.insertAfter(j(F),G);x.remove(F)}}return true}}}if(E.nodeName=="LI"){G=E;I=j(F,"LI")}else{if(a(E)){I=j(F,"LI")}else{I=j(F)}}w(G,F,I);m(G.parentNode);return true}function r(E){var G,F,I;function H(L,K){var J;if(a(L)){while((J=E.lastChild.firstChild)){K.appendChild(J)}x.remove(L)}}if(E.nodeName=="DT"){x.rename(E,"DD");return true}G=E.previousSibling;if(G&&a(G)){G.appendChild(E);return true}if(G&&G.nodeName=="LI"&&a(G.lastChild)){G.lastChild.appendChild(E);H(E.lastChild,G.lastChild);return true}G=E.nextSibling;if(G&&a(G)){G.insertBefore(E,G.firstChild);return true}G=E.previousSibling;if(G&&G.nodeName=="LI"){F=x.create(E.parentNode.nodeName);I=x.getStyle(E.parentNode,"listStyleType");if(I){x.setStyle(F,"listStyleType",I)}G.appendChild(F);F.appendChild(E);H(E.lastChild,F);return true}return false}function u(){var F=B();if(F.length){var G=p(D.getRng(true));for(var E=0;E<F.length;E++){if(!r(F[E])&&E===0){break}}l(G);d.nodeChanged();return true}}function o(){var G=B();if(G.length){var H=p(D.getRng(true));var F,J,E=d.getBody();F=G.length;while(F--){var I=G[F].parentNode;while(I&&I!=E){J=G.length;while(J--){if(G[J]===I){G.splice(F,1);break}}I=I.parentNode}}for(F=0;F<G.length;F++){if(!s(G[F])&&F===0){break}}l(H);d.nodeChanged();return true}}function y(G,J){var F=D.getRng(true),I,H="LI";if(x.getContentEditable(D.getNode())==="false"){return}G=G.toUpperCase();if(G=="DL"){H="DT"}function E(){var P=[],L=d.getBody();function N(U){var S,T;S=F[U?"startContainer":"endContainer"];T=F[U?"startOffset":"endOffset"];if(S.nodeType==1){S=S.childNodes[Math.min(T,S.childNodes.length-1)]||S}while(S.parentNode!=L){if(g(S)){return S}if(/^(TD|TH)$/.test(S.parentNode.nodeName)){return S}S=S.parentNode}return S}var M=N(true);var K=N();var R,Q=[];for(var O=M;O;O=O.nextSibling){Q.push(O);if(O==K){break}}tinymce.each(Q,function(S){if(g(S)){P.push(S);R=null;return}if(x.isBlock(S)||f(S)){if(f(S)){x.remove(S)}R=null;return}var T=S.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(S)){if(g(T)||(!T&&S.parentNode==L)){R=null;return}}if(!R){R=x.create("p");S.parentNode.insertBefore(R,S);P.push(R)}R.appendChild(S)});return P}I=p(F);tinymce.each(E(),function(N){var L,M;var K=function(O){var P=x.getStyle(O,"list-style-type");var Q=J?J["list-style-type"]:"";Q=Q===null?"":Q;return P===Q};M=N.previousSibling;if(M&&a(M)&&M.nodeName==G&&K(M)){L=M;N=x.rename(N,H);M.appendChild(N)}else{L=x.create(G);N.parentNode.insertBefore(L,N);L.appendChild(N);N=x.rename(N,H)}q(L,J);C(L)});l(I)}var q=function(F,E){x.setStyle(F,"list-style-type",E?E["list-style-type"]:null)};function z(){var F=p(D.getRng(true)),E=d.getBody();tinymce.each(B(),function(G){var I,H;if(e(G.parentNode)){return}if(t(G)){s(G);return}for(I=G;I&&I!=E;I=I.parentNode){if(a(I)){H=I}}w(H,G)});l(F)}function n(F,H){var E=x.getParent(D.getStart(),"OL,UL,DL");if(e(E)){return}if(E){if(E.nodeName==F){z(F)}else{var G=p(D.getRng(true));q(E,H);C(x.rename(E,F));l(G)}}else{y(F,H)}}function k(E){return function(){var F=x.getParent(d.selection.getStart(),"UL,OL,DL");return F&&F.nodeName==E}}function A(E){if(!f(E)){return false}if(x.isBlock(E.nextSibling)&&!f(E.previousSibling)){return true}return false}i.backspaceDelete=function(J){function K(N,P){var O=N.startContainer,R=N.startOffset;var M,Q;if(O.nodeType==3&&(P?R<O.data.length:R>0)){return O}M=d.schema.getNonEmptyElements();if(O.nodeType==1){O=tinymce.dom.RangeUtils.getNode(O,R)}Q=new tinymce.dom.TreeWalker(O,d.getBody());if(P){if(A(O)){Q.next()}}while((O=Q[P?"next":"prev2"]())){if(O.nodeName=="LI"&&!O.hasChildNodes()){return O}if(M[O.nodeName]){return O}if(O.nodeType==3&&O.data.length>0){return O}}}function L(N,Q){var P,O,M=N.parentNode;if(!h(N)||!h(Q)){return}if(a(Q.lastChild)){O=Q.lastChild}if(M==Q.lastChild){if(f(M.previousSibling)){x.remove(M.previousSibling)}}P=Q.lastChild;if(P&&f(P)&&N.hasChildNodes()){x.remove(P)}if(t(Q,true)){x.$(Q).empty()}if(!t(N,true)){while((P=N.firstChild)){Q.appendChild(P)}}if(O){Q.appendChild(O)}x.remove(N);if(t(M)&&!e(M)){x.remove(M)}}if(D.isCollapsed()){var E=x.getParent(D.getStart(),"LI"),H,G,F;if(E){H=E.parentNode;if(e(H)&&x.isEmpty(H)){return true}G=D.getRng(true);F=x.getParent(K(G,J),"LI");if(F&&F!=E){var I=p(G);if(J){L(F,E)}else{L(E,F)}l(I);return true}else{if(!F){if(!J&&z(H.nodeName)){return true}}}}}};d.on("BeforeExecCommand",function(G){var F=G.command.toLowerCase(),E;if(F=="indent"){if(u()){E=true}}else{if(F=="outdent"){if(o()){E=true}}}if(E){d.fire("ExecCommand",{command:G.command});G.preventDefault();return true}});d.addCommand("InsertUnorderedList",function(F,E){n("UL",E)});d.addCommand("InsertOrderedList",function(F,E){n("OL",E)});d.addCommand("InsertDefinitionList",function(F,E){n("DL",E)});d.addQueryStateHandler("InsertUnorderedList",k("UL"));d.addQueryStateHandler("InsertOrderedList",k("OL"));d.addQueryStateHandler("InsertDefinitionList",k("DL"));d.on("keydown",function(E){if(E.keyCode!=9||tinymce.util.VK.metaKeyPressed(E)){return}if(d.dom.getParent(d.selection.getStart(),"LI,DT,DD")){E.preventDefault();if(E.shiftKey){o()}else{u()}}})});d.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var j=this;d.on("nodechange",function(){var p=d.selection.getSelectedBlocks();var n=false;for(var o=0,m=p.length;!n&&o<m;o++){var k=p[o].nodeName;n=(k=="LI"&&c(p[o])||k=="UL"||k=="OL"||k=="DD")}j.disabled(n)})}});d.on("keydown",function(j){if(j.keyCode==tinymce.util.VK.BACKSPACE){if(i.backspaceDelete()){j.preventDefault()}}else{if(j.keyCode==tinymce.util.VK.DELETE){if(i.backspaceDelete(true)){j.preventDefault()}}}})});