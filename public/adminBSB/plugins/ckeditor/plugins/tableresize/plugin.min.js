(function(){function h(i){return CKEDITOR.env.ie?i.$.clientWidth:parseInt(i.getComputedStyle("width"),10)}function e(j,k){var i=j.getComputedStyle("border-"+k+"-width"),l={thin:"0px",medium:"1px",thick:"2px"};0>i.indexOf("px")&&(i=i in l&&"none"!=j.getComputedStyle("border-style")?l[i]:0);return parseInt(i,10)}function b(A){var s=[],z=-1,x="rtl"==A.getComputedStyle("direction"),v;v=A.$.rows;for(var o=0,u,y,w,r=0,B=v.length;r<B;r++){w=v[r],u=w.cells.length,u>o&&(o=u,y=w)}v=y;o=new CKEDITOR.dom.element(A.$.tBodies[0]);u=o.getDocumentPosition();y=0;for(w=v.cells.length;y<w;y++){var r=new CKEDITOR.dom.element(v.cells[y]),B=v.cells[y+1]&&new CKEDITOR.dom.element(v.cells[y+1]),z=z+(r.$.colSpan||1),j,q,i=r.getDocumentPosition().x;x?q=i+e(r,"left"):j=i+r.$.offsetWidth-e(r,"right");B?(i=B.getDocumentPosition().x,x?j=i+B.$.offsetWidth-e(B,"right"):q=i+e(B,"left")):(i=A.getDocumentPosition().x,x?j=i:q=i+A.$.offsetWidth);r=Math.max(q-j,3);s.push({table:A,index:z,x:j,y:u.y,width:r,height:o.$.offsetHeight,rtl:x})}return s}function g(i){(i.data||i).preventDefault()}function f(F){function u(){s=0;y.setOpacity(0);q&&E();var k=w.table;setTimeout(function(){k.removeCustomData("_cke_table_pillars")},0);A.removeListener("dragstart",g)}function E(){for(var n=w.rtl,t=n?l.length:o.length,m=0,C=0;C<t;C++){var v=o[C],B=l[C],p=w.table;CKEDITOR.tools.setTimeout(function(L,J,K,I,D,k){L&&L.setStyle("width",c(Math.max(J+k,1)));K&&K.setStyle("width",c(Math.max(I-k,1)));D&&p.setStyle("width",c(D+k*(n?-1:1)));++m==t&&F.fire("saveSnapshot")},0,this,[v,v&&h(v),B,B&&h(B),(!v||!B)&&h(p)+e(p,"left")+e(p,"right"),q])}}function z(I){g(I);F.fire("saveSnapshot");I=w.index;for(var B=CKEDITOR.tools.buildTableMap(w.table),C=[],t=[],p=Number.MAX_VALUE,k=p,D=w.rtl,J=0,n=B.length;J<n;J++){var m=B[J],K=m[I+(D?1:0)],m=m[I+(D?0:1)],K=K&&new CKEDITOR.dom.element(K),m=m&&new CKEDITOR.dom.element(m);K&&m&&K.equals(m)||(K&&(p=Math.min(p,h(K))),m&&(k=Math.min(k,h(m))),C.push(K),t.push(m))}o=C;l=t;j=w.x-p;i=w.x+k;y.setOpacity(0.5);H=parseInt(y.getStyle("left"),10);q=0;s=1;y.on("mousemove",r);A.on("dragstart",g);A.on("mouseup",x,this)}function x(k){k.removeListener();u()}function r(k){G(k.data.getPageOffset().x)}var w,A,y,s,H,q,o,l,j,i;A=F.document;y=CKEDITOR.dom.element.createFromHtml('\x3cdiv data-cke-temp\x3d1 contenteditable\x3dfalse unselectable\x3don style\x3d"position:absolute;cursor:col-resize;filter:alpha(opacity\x3d0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"\x3e\x3c/div\x3e',A);F.on("destroy",function(){y.remove()});a||A.getDocumentElement().append(y);this.attachTo=function(k){s||(a&&(A.getBody().append(y),q=0),w=k,y.setStyles({width:c(k.width),height:c(k.height),left:c(k.x),top:c(k.y)}),a&&y.setOpacity(0.25),y.on("mousedown",z,this),A.getBody().setStyle("cursor","col-resize"),y.show())};var G=this.move=function(k){if(!w){return 0}if(!s&&(k<w.x||k>w.x+w.width)){return w=null,s=q=0,A.removeListener("mouseup",x),y.removeListener("mousedown",z),y.removeListener("mousemove",r),A.getBody().setStyle("cursor","auto"),a?y.remove():y.hide(),0}k-=Math.round(y.$.offsetWidth/2);if(s){if(k==j||k==i){return 1}k=Math.max(k,j);k=Math.min(k,i);q=k-H}y.setStyle("left",c(k));return 1}}function d(j){var k=j.data.getTarget();if("mouseout"==j.name){if(!k.is("table")){return}for(var i=new CKEDITOR.dom.element(j.data.$.relatedTarget||j.data.$.toElement);i&&i.$&&!i.equals(k)&&!i.is("body");){i=i.getParent()}if(!i||i.equals(k)){return}}k.getAscendant("table",1).removeCustomData("_cke_table_pillars");j.removeListener()}var c=CKEDITOR.tools.cssLength,a=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(i){i.on("contentDom",function(){var k,j=i.editable();j.attachListener(j.isInline()?j:i.document,"mousemove",function(o){o=o.data;var n=o.getTarget();if(n.type==CKEDITOR.NODE_ELEMENT){var l=o.getPageOffset().x;if(k&&k.move(l)){g(o)}else{if(n.is("table")||n.getAscendant("tbody",1)){if(n=n.getAscendant("table",1),i.editable().contains(n)){(o=n.getCustomData("_cke_table_pillars"))||(n.setCustomData("_cke_table_pillars",o=b(n)),n.on("mouseout",d),n.on("mousedown",d));i:{for(var n=0,m=o.length;n<m;n++){var p=o[n];if(l>=p.x&&l<=p.x+p.width){l=p;break i}}l=null}l&&(!k&&(k=new f(i)),k.attachTo(l))}}}}})})}})})();