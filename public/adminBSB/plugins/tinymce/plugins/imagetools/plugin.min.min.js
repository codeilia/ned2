!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;s>q;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;r>h;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};k("1",tinymce.PluginManager),k("2",tinymce.Env),k("3",tinymce.util.Promise),k("4",tinymce.util.URI),k("5",tinymce.util.Tools),k("6",tinymce.util.Delay),l("m",[],function(){function f(d,c){return g(document.createElement("canvas"),d,c)}function e(b){return b.getContext("2d")}function h(q){var d=null;try{d=q.getContext("webgl")||q.getContext("experimental-webgl")}catch(r){}return d||(d=null),d}function g(q,d,r){return q.width=d,q.height=r,q}return{create:f,resize:g,get2dContext:e,get3dContext:h}}),l("n",[],function(){function d(b){return b.naturalWidth||b.width}function c(b){return b.naturalHeight||b.height}return{getWidth:d,getHeight:c}}),l("o",[],function(){function z(d,c){return function(){d.apply(c,arguments)}}function y(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],s(a,z(w,this),z(v,this))}function x(d){var c=this;return null===this._state?void this._deferreds.push(d):void r(function(){var f=c._state?d.onFulfilled:d.onRejected;if(null===f){return void (c._state?d.resolve:d.reject)(c._value)}var b;try{b=f(c._value)}catch(a){return void d.reject(a)}d.resolve(b)})}function w(a){try{if(a===this){throw new TypeError("A promise cannot be resolved with itself.")}if(a&&("object"==typeof a||"function"==typeof a)){var e=a.then;if("function"==typeof e){return void s(z(e,a),z(w,this),z(v,this))}}this._state=!0,this._value=a,u.call(this)}catch(d){v.call(this,d)}}function v(b){this._state=!1,this._value=b,u.call(this)}function u(){for(var d=0,c=this._deferreds.length;c>d;d++){x.call(this,this._deferreds[d])}this._deferreds=null}function t(f,e,h,g){this.onFulfilled="function"==typeof f?f:null,this.onRejected="function"==typeof e?e:null,this.resolve=h,this.reject=g}function s(g,f,B){var A=!1;try{g(function(b){A||(A=!0,f(b))},function(b){A||(A=!0,B(b))})}catch(h){if(A){return}A=!0,B(h)}}if(window.Promise){return window.Promise}var r=y.immediateFn||"function"==typeof setImmediate&&setImmediate||function(b){setTimeout(b,1)},q=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)};return y.prototype["catch"]=function(b){return this.then(null,b)},y.prototype.then=function(b,f){var c=this;return new y(function(a,d){x.call(c,new t(b,f,a,d))})},y.all=function(){var b=Array.prototype.slice.call(1===arguments.length&&q(arguments[0])?arguments[0]:arguments);return new y(function(a,B){function A(C,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var d=e.then;if("function"==typeof d){return void d.call(e,function(f){A(C,f)},B)}}b[C]=e,0===--h&&a(b)}catch(c){B(c)}}if(0===b.length){return a([])}for(var h=b.length,g=0;g<b.length;g++){A(g,b[g])}})},y.resolve=function(b){return b&&"object"==typeof b&&b.constructor===y?b:new y(function(a){a(b)})},y.reject=function(b){return new y(function(a,d){d(b)})},y.race=function(b){return new y(function(a,h){for(var g=0,f=b.length;f>g;g++){b[g].then(a,h)}})},y}),l("p",[],function(){function d(f){var e=document.createElement("a");return e.href=f,e.pathname}function c(a){var h=d(a).split("."),g=h[h.length-1],f={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return g&&(g=g.toLowerCase()),f[g]}return{guessMimeType:c}}),l("e",["o","m","p","n"],function(E,D,C,B){function A(a){return new E(function(b){function d(){a.removeEventListener("load",d),b(a)}a.complete?b(a):a.addEventListener("load",d)})}function z(b){return A(b).then(function(d){var g,f;return f=D.create(B.getWidth(d),B.getHeight(d)),g=D.get2dContext(f),g.drawImage(d,0,0),f})}function y(b){return A(b).then(function(d){var c=d.src;return 0===c.indexOf("blob:")?w(c):0===c.indexOf("data:")?v(c):z(d).then(function(e){return v(e.toDataURL(C.guessMimeType(c)))})})}function x(a){return new E(function(b){function f(){e.removeEventListener("load",f),b(e)}var e=new Image;e.addEventListener("load",f),e.src=URL.createObjectURL(a),e.complete&&f()})}function w(a){return new E(function(b){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="blob",d.onload=function(){200==this.status&&b(this.response)},d.send()})}function v(a){return new E(function(b){var K,J,I,H,G,F;if(a=a.split(","),H=/data:([^;]+)/.exec(a[0]),H&&(G=H[1]),K=atob(a[1]),window.WebKitBlobBuilder){for(F=new WebKitBlobBuilder,J=new ArrayBuffer(K.length),I=0;I<J.length;I++){J[I]=K.charCodeAt(I)}return F.append(J),void b(F.getBlob(G))}for(J=new Uint8Array(K.length),I=0;I<J.length;I++){J[I]=K.charCodeAt(I)}b(new Blob([J],{type:G}))})}function u(b){return 0===b.indexOf("blob:")?w(b):0===b.indexOf("data:")?v(b):null}function t(d,c){return v(d.toDataURL(c))}function s(a){return new E(function(b){var d=new FileReader;d.onloadend=function(){b(d.result)},d.readAsDataURL(a)})}function r(b){return s(b).then(function(c){return c.split(",")[1]})}function q(b){URL.revokeObjectURL(b.src)}return{blobToImage:x,imageToBlob:y,blobToDataUri:s,blobToBase64:r,imageToCanvas:z,canvasToBlob:t,revokeImageUrl:q,uriToBlob:u}}),l("q",[],function(){function B(e,d,f){return e=parseFloat(e),e>f?e=f:d>e&&(e=d),e}function A(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function z(D,C){var J,I,H,G,F=[],E=new Array(10);for(J=0;5>J;J++){for(I=0;5>I;I++){F[I]=C[I+5*J]}for(I=0;5>I;I++){for(G=0,H=0;5>H;H++){G+=D[I+5*H]*F[H]}E[I+5*J]=G}}return E}function y(a,d){return d=B(d,0,1),a.map(function(c,e){return e%6===0?c=1-(1-c)*d:c*=d,B(c,0,1)})}function x(a,f){var c;return f=B(f,-1,1),f*=100,0>f?c=127+f/100*127:(c=f%1,c=0===c?q[f]:q[Math.floor(f)]*(1-c)+q[Math.floor(f)+1]*c,c=127*c+127),z(a,[c/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])}function w(a,F){var E,D,C,c;return F=B(F,-1,1),E=1+(F>0?3*F:F),D=0.3086,C=0.6094,c=0.082,z(a,[D*(1-E)+E,C*(1-E),c*(1-E),0,0,D*(1-E),C*(1-E)+E,c*(1-E),0,0,D*(1-E),C*(1-E),c*(1-E)+E,0,0,0,0,0,1,0,0,0,0,0,1])}function v(a,G){var F,E,D,C,c;return G=B(G,-180,180)/180*Math.PI,F=Math.cos(G),E=Math.sin(G),D=0.213,C=0.715,c=0.072,z(a,[D+F*(1-D)+E*-D,C+F*-C+E*-C,c+F*-c+E*(1-c),0,0,D+F*-D+0.143*E,C+F*(1-C)+0.14*E,c+F*-c+E*-0.283,0,0,D+F*-D+E*-(1-D),C+F*-C+E*C,c+F*(1-c)+E*c,0,0,0,0,0,1,0,0,0,0,0,1])}function u(a,c){return c=B(255*c,-255,255),z(a,[1,0,0,0,c,0,1,0,0,c,0,0,1,0,c,0,0,0,1,0,0,0,0,0,1])}function t(a,h,g,c){return h=B(h,0,2),g=B(g,0,2),c=B(c,0,2),z(a,[h,0,0,0,0,0,g,0,0,0,0,0,c,0,0,0,0,0,1,0,0,0,0,0,1])}function s(a,c){return c=B(c,0,1),z(a,y([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],c))}function r(a,c){return c=B(c,0,1),z(a,y([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],c))}var q=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:A,adjust:y,multiply:z,adjustContrast:x,adjustBrightness:u,adjustSaturation:w,adjustHue:v,adjustColors:t,adjustSepia:s,adjustGrayscale:r}}),l("c",["m","n","e","q"],function(A,z,y,x){function w(b,a){return y.blobToImage(b).then(function(D){function C(af,ae){var ad,ac,ab,aa,Z,Y=af.data,X=ae[0],W=ae[1],V=ae[2],U=ae[3],T=ae[4],S=ae[5],R=ae[6],Q=ae[7],O=ae[8],M=ae[9],L=ae[10],K=ae[11],J=ae[12],I=ae[13],H=ae[14],G=ae[15],F=ae[16],E=ae[17],P=ae[18],N=ae[19];for(Z=0;Z<Y.length;Z+=4){ad=Y[Z],ac=Y[Z+1],ab=Y[Z+2],aa=Y[Z+3],Y[Z]=ad*X+ac*W+ab*V+aa*U+T,Y[Z+1]=ad*S+ac*R+ab*Q+aa*O+M,Y[Z+2]=ad*L+ac*K+ab*J+aa*I+H,Y[Z+3]=ad*G+ac*F+ab*E+aa*P+N}return af}var B,e=A.create(z.getWidth(D),z.getHeight(D)),c=A.get2dContext(e);return c.drawImage(D,0,0),q(D),B=C(c.getImageData(0,0,e.width,e.height),a),c.putImageData(B,0,0),y.canvasToBlob(e)})}function v(b,a){return y.blobToImage(b).then(function(E){function D(Z,Y,X){function W(f,d,g){return f>g?f=g:d>f&&(f=d),f}var V,U,T,S,R,Q,P,O,N,M,L,K,J,I,H,G,F;for(T=Math.round(Math.sqrt(X.length)),S=Math.floor(T/2),V=Z.data,U=Y.data,G=Z.width,F=Z.height,Q=0;F>Q;Q++){for(R=0;G>R;R++){for(P=O=N=0,L=0;T>L;L++){for(M=0;T>M;M++){K=W(R+M-S,0,G-1),J=W(Q+L-S,0,F-1),I=4*(J*G+K),H=X[L*T+M],P+=V[I]*H,O+=V[I+1]*H,N+=V[I+2]*H}}I=4*(Q*G+R),U[I]=W(P,0,255),U[I+1]=W(O,0,255),U[I+2]=W(N,0,255)}}return Y}var C,B,e=A.create(z.getWidth(E),z.getHeight(E)),c=A.get2dContext(e);return c.drawImage(E,0,0),q(E),C=c.getImageData(0,0,e.width,e.height),B=c.getImageData(0,0,e.width,e.height),B=D(C,B,a),c.putImageData(B,0,0),y.canvasToBlob(e)})}function u(a){return function(c,b){return y.blobToImage(c).then(function(F){function E(g,e){var G,h=g.data;for(G=0;G<h.length;G+=4){h[G]=e[h[G]],h[G+1]=e[h[G+1]],h[G+2]=e[h[G+2]]}return g}var D,C,B=A.create(z.getWidth(F),z.getHeight(F)),f=A.get2dContext(B),d=new Array(256);for(C=0;C<d.length;C++){d[C]=a(C,b)}return f.drawImage(F,0,0),q(F),D=E(f.getImageData(0,0,B.width,B.height),d),f.putImageData(D,0,0),y.canvasToBlob(B)})}}function t(b){return function(a,d){return w(a,b(x.identity(),d))}}function s(b){return function(a){return w(a,b)}}function r(b){return function(a){return v(a,b)}}var q=y.revokeImageUrl;return{invert:s([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:t(x.adjustBrightness),hue:t(x.adjustHue),saturate:t(x.adjustSaturation),contrast:t(x.adjustContrast),grayscale:t(x.adjustGrayscale),sepia:t(x.adjustSepia),colorize:function(e,d,h,g){return w(e,x.adjustColors(x.identity(),d,h,g))},sharpen:r([0,-1,0,-1,5,-1,0,-1,0]),emboss:r([-2,-1,0,-1,1,1,0,1,2]),gamma:u(function(d,c){return 255*Math.pow(d/255,1-c)}),exposure:u(function(d,c){return 255*(1-Math.exp(-(d/255)*c))}),colorFilter:w,convoluteFilter:v}}),l("r",["o","e","m","n"],function(h,g,t,s){function r(z,y,x){var w=s.getWidth(z),v=s.getHeight(z),u=y/w,f=x/v,e=!1;(0.5>u||u>2)&&(u=0.5>u?0.5:2,e=!0),(0.5>f||f>2)&&(f=0.5>f?0.5:2,e=!0);var d=q(z,u,f);return e?d.then(function(b){return r(b,y,x)}):d}function q(a,d,c){return new h(function(e){var x=s.getWidth(a),w=s.getHeight(a),v=Math.floor(x*d),u=Math.floor(w*c),f=t.create(v,u),b=t.get2dContext(f);b.drawImage(a,0,0,x,w,0,0,v,u),e(f)})}return{scale:r}}),l("d",["e","m","n","r"],function(z,y,x,w){function v(b,a){return z.blobToImage(b).then(function(B){var A=y.create(x.getWidth(B),x.getHeight(B)),e=y.get2dContext(A),d=0,c=0;return a=0>a?360+a:a,90!=a&&270!=a||y.resize(A,A.height,A.width),90!=a&&180!=a||(d=A.width),270!=a&&180!=a||(c=A.height),e.translate(d,c),e.rotate(a*Math.PI/180),e.drawImage(B,0,0),r(B),z.canvasToBlob(A,b.type)})}function u(b,a){return z.blobToImage(b).then(function(h){var e=y.create(x.getWidth(h),x.getHeight(h)),c=y.get2dContext(e);return"v"==a?(c.scale(1,-1),c.drawImage(h,0,-e.height)):(c.scale(-1,1),c.drawImage(h,-e.width,0)),r(h),z.canvasToBlob(e)})}function t(B,A,h,b,a){return z.blobToImage(B).then(function(f){var e=y.create(b,a),d=y.get2dContext(e);return d.drawImage(f,-A,-h),r(f),z.canvasToBlob(e)})}function s(a,f,d){return z.blobToImage(a).then(function(c){var b;return b=w.scale(c,f,d).then(function(e){return z.canvasToBlob(e,a.type)}).then(q(c))["catch"](q(c))})}var r=z.revokeImageUrl,q=function(b){return function(a){return r(b),a}};return{rotate:v,flip:u,crop:t,resize:s}}),l("7",["c","d"],function(J,I){var H=function(a){return J.invert(a)},G=function(a){return J.sharpen(a)},F=function(a){return J.emboss(a)},E=function(a,d){return J.gamma(a,d)},D=function(a,d){return J.exposure(a,d)},C=function(a,h,g,f){return J.colorize(a,h,g,f)},B=function(a,d){return J.brightness(a,d)},A=function(a,d){return J.hue(a,d)},z=function(a,d){return J.saturate(a,d)},y=function(a,d){return J.contrast(a,d)},x=function(a,d){return J.grayscale(a,d)},w=function(a,d){return J.sepia(a,d)},v=function(b,d){return I.flip(b,d)},u=function(b,r,q,h,g){return I.crop(b,r,q,h,g)},t=function(b,f,e){return I.resize(b,f,e)},s=function(b,d){return I.rotate(b,d)};return{invert:H,sharpen:G,emboss:F,brightness:B,hue:A,saturate:z,contrast:y,grayscale:x,sepia:w,colorize:C,gamma:E,exposure:D,flip:v,crop:u,resize:t,rotate:s}}),l("8",["e"],function(g){var f=function(a){return g.blobToImage(a)},r=function(a){return g.imageToBlob(a)},q=function(a){return g.blobToDataUri(a)},h=function(a){return g.blobToBase64(a)};return{blobToImage:f,imageToBlob:r,blobToDataUri:q,blobToBase64:h}}),k("f",tinymce.dom.DOMUtils),k("g",tinymce.ui.Factory),k("h",tinymce.ui.Form),k("i",tinymce.ui.Container),k("s",tinymce.ui.Control),k("t",tinymce.ui.DragHelper),k("u",tinymce.geom.Rect),k("w",tinymce.dom.DomQuery),k("x",tinymce.util.Observable),k("y",tinymce.util.VK),l("v",["w","t","u","5","x","y"],function(q,h,v,u,t,s){var r=0;return function(T,S,R,Q,P){function O(x,w){return{x:w.x+x.x,y:w.y+x.y,w:w.w,h:w.h}}function N(x,w){return{x:w.x-x.x,y:w.y-x.y,w:w.w,h:w.h}}function M(){return N(R,T)}function L(U,D,C,B){var A,z,y,x,w;A=D.x,z=D.y,y=D.w,x=D.h,A+=C*U.deltaX,z+=B*U.deltaY,y+=C*U.deltaW,x+=B*U.deltaH,20>y&&(y=20),20>x&&(x=20),w=T=v.clamp({x:A,y:z,w:y,h:x},R,"move"==U.name),w=N(R,w),b.fire("updateRect",{rect:w}),e(w)}function J(){function w(x){var y;return new h(E,{document:Q.ownerDocument,handle:E+"-"+x.name,start:function(){y=T},drag:function(z){L(x,y,z.deltaX,z.deltaY)}})}q('<div id="'+E+'" class="'+G+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(Q),u.each(I,function(x){q("#"+E,Q).append('<div id="'+E+"-"+x+'"class="'+G+'croprect-block" style="display: none" data-mce-bogus="all">')}),u.each(a,function(x){q("#"+E,Q).append('<div id="'+E+"-"+x.name+'" class="'+G+"croprect-handle "+G+"croprect-handle-"+x.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+x.label+'" aria-grabbed="false">')}),K=u.map(a,w),F(T),q(Q).on("focusin focusout",function(x){q(x.target).attr("aria-grabbed","focus"===x.type)}),q(Q).on("keydown",function(y){function x(B,A,U,D,C){B.stopPropagation(),B.preventDefault(),L(z,U,D,C)}var z;switch(u.each(a,function(A){return y.target.id==E+"-"+A.name?(z=A,!1):void 0}),y.keyCode){case s.LEFT:x(y,z,T,-10,0);break;case s.RIGHT:x(y,z,T,10,0);break;case s.UP:x(y,z,T,0,-10);break;case s.DOWN:x(y,z,T,0,10);break;case s.ENTER:case s.SPACEBAR:y.preventDefault(),P()}})}function H(w){var x;x=u.map(a,function(y){return"#"+E+"-"+y.name}).concat(u.map(I,function(y){return"#"+E+"-"+y})).join(","),w?q(x,Q).show():q(x,Q).hide()}function F(w){function x(y,z){z.h<0&&(z.h=0),z.w<0&&(z.w=0),q("#"+E+"-"+y,Q).css({left:z.x,top:z.y,width:z.w,height:z.h})}u.each(a,function(y){q("#"+E+"-"+y.name,Q).css({left:w.w*y.xMul+w.x,top:w.h*y.yMul+w.y})}),x("top",{x:S.x,y:S.y,w:S.w,h:w.y-S.y}),x("right",{x:w.x+w.w,y:w.y,w:S.w-w.x-w.w+S.x,h:w.h}),x("bottom",{x:S.x,y:w.y+w.h,w:S.w,h:S.h-w.y-w.h+S.y}),x("left",{x:S.x,y:w.y,w:w.x-S.x,h:w.h}),x("move",w)}function g(w){T=w,F(T)}function f(w){S=w,F(T)}function e(w){g(O(R,w))}function d(w){R=w,F(T)}function c(){u.each(K,function(w){w.destroy()}),K=[]}var b,a,K,I,G="mce-",E=G+"crid-"+r++;return a=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],I=["top","right","bottom","left"],J(Q),b=u.extend({toggleVisibility:H,setClampRect:d,setRect:g,getInnerRect:M,setInnerRect:e,setViewPortRect:f,destroy:c},t)}}),l("j",["s","t","u","5","3","v"],function(q,h,v,u,t,s){function r(b){return new t(function(a){function d(){b.removeEventListener("load",d),a(b)}b.complete?a(b):b.addEventListener("load",d)})}return q.extend({Defaults:{classes:"imagepanel"},selection:function(b){return arguments.length?(this.state.set("rect",b),this):this.state.get("rect")},imageSize:function(){var b=this.state.get("viewRect");return{w:b.w,h:b.h}},toggleCropRect:function(b){this.state.set("cropEnabled",b)},imageSrc:function(e){var c=this,f=new Image;f.src=e,r(f).then(function(){var b,g,d=c.state.get("viewRect");g=c.$el.find("img"),g[0]?g.replaceWith(f):c.getEl().appendChild(f),b={x:0,y:0,w:f.naturalWidth,h:f.naturalHeight},c.state.set("viewRect",b),c.state.set("rect",v.inflate(b,-20,-20)),d&&d.w==b.w&&d.h==b.h||c.zoomFit(),c.repaintImage(),c.fire("load")})},zoom:function(b){return arguments.length?(this.state.set("zoom",b),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var x,w,D,C,B,A,z,y=this;z=10,x=y.$el.find("img"),w=y.getEl().clientWidth,D=y.getEl().clientHeight,C=x[0].naturalWidth,B=x[0].naturalHeight,A=Math.min((w-z)/C,(D-z)/B),A>=1&&(A=1),y.zoom(A)},repaintImage:function(){var F,E,D,C,B,A,z,y,x,w;w=this.getEl(),y=this.zoom(),x=this.state.get("rect"),z=this.$el.find("img"),B=w.offsetWidth,A=w.offsetHeight,D=z[0].naturalWidth*y,C=z[0].naturalHeight*y,F=Math.max(0,B/2-D/2),E=Math.max(0,A/2-C/2),z.css({left:F,top:E,width:D,height:C}),this.cropRect&&(this.cropRect.setRect({x:x.x*y+F,y:x.y*y+E,w:x.w*y,h:x.h*y}),this.cropRect.setClampRect({x:F,y:E,w:D,h:C}),this.cropRect.setViewPortRect({x:0,y:0,w:B,h:A}))},bindStates:function(){function d(b){c.cropRect=new s(b,c.state.get("viewRect"),c.state.get("viewRect"),c.getEl(),function(){c.fire("crop")}),c.cropRect.on("updateRect",function(e){var g=e.rect,f=c.zoom();g={x:Math.round(g.x/f),y:Math.round(g.y/f),w:Math.round(g.w/f),h:Math.round(g.h/f)},c.state.set("rect",g)}),c.on("remove",c.cropRect.destroy)}var c=this;c.state.on("change:cropEnabled",function(b){c.cropRect.toggleVisibility(b.value),c.repaintImage()}),c.state.on("change:zoom",function(){c.repaintImage()}),c.state.on("change:rect",function(b){var a=b.value;c.cropRect||d(a),c.cropRect.setRect(a)})}})}),l("k",[],function(){return function(){function q(d){var c;return c=s.splice(++r),s.push(d),{state:d,removed:c}}function h(){return u()?s[--r]:void 0}function v(){return t()?s[++r]:void 0}function u(){return r>0}function t(){return -1!=r&&r<s.length-1}var s=[],r=-1;return{data:s,add:q,undo:h,redo:v,canUndo:u,canRedo:t}}}),l("9",["f","5","3","g","h","i","j","7","8","k"],function(E,D,C,B,A,z,y,x,w,v){function u(b){return{blob:b,url:URL.createObjectURL(b)}}function t(b){b&&URL.revokeObjectURL(b.url)}function s(b){D.each(b,t)}function r(aU,aT,aS){function aR(G){var F,J,I,H;F=al.find("#w")[0],J=al.find("#h")[0],I=parseInt(F.value(),10),H=parseInt(J.value(),10),al.find("#constrain")[0].checked()&&aA&&b&&I&&H&&("w"==G.control.settings.name?(H=Math.round(I*aF),J.value(H)):(I=Math.round(H*aB),F.value(I))),aA=I,b=H}function aQ(c){return Math.round(100*c)+"%"}function aP(){al.find("#undo").disabled(!e.canUndo()),al.find("#redo").disabled(!e.canRedo()),al.statusbar.find("#save").disabled(!e.canUndo())}function aO(){al.find("#undo").disabled(!0),al.find("#redo").disabled(!0)}function aN(c){c&&ae.imageSrc(c.url)}function aM(c){return function(){var F=D.grep(aE,function(G){return G.settings.name!=c});D.each(F,function(G){G.hide()}),c.show(),c.focus()}}function aL(c){ai=u(c),aN(ai)}function aK(c){aU=u(c),aN(aU),s(e.add(aU).removed),aP()}function aJ(){var c=ae.selection();x.crop(aU.blob,c.x,c.y,c.w,c.h).then(function(F){aK(F),aG()})}function aI(F){var c=[].slice.call(arguments,1);return function(){var G=ai||aU;F.apply(this,[G.blob].concat(c)).then(aL)}}function aH(F){var c=[].slice.call(arguments,1);return function(){F.apply(this,[aU.blob].concat(c)).then(aK)}}function aG(){aN(aU),t(ai),aM(ak)(),aP()}function ax(){ai&&(aK(ai.blob),aG())}function aw(){var c=ae.zoom();2>c&&(c+=0.1),ae.zoom(c)}function av(){var c=ae.zoom();c>0.1&&(c-=0.1),ae.zoom(c)}function au(){aU=e.undo(),aN(aU),aP()}function at(){aU=e.redo(),aN(aU),aP()}function ar(){aT(aU.blob),al.close()}function aq(c){return new A({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:c})}function ap(F,c){return aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",function(){aO(),c(aU.blob).then(function(H){var G=u(H);aN(G),t(ai),ai=G})})}function ao(F,c,J,I,H){function G(K){c(aU.blob,K).then(function(M){var L=u(M);aN(L),t(ai),ai=L})}return aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(K){G(K.value)},minValue:I,maxValue:H,value:J,previewFilter:aQ},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",function(){this.find("slider").value(J),aO()})}function an(F,c){function G(){var H,J,I;H=al.find("#r")[0].value(),J=al.find("#g")[0].value(),I=al.find("#b")[0].value(),c(aU.blob,H,J,I).then(function(L){var K=u(L);aN(K),t(ai),ai=K})}return aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aQ},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aQ},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aQ},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",function(){al.find("#r,#g,#b").value(1),aO()})}function am(c){c.control.value()===!0&&(aF=b/aA,aB=aA/b)}var al,ak,aj,ai,ah,ag,af,ae,ad,ac,ab,h,g,f,d,aC,aW,ay,aV,aD,az,a,aE,aA,b,aF,aB,e=new v;ah=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aJ}]).hide().on("show hide",function(c){ae.toggleCropRect("show"==c.type)}).on("show",aO),ag=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:aR},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:aR},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:am},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(G){var F=parseInt(al.find("#w").value(),10),H=parseInt(al.find("#h").value(),10);G.preventDefault(),aH(x.resize,F,H)(),aG()}).on("show",aO),af=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:aI(x.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:aI(x.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:aI(x.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:aI(x.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:ax}]).hide().on("show",aO),ab=ap("Invert",x.invert),aV=ap("Sharpen",x.sharpen),aD=ap("Emboss",x.emboss),h=ao("Brightness",x.brightness,0,-1,1),g=ao("Hue",x.hue,180,0,360),f=ao("Saturate",x.saturate,0,-1,1),d=ao("Contrast",x.contrast,0,-1,1),aC=ao("Grayscale",x.grayscale,0,0,1),aW=ao("Sepia",x.sepia,0,0,1),ay=an("Colorize",x.colorize),az=ao("Gamma",x.gamma,0,-1,1),a=ao("Exposure",x.exposure,1,0,2),aj=aq([{text:"Back",onclick:aG},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:aM(g)},{text:"saturate",icon:"saturate",onclick:aM(f)},{text:"sepia",icon:"sepia",onclick:aM(aW)},{text:"emboss",icon:"emboss",onclick:aM(aD)},{text:"exposure",icon:"exposure",onclick:aM(a)},{type:"spacer",flex:1}]).hide(),ak=aq([{tooltip:"Crop",icon:"crop",onclick:aM(ah)},{tooltip:"Resize",icon:"resize2",onclick:aM(ag)},{tooltip:"Orientation",icon:"orientation",onclick:aM(af)},{tooltip:"Brightness",icon:"sun",onclick:aM(h)},{tooltip:"Sharpen",icon:"sharpen",onclick:aM(aV)},{tooltip:"Contrast",icon:"contrast",onclick:aM(d)},{tooltip:"Color levels",icon:"drop",onclick:aM(ay)},{tooltip:"Gamma",icon:"gamma",onclick:aM(az)},{tooltip:"Invert",icon:"invert",onclick:aM(ab)}]),ae=new y({flex:1,imageSrc:aU.url}),ad=new z({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:au},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:at},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:aw},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:av}]}),ac=new z({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[ad,ae]}),aE=[ak,ah,ag,af,aj,ab,h,g,f,d,aC,aW,ay,aV,aD,az,a],al=B.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(E.DOM.getViewPort().w,800),minHeight:Math.min(E.DOM.getViewPort().h,650),title:"Edit image",items:aE.concat([ac]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:ar},{text:"Cancel",onclick:"close"}]}),al.renderTo(document.body).reflow(),al.on("close",function(){aS(),s(e.data),e=null,ai=null}),e.add(aU),aP(),ae.on("load",function(){aA=ae.imageSize().w,b=ae.imageSize().h,aF=b/aA,aB=aA/b,al.find("#w").value(aA),al.find("#h").value(b)}),ae.on("crop",aJ)}function q(b){return new C(function(a,d){r(u(b),a,d)})}return{edit:q}}),l("a",[],function(){function e(h){function g(b){return/^[0-9\.]+px$/.test(b)}var r,q;return r=h.style.width,q=h.style.height,r||q?g(r)&&g(q)?{w:parseInt(r,10),h:parseInt(q,10)}:null:(r=h.width,q=h.height,r&&q?{w:parseInt(r,10),h:parseInt(q,10)}:null)}function d(h,g){var r,q;g&&(r=h.style.width,q=h.style.height,(r||q)&&(h.style.width=g.w+"px",h.style.height=g.h+"px",h.removeAttribute("data-mce-style")),r=h.width,q=h.height,(r||q)&&(h.setAttribute("width",g.w),h.setAttribute("height",g.h)))}function f(b){return{w:b.naturalWidth,h:b.naturalHeight}}return{getImageSize:e,setImageSize:d,getNaturalImageSize:f}}),l("l",["3","5"],function(q,h){var v=function(b){return null!==b&&void 0!==b},u=function(e,c){var f;return f=c.reduce(function(g,d){return v(g)?g[d]:void 0},e),v(f)?f:null},t=function(b,a){return new q(function(c){var d;d=new XMLHttpRequest,d.onreadystatechange=function(){4===d.readyState&&c({status:d.status,blob:this.response})},d.open("GET",b,!0),h.each(a,function(f,e){d.setRequestHeader(e,f)}),d.responseType="blob",d.send()})},s=function(a){return new q(function(b){var d=new FileReader;d.onload=function(e){var f=e.target;b(f.result)},d.readAsText(a)})},r=function(e){var d;try{d=JSON.parse(e)}catch(f){}return d};return{traverse:u,readBlob:s,requestUrlAsBlob:t,parseJson:r}}),l("b",["3","5","l"],function(A,z,y){function x(a){return y.requestUrlAsBlob(a,{}).then(function(c){return c.status>=400?v(c.status):A.resolve(c.blob)})}var w=function(b){return 400===b||403===b||500===b},v=function(a){return A.reject("ImageProxy HTTP error: "+a)},u=function(a){A.reject("ImageProxy Service error: "+a)},t=function(d,c){return y.readBlob(c).then(function(f){var e=y.parseJson(f),g=y.traverse(e,["error","type"]);return u(g?g:"Invalid JSON")})},s=function(d,c){return w(d)?t(d,c):v(d)},r=function(a,c){return y.requestUrlAsBlob(a,{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":c}).then(function(d){return d.status>=400?s(d.status,d.blob):A.resolve(d.blob)})},q=function(d,c){return c?r(d,c):x(d)};return{getUrl:q}}),l("0",["1","2","3","4","5","6","7","8","9","a","b"],function(B,A,z,y,x,w,v,u,t,s,r){var q=function(W){function V(a){W.notificationManager.open({text:a,type:"error"})}function U(){return W.selection.getNode()}function T(){return"imagetools"+f++}function S(a){var C=a.src;return 0===C.indexOf("data:")||0===C.indexOf("blob:")||new y(C).host===W.documentBaseURI.host}function R(a){return -1!==x.inArray(W.settings.imagetools_cors_hosts,new y(a.src).host)}function P(){return W.settings.api_key||W.settings.imagetools_api_key}function N(a){var D,C=a.src;return R(a)?r.getUrl(a.src,null):S(a)?u.imageToBlob(a):(C=W.settings.imagetools_proxy,C+=(-1===C.indexOf("?")?"?":"&")+"url="+encodeURIComponent(a.src),D=P(),r.getUrl(C,D))}function L(){var a;return a=W.editorUpload.blobCache.getByUri(U().src),a?a.blob():N(U())}function J(){I=w.setEditorTimeout(W,function(){W.editorUpload.uploadImagesAuto()},30000)}function H(){clearTimeout(I)}function g(a,C){return u.blobToDataUri(a).then(function(Y){var X,G,F,E,D;return D=U(),X=T(),F=W.editorUpload.blobCache,G=y.parseDataUri(Y).data,E=F.create(X,a,G),F.add(E),W.undoManager.transact(function(){function Z(){W.$(D).off("load",Z),W.nodeChanged(),C?W.editorUpload.uploadImagesAuto():(H(),J())}W.$(D).on("load",Z),W.$(D).attr({src:E.blobUri()}).removeAttr("data-mce-src")}),E})}function e(a){return function(){return W._scanForImages().then(L).then(a).then(g,V)}}function d(C){return function(){return e(function(a){var D=s.getImageSize(U());return D&&s.setImageSize(U(),{w:D.h,h:D.w}),v.rotate(a,C)})()}}function c(C){return function(){return e(function(a){return v.flip(a,C)})()}}function b(){var D=U(),C=s.getNaturalImageSize(D),F=function(a){return new z(function(G){u.blobToImage(a).then(function(Y){var X=s.getNaturalImageSize(Y);C.w==X.w&&C.h==X.h||s.getImageSize(D)&&s.setImageSize(D,X),URL.revokeObjectURL(Y.src),G(a)})})},E=function(G){return t.edit(G).then(F).then(function(X){g(X,!0)},function(){})};D&&N(D).then(E,V)}function Q(){W.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:d(-90)}),W.addButton("rotateright",{title:"Rotate clockwise",onclick:d(90)}),W.addButton("flipv",{title:"Flip vertically",onclick:c("v")}),W.addButton("fliph",{title:"Flip horizontally",onclick:c("h")}),W.addButton("editimage",{title:"Edit image",onclick:b}),W.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function O(){W.on("NodeChange",function(a){h&&h.src!=a.element.src&&(H(),W.editorUpload.uploadImagesAuto(),h=void 0),M(a.element)&&(h=a.element)})}function M(a){var C=W.dom.is(a,"img:not([data-mce-object],[data-mce-placeholder])");return C&&(S(a)||R(a)||W.settings.imagetools_proxy)}function K(){var a=W.settings.imagetools_toolbar;a||(a="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),W.addContextToolbar(M,a)}var I,h,f=0;A.fileApi&&(Q(),K(),O(),W.addCommand("mceEditImage",b))};return B.add("imagetools",q),function(){}}),o("0")()}();