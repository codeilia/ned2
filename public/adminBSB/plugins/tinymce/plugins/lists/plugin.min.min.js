tinymce.PluginManager.add("lists",function(o){var j=this;function k(a){return o.$.contains(o.getBody(),a)}function m(a){return a&&a.nodeName=="BR"}function r(a){return a&&(/^(OL|UL|DL)$/).test(a.nodeName)&&k(a)}function p(a){return a.parentNode.firstChild==a}function q(a){return a.parentNode.lastChild==a}function l(a){return a&&!!o.schema.getTextBlockElements()[a.nodeName]}function n(a){return a===o.getBody()}o.on("init",function(){var c=o.dom,i=o.selection;function g(s,t){var u=c.isEmpty(s);if(t&&c.select("span[data-mce-type=bookmark]").length>0){return false}return u}function J(u){var t={};function s(v){var x,y,w;y=u[v?"startContainer":"endContainer"];w=u[v?"startOffset":"endOffset"];if(y.nodeType==1){x=c.create("span",{"data-mce-type":"bookmark"});if(y.hasChildNodes()){w=Math.min(w,y.childNodes.length-1);if(v){y.insertBefore(x,y.childNodes[w])}else{c.insertAfter(x,y.childNodes[w])}}else{y.appendChild(x)}y=x;w=0}t[v?"startContainer":"endContainer"]=y;t[v?"startOffset":"endOffset"]=w}s(true);if(!u.collapsed){s()}return t}function N(t){function s(v){var z,x,y;function w(B){var A=B.parentNode.firstChild,C=0;while(A){if(A==B){return C}if(A.nodeType!=1||A.getAttribute("data-mce-type")!="bookmark"){C++}A=A.nextSibling}return -1}z=y=t[v?"startContainer":"endContainer"];x=t[v?"startOffset":"endOffset"];if(!z){return}if(z.nodeType==1){x=w(z);z=z.parentNode;c.remove(y)}t[v?"startContainer":"endContainer"]=z;t[v?"startOffset":"endOffset"]=x}s(true);s();var u=c.createRng();u.setStart(t.startContainer,t.startOffset);if(t.endContainer){u.setEnd(t.endContainer,t.endOffset)}i.setRng(u)}function P(z,v){var t,y,w=c.createFragment(),x;var u=o.schema.getBlockElements();if(o.settings.forced_root_block){v=v||o.settings.forced_root_block}if(v){y=c.create(v);if(y.tagName===o.settings.forced_root_block){c.setAttribs(y,o.settings.forced_root_block_attrs)}w.appendChild(y)}if(z){while((t=z.firstChild)){var s=t.nodeName;if(!x&&(s!="SPAN"||t.getAttribute("data-mce-type")!="bookmark")){x=true}if(u[s]){w.appendChild(t);y=null}else{if(v){if(!y){y=c.create(v);w.appendChild(y)}y.appendChild(t)}else{w.appendChild(t)}}}}if(!o.settings.forced_root_block){w.appendChild(c.create("br"))}else{if(!x&&(!tinymce.Env.ie||tinymce.Env.ie>10)){y.appendChild(c.create("br",{"data-mce-bogus":"1"}))}}return w}function G(){return tinymce.grep(i.getSelectedBlocks(),function(s){return/^(LI|DT|DD)$/.test(s.nodeName)})}function d(w,z,s){var x,y,v,u;function t(A){tinymce.each(v,function(B){A.parentNode.insertBefore(B,z.parentNode)});c.remove(A)}v=c.select('span[data-mce-type="bookmark"]',w);s=s||P(z);x=c.createRng();x.setStartAfter(z);x.setEndAfter(w);y=x.extractContents();for(u=y.firstChild;u;u=u.firstChild){if(u.nodeName=="LI"&&c.isEmpty(u)){c.remove(u);break}}if(!c.isEmpty(y)){c.insertAfter(y,w)}c.insertAfter(s,w);if(g(z.parentNode)){t(z.parentNode)}c.remove(z);if(g(w)){c.remove(w)}}var e=function(v,s){var u=o.dom.getStyle(v,"list-style-type",true);var t=o.dom.getStyle(s,"list-style-type",true);return u===t};function E(u){var t,s;t=u.nextSibling;if(t&&r(t)&&t.nodeName==u.nodeName&&e(u,t)){while((s=t.firstChild)){u.appendChild(s)}c.remove(t)}t=u.previousSibling;if(t&&r(t)&&t.nodeName==u.nodeName&&e(u,t)){while((s=t.firstChild)){u.insertBefore(s,u.firstChild)}c.remove(t)}}function M(s){tinymce.each(tinymce.grep(c.select("ol,ul",s)),function(u){var t,v=u.parentNode;if(v.nodeName=="LI"&&v.firstChild==u){t=v.previousSibling;if(t&&t.nodeName=="LI"){t.appendChild(u);if(g(v)){c.remove(v)}}}if(r(v)){t=v.previousSibling;if(t&&t.nodeName=="LI"){t.appendChild(u)}}})}function h(v){var u=v.parentNode,w=u.parentNode,s;function t(x){if(g(x)){c.remove(x)}}if(n(u)){return true}if(v.nodeName=="DD"){c.rename(v,"DT");return true}if(p(v)&&q(v)){if(w.nodeName=="LI"){c.insertAfter(v,w);t(w);c.remove(u)}else{if(r(w)){c.remove(u,true)}else{w.insertBefore(P(v),u);c.remove(u)}}return true}else{if(p(v)){if(w.nodeName=="LI"){c.insertAfter(v,w);v.appendChild(u);t(w)}else{if(r(w)){w.insertBefore(v,u)}else{w.insertBefore(P(v),u);c.remove(v)}}return true}else{if(q(v)){if(w.nodeName=="LI"){c.insertAfter(v,w)}else{if(r(w)){c.insertAfter(v,u)}else{c.insertAfter(P(v),u);c.remove(v)}}return true}}}if(w.nodeName=="LI"){u=w;s=P(v,"LI")}else{if(r(w)){s=P(v,"LI")}else{s=P(v)}}d(u,v,s);M(u.parentNode);return true}function F(w){var u,v,s;function t(x,y){var z;if(r(x)){while((z=w.lastChild.firstChild)){y.appendChild(z)}c.remove(x)}}if(w.nodeName=="DT"){c.rename(w,"DD");return true}u=w.previousSibling;if(u&&r(u)){u.appendChild(w);return true}if(u&&u.nodeName=="LI"&&r(u.lastChild)){u.lastChild.appendChild(w);t(w.lastChild,u.lastChild);return true}u=w.nextSibling;if(u&&r(u)){u.insertBefore(w,u.firstChild);return true}u=w.previousSibling;if(u&&u.nodeName=="LI"){v=c.create(w.parentNode.nodeName);s=c.getStyle(w.parentNode,"listStyleType");if(s){c.setStyle(v,"listStyleType",s)}u.appendChild(v);v.appendChild(w);t(w.lastChild,v);return true}return false}function f(){var t=G();if(t.length){var s=J(i.getRng(true));for(var u=0;u<t.length;u++){if(!F(t[u])&&u===0){break}}N(s);o.nodeChanged();return true}}function K(){var v=G();if(v.length){var u=J(i.getRng(true));var w,s,x=o.getBody();w=v.length;while(w--){var t=v[w].parentNode;while(t&&t!=x){s=v.length;while(s--){if(v[s]===t){v.splice(w,1);break}}t=t.parentNode}}for(w=0;w<v.length;w++){if(!h(v[w])&&w===0){break}}N(u);o.nodeChanged();return true}}function b(v,s){var w=i.getRng(true),t,u="LI";if(c.getContentEditable(i.getNode())==="false"){return}v=v.toUpperCase();if(v=="DL"){u="DT"}function x(){var C=[],y=o.getBody();function S(Q){var V,R;V=w[Q?"startContainer":"endContainer"];R=w[Q?"startOffset":"endOffset"];if(V.nodeType==1){V=V.childNodes[Math.min(R,V.childNodes.length-1)]||V}while(V.parentNode!=y){if(l(V)){return V}if(/^(TD|TH)$/.test(V.parentNode.nodeName)){return V}V=V.parentNode}return V}var T=S(true);var z=S();var A,B=[];for(var D=T;D;D=D.nextSibling){B.push(D);if(D==z){break}}tinymce.each(B,function(R){if(l(R)){C.push(R);A=null;return}if(c.isBlock(R)||m(R)){if(m(R)){c.remove(R)}A=null;return}var Q=R.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(R)){if(l(Q)||(!Q&&R.parentNode==y)){A=null;return}}if(!A){A=c.create("p");R.parentNode.insertBefore(A,R);C.push(A)}A.appendChild(R)});return C}t=J(w);tinymce.each(x(),function(A){var y,B;var z=function(R){var D=c.getStyle(R,"list-style-type");var C=s?s["list-style-type"]:"";C=C===null?"":C;return D===C};B=A.previousSibling;if(B&&r(B)&&B.nodeName==v&&z(B)){y=B;A=c.rename(A,u);B.appendChild(A)}else{y=c.create(v);A.parentNode.insertBefore(y,A);y.appendChild(A);A=c.rename(A,u)}H(y,s);E(y)});N(t)}var H=function(s,t){c.setStyle(s,"list-style-type",t?t["list-style-type"]:null)};function a(){var s=J(i.getRng(true)),t=o.getBody();tinymce.each(G(),function(w){var u,v;if(n(w.parentNode)){return}if(g(w)){h(w);return}for(u=w;u&&u!=t;u=u.parentNode){if(r(u)){v=u}}d(v,w)});N(s)}function L(u,s){var v=c.getParent(i.getStart(),"OL,UL,DL");if(n(v)){return}if(v){if(v.nodeName==u){a(u)}else{var t=J(i.getRng(true));H(v,s);E(c.rename(v,u));N(t)}}else{b(u,s)}}function O(s){return function(){var t=c.getParent(o.selection.getStart(),"UL,OL,DL");return t&&t.nodeName==s}}function I(s){if(!m(s)){return false}if(c.isBlock(s.nextSibling)&&!m(s.previousSibling)){return true}return false}j.backspaceDelete=function(u){function t(S,C){var D=S.startContainer,A=S.startOffset;var T,B;if(D.nodeType==3&&(C?A<D.data.length:A>0)){return D}T=o.schema.getNonEmptyElements();if(D.nodeType==1){D=tinymce.dom.RangeUtils.getNode(D,A)}B=new tinymce.dom.TreeWalker(D,o.getBody());if(C){if(I(D)){B.next()}}while((D=B[C?"next":"prev2"]())){if(D.nodeName=="LI"&&!D.hasChildNodes()){return D}if(T[D.nodeName]){return D}if(D.nodeType==3&&D.data.length>0){return D}}}function s(D,A){var B,C,R=D.parentNode;if(!k(D)||!k(A)){return}if(r(A.lastChild)){C=A.lastChild}if(R==A.lastChild){if(m(R.previousSibling)){c.remove(R.previousSibling)}}B=A.lastChild;if(B&&m(B)&&D.hasChildNodes()){c.remove(B)}if(g(A,true)){c.$(A).empty()}if(!g(D,true)){while((B=D.firstChild)){A.appendChild(B)}}if(C){A.appendChild(C)}c.remove(D);if(g(R)&&!n(R)){c.remove(R)}}if(i.isCollapsed()){var z=c.getParent(i.getStart(),"LI"),w,x,y;if(z){w=z.parentNode;if(n(w)&&c.isEmpty(w)){return true}x=i.getRng(true);y=c.getParent(t(x,u),"LI");if(y&&y!=z){var v=J(x);if(u){s(y,z)}else{s(z,y)}N(v);return true}else{if(!y){if(!u&&a(w.nodeName)){return true}}}}}};o.on("BeforeExecCommand",function(s){var t=s.command.toLowerCase(),u;if(t=="indent"){if(f()){u=true}}else{if(t=="outdent"){if(K()){u=true}}}if(u){o.fire("ExecCommand",{command:s.command});s.preventDefault();return true}});o.addCommand("InsertUnorderedList",function(s,t){L("UL",t)});o.addCommand("InsertOrderedList",function(s,t){L("OL",t)});o.addCommand("InsertDefinitionList",function(s,t){L("DL",t)});o.addQueryStateHandler("InsertUnorderedList",O("UL"));o.addQueryStateHandler("InsertOrderedList",O("OL"));o.addQueryStateHandler("InsertDefinitionList",O("DL"));o.on("keydown",function(s){if(s.keyCode!=9||tinymce.util.VK.metaKeyPressed(s)){return}if(o.dom.getParent(o.selection.getStart(),"LI,DT,DD")){s.preventDefault();if(s.shiftKey){K()}else{f()}}})});o.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var a=this;o.on("nodechange",function(){var d=o.selection.getSelectedBlocks();var f=false;for(var e=0,b=d.length;!f&&e<b;e++){var c=d[e].nodeName;f=(c=="LI"&&p(d[e])||c=="UL"||c=="OL"||c=="DD")}a.disabled(f)})}});o.on("keydown",function(a){if(a.keyCode==tinymce.util.VK.BACKSPACE){if(j.backspaceDelete()){a.preventDefault()}}else{if(a.keyCode==tinymce.util.VK.DELETE){if(j.backspaceDelete(true)){a.preventDefault()}}}})});