(function(b,g){var d={};function c(m,n){var l,j=[];for(var k=0;k<m.length;++k){l=d[m[k]]||e(m[k]);if(!l){throw"module definition dependecy not found: "+m[k]}j.push(l)}n.apply(null,j)}function h(k,j,i){if(typeof k!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(j===g){throw"invalid module definition, dependencies must be specified"}if(i===g){throw"invalid module definition, definition function must be specified"}c(j,function(){d[k]=i.apply(null,arguments)})}function f(i){return !!d[i]}function e(l){var j=b;var i=l.split(/[.\/]/);for(var k=0;k<i.length;++k){if(!j[i[k]]){return}j=j[i[k]]}return j}function a(l){var k,n,p,j,m;for(k=0;k<l.length;k++){n=b;p=l[k];j=p.split(/[.\/]/);for(var o=0;o<j.length-1;++o){if(n[j[o]]===g){n[j[o]]={}}n=n[j[o]]}n[j[j.length-1]]=d[p]}if(b.AMDLC_TESTS){m=b.privateModules||{};for(p in d){m[p]=d[p]}for(k=0;k<l.length;k++){delete m[l[k]]}b.privateModules=m}}h("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){function i(j){return j&&j.nodeType==1&&j.contentEditable==="false"}return function(D,o){var C,l=[],t,H=o.dom;var z,u,F;z=o.schema.getBlockElements();u=o.schema.getWhiteSpaceElements();F=o.schema.getShortEndedElements();function G(L,M){if(!L[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}return{start:L.index,end:L.index+L[0].length,text:L[0],data:M}}function j(L){var m;if(L.nodeType===3){return L.data}if(u[L.nodeName]&&!z[L.nodeName]){return""}if(i(L)){return"\n"}m="";if(z[L.nodeName]||F[L.nodeName]){m+="\n"}if((L=L.firstChild)){do{m+=j(L)}while((L=L.nextSibling))}return m}function I(N,P,T){var L,S,Q,M,U=[],R=0,O=N,m,V=0;P=P.slice(0);P.sort(function(X,W){return X.start-W.start});m=P.shift();out:while(true){if(z[O.nodeName]||F[O.nodeName]||i(O)){R++}if(O.nodeType===3){if(!S&&O.length+R>=m.end){S=O;M=m.end-R}else{if(L){U.push(O)}}if(!L&&O.length+R>m.start){L=O;Q=m.start-R}R+=O.length}if(L&&S){O=T({startNode:L,startNodeIndex:Q,endNode:S,endNodeIndex:M,innerNodes:U,match:m.text,matchIndex:V});R-=(S.length-M);L=null;S=null;U=[];m=P.shift();V++;if(!m){break}}else{if((!u[O.nodeName]||z[O.nodeName])&&O.firstChild){if(!i(O)){O=O.firstChild;continue}}else{if(O.nextSibling){O=O.nextSibling;continue}}}while(true){if(O.nextSibling){O=O.nextSibling;break}else{if(O.parentNode!==N){O=O.parentNode}else{break out}}}}}function w(L){function m(O,M){var N=l[M];if(!N.stencil){N.stencil=L(N)}var P=N.stencil.cloneNode(false);P.setAttribute("data-mce-index",M);if(O){P.appendChild(H.doc.createTextNode(O))}return P}return function(S){var Z,M,T,O=S.startNode,V=S.endNode,aa=S.matchIndex,ab=H.doc;if(O===V){var P=O;T=P.parentNode;if(S.startNodeIndex>0){Z=ab.createTextNode(P.data.substring(0,S.startNodeIndex));T.insertBefore(Z,P)}var N=m(S.match,aa);T.insertBefore(N,P);if(S.endNodeIndex<P.length){M=ab.createTextNode(P.data.substring(S.endNodeIndex));T.insertBefore(M,P)}P.parentNode.removeChild(P);return N}Z=ab.createTextNode(O.data.substring(0,S.startNodeIndex));M=ab.createTextNode(V.data.substring(S.endNodeIndex));var X=m(O.data.substring(S.startNodeIndex),aa);var W=[];for(var R=0,Q=S.innerNodes.length;R<Q;++R){var ac=S.innerNodes[R];var Y=m(ac.data,aa);ac.parentNode.replaceChild(Y,ac);W.push(Y)}var U=m(V.data.substring(0,S.endNodeIndex),aa);T=O.parentNode;T.insertBefore(Z,O);T.insertBefore(X,O);T.removeChild(O);T=V.parentNode;T.insertBefore(U,V);T.insertBefore(M,V);T.removeChild(V);return U}}function p(L){var m=L.parentNode;m.insertBefore(L.firstChild,L);L.parentNode.removeChild(L)}function E(m){var P=D.getElementsByTagName("*"),O=[];m=typeof m=="number"?""+m:null;for(var N=0;N<P.length;N++){var M=P[N],L=M.getAttribute("data-mce-index");if(L!==null&&L.length){if(L===m||m===null){O.push(M)}}}return O}function k(m){var L=l.length;while(L--){if(l[L]===m){return L}}return -1}function s(L){var m=[];n(function(M,N){if(L(M,N)){m.push(M)}});l=m;return this}function n(M){for(var L=0,m=l.length;L<m;L++){if(M(l[L],L)===false){break}}return this}function r(m){if(l.length){I(D,l,w(m))}return this}function y(m,L){if(t&&m.global){while((C=m.exec(t))){l.push(G(C,L))}}return this}function B(m){var L,M=E(m?k(m):null);L=M.length;while(L--){p(M[L])}return this}function A(m){return l[m.getAttribute("data-mce-index")]}function v(m){return E(k(m))[0]}function x(M,m,L){l.push({start:M,end:M+m,text:t.substr(M,m),data:L});return this}function q(L){var M=E(k(L));var m=o.dom.createRng();m.setStartBefore(M[0]);m.setEndAfter(M[M.length-1]);return m}function J(L,M){var m=q(L);m.deleteContents();if(M.length>0){m.insertNode(o.dom.doc.createTextNode(M))}return m}function K(){l.splice(0,l.length);B();return this}t=j(D);return{text:t,matches:l,each:n,filter:s,reset:K,matchFromElement:A,elementFromMatch:v,find:y,add:x,wrap:r,unwrap:B,replace:J,rangeFromMatch:q,indexOf:k}}});h("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(p,k,j,m,n,l,i,o){k.add("spellchecker",function(r,u){var z,A=this,Q,q,H,M=r.settings;var N;function P(){if(!A.textMatcher){A.textMatcher=new p(r.getBody(),r)}return A.textMatcher}function I(T,R){var S=[];j.each(R,function(U){S.push({selectable:true,text:U.name,data:U.value})});return S}var J=M.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";z=I("Language",j.map(J.split(","),function(R){R=R.split("=");return{name:R[0],value:R[1]}}));function y(S){for(var R in S){return false}return true}function s(W,U){var T=[],R=Q[W];j.each(R,function(Y){T.push({text:Y,onclick:function(){r.insertContent(r.dom.encode(Y));r.dom.remove(U);K()}})});T.push({text:"-"});if(N){T.push({text:"Add to Dictionary",onclick:function(){v(W,U)}})}T.push.apply(T,[{text:"Ignore",onclick:function(){C(W,U)}},{text:"Ignore all",onclick:function(){C(W,U,true)}}]);H=new m({items:T,context:"contextmenu",onautohide:function(Y){if(Y.target.className.indexOf("spellchecker")!=-1){Y.preventDefault()}},onhide:function(){H.remove();H=null}});H.renderTo(document.body);var X=n.DOM.getPos(r.getContentAreaContainer());var V=r.dom.getPos(U[0]);var S=r.dom.getRoot();if(S.nodeName=="BODY"){V.x-=S.ownerDocument.documentElement.scrollLeft||S.scrollLeft;V.y-=S.ownerDocument.documentElement.scrollTop||S.scrollTop}else{V.x-=S.scrollLeft;V.y-=S.scrollTop}X.x+=V.x;X.y+=V.y;H.moveTo(X.x,X.y+U[0].offsetHeight)}function G(){return r.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\u00a7\u00a9\u00ab\u00ae\u00b1\u00b6\u00b7\u00b8\u00bb\u00bc\u00bd\u00be\u00bf\u00d7\u00f7\u00a4\u201d\u201c\u201e\u00a0\u2002\u2003\u2009]+',"g")}function t(W,V,S,T){var U={method:W,lang:M.spellchecker_language},R="";U[W=="addToDictionary"?"word":"text"]=V;j.each(U,function(Y,X){if(R){R+="&"}R+=X+"="+encodeURIComponent(Y)});l.send({url:new i(u).toAbsolute(M.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:R,success:function(X){X=o.parse(X);if(!X){var Y=r.translate("Server response wasn't proper JSON.");T(Y)}else{if(X.error){T(X.error)}else{S(X)}}},error:function(){var X=r.translate("The spelling service was not found: (")+M.spellchecker_rpc_url+r.translate(")");T(X)}})}function L(U,V,R,T){var S=M.spellchecker_callback||t;S.call(A,U,V,R,T)}function O(){if(F()){return}function R(S){r.notificationManager.open({text:S,type:"error"});r.setProgressState(false);F()}r.setProgressState(true);L("spellcheck",P().text,B,R);r.focus()}function K(){if(!r.dom.select("span.mce-spellchecker-word").length){F()}}function v(S,R){r.setProgressState(true);L("addToDictionary",S,function(){r.setProgressState(false);r.dom.remove(R,true);K()},function(T){r.notificationManager.open({text:T,type:"error"});r.setProgressState(false)})}function C(T,R,S){r.selection.collapse();if(S){j.each(r.dom.select("span.mce-spellchecker-word"),function(U){if(U.getAttribute("data-mce-word")==T){r.dom.remove(U,true)}})}else{r.dom.remove(R,true)}K()}function F(){P().reset();A.textMatcher=null;if(q){q=false;r.fire("SpellcheckEnd");return true}}function x(S){var R=S.getAttribute("data-mce-index");if(typeof R=="number"){return""+R}return R}function w(S){var R,U=[];R=j.toArray(r.getBody().getElementsByTagName("span"));if(R.length){for(var T=0;T<R.length;T++){var V=x(R[T]);if(V===null||!V.length){continue}if(V===S.toString()){U.push(R[T])}}}return U}r.on("click",function(U){var T=U.target;if(T.className=="mce-spellchecker-word"){U.preventDefault();var S=w(x(T));if(S.length>0){var R=r.dom.createRng();R.setStartBefore(S[0]);R.setEndAfter(S[S.length-1]);r.selection.setRng(R);s(T.getAttribute("data-mce-word"),S)}}});r.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:O,selectable:true,onPostRender:function(){var R=this;R.active(q);r.on("SpellcheckStart SpellcheckEnd",function(){R.active(q)})}});function E(S){var R=M.spellchecker_language;S.control.items().each(function(T){T.active(T.settings.data===R)})}function B(T){var R;if(T.words){N=!!T.dictionary;R=T.words}else{R=T}r.setProgressState(false);if(y(R)){var S=r.translate("No misspellings found.");r.notificationManager.open({text:S,type:"info"});q=false;return}Q=R;P().find(G()).filter(function(U){return !!R[U.text]}).wrap(function(U){return r.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":U.text})});q=true;r.fire("SpellcheckStart")}var D={tooltip:"Spellcheck",onclick:O,onPostRender:function(){var R=this;r.on("SpellcheckStart SpellcheckEnd",function(){R.active(q)})}};if(z.length>1){D.type="splitbutton";D.menu=z;D.onshow=E;D.onselect=function(R){M.spellchecker_language=R.control.settings.data}}r.addButton("spellchecker",D);r.addCommand("mceSpellCheck",O);r.on("remove",function(){if(H){H.remove();H=null}});r.on("change",K);this.getTextMatcher=P;this.getWordCharPattern=G;this.markErrors=B;this.getLanguage=function(){return M.spellchecker_language};M.spellchecker_language=M.spellchecker_language||M.language||"en"})});a(["tinymce/spellcheckerplugin/DomTextMatcher"])})(this);