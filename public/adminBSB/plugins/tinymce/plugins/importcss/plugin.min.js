tinymce.PluginManager.add("importcss",function(f){var c=this,g=tinymce.each;function e(j){var i=tinymce.Env.cacheSuffix;if(typeof j=="string"){j=j.replace("?"+i,"").replace("&"+i,"")}return j}function b(j){var k=f.settings,l=k.skin!==false?k.skin||"lightgray":false;if(l){var i=k.skin_url;if(i){i=f.documentBaseURI.toAbsolute(i)}else{i=tinymce.baseURL+"/skins/"+l}return j===i+"/content"+(f.inline?".inline":"")+".min.css"}return false}function d(i){if(typeof i=="string"){return function(j){return j.indexOf(i)!==-1}}else{if(i instanceof RegExp){return function(j){return i.test(j)}}}return i}function a(n,l){var k=[],j={};function i(s,r){var o=s.href,q;o=e(o);if(!o||!l(o,r)||b(o)){return}g(s.imports,function(t){i(t,true)});try{q=s.cssRules||s.rules}catch(p){}g(q,function(t){if(t.styleSheet){i(t.styleSheet,true)}else{if(t.selectorText){g(t.selectorText.split(","),function(u){k.push(tinymce.trim(u))})}}})}g(f.contentCSS,function(o){j[o]=true});if(!l){l=function(o,p){return p||j[o]}}try{g(n.styleSheets,function(o){i(o)})}catch(m){}return k}function h(m){var n;var j=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(m);if(!j){return}var i=j[1];var k=j[2].substr(1).split(".").join(" ");var l=tinymce.makeMap("a,img");if(j[1]){n={title:m};if(f.schema.getTextBlockElements()[i]){n.block=i}else{if(f.schema.getBlockElements()[i]||l[i.toLowerCase()]){n.selector=i}else{n.inline=i}}}else{if(j[2]){n={inline:"span",title:m.substr(1),classes:k}}}if(f.settings.importcss_merge_classes!==false){n.classes=k}else{n.attributes={"class":k}}return n}f.on("renderFormatsMenu",function(o){var l=f.settings,k={};var j=l.importcss_selector_converter||h;var n=d(l.importcss_selector_filter),m=o.control;if(!f.settings.importcss_append){m.items().remove()}var i=[];tinymce.each(l.importcss_groups,function(p){p=tinymce.extend({},p);p.filter=d(p.filter);i.push(p)});g(a(o.doc||f.getDoc(),d(l.importcss_file_filter)),function(p){if(p.indexOf(".mce-")===-1){if(!k[p]&&(!n||n(p))){var t=j.call(c,p),u;if(t){var s=t.name||tinymce.DOM.uniqueId();if(i){for(var q=0;q<i.length;q++){if(!i[q].filter||i[q].filter(p)){if(!i[q].item){i[q].item={text:i[q].title,menu:[]}}u=i[q].item.menu;break}}}f.formatter.register(s,t);var r=tinymce.extend({},m.settings.itemDefaults,{text:t.title,format:s});if(u){u.push(r)}else{m.add(r)}}k[p]=true}}});g(i,function(p){m.add(p.item)});o.control.renderNew()});c.convertSelectorToFormat=h});