tinymce.PluginManager.add("media",function(g,c){var p=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:true},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:true},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:true},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:false},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:true}];var m=(tinymce.Env.ie&&tinymce.Env.ie<=8)?"onChange":"onInput";function a(q){q=q.toLowerCase();if(q.indexOf(".mp3")!=-1){return"audio/mpeg"}if(q.indexOf(".wav")!=-1){return"audio/wav"}if(q.indexOf(".mp4")!=-1){return"video/mp4"}if(q.indexOf(".webm")!=-1){return"video/webm"}if(q.indexOf(".ogg")!=-1){return"video/ogg"}if(q.indexOf(".swf")!=-1){return"application/x-shockwave-flash"}return""}function l(s){var r=g.settings.media_scripts;if(r){for(var q=0;q<r.length;q++){if(s.indexOf(r[q].filter)!==-1){return r[q]}}}}function k(){var x,v,r,w;var u=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:true,label:"Source",onchange:function(y){tinymce.each(y.meta,function(A,z){x.find("#"+z).value(A)})}}];function s(C){var z,B,A,y;z=x.find("#width")[0];B=x.find("#height")[0];A=z.value();y=B.value();if(x.find("#constrain")[0].checked()&&v&&r&&A&&y){if(C.control==z){y=Math.round((A/v)*y);if(!isNaN(y)){B.value(y)}}else{A=Math.round((y/r)*A);if(!isNaN(A)){z.value(A)}}}v=A;r=y}if(g.settings.media_alt_source!==false){u.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"})}if(g.settings.media_poster!==false){u.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"})}if(g.settings.media_dimensions!==false){u.push({type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:s,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:s,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:true,text:"Constrain proportions"}]})}w=f(g.selection.getNode());v=w.width;r=w.height;var q={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:h(),multiline:true,label:"Source"};function t(){w=o(this.value());this.parent().parent().fromJSON(w)}q[m]=t;x=g.windowManager.open({title:"Insert/edit video",data:w,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){w=o(this.next().find("#embed").value());this.fromJSON(w)},items:u},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(j(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},q]}],onSubmit:function(){var B,z,A,C;B=g.dom.select("img[data-mce-object]");g.insertContent(j(this.toJSON()));z=g.dom.select("img[data-mce-object]");for(A=0;A<B.length;A++){for(C=z.length-1;C>=0;C--){if(B[A]==z[C]){z.splice(C,1)}}}g.selection.select(z[0]);g.nodeChanged()}})}function h(){var q=g.selection.getNode();if(q.getAttribute("data-mce-object")){return g.selection.getContent()}}function j(t){var s="";if(!t.source1){tinymce.extend(t,o(t.embed));if(!t.source1){return""}}if(!t.source2){t.source2=""}if(!t.poster){t.poster=""}t.source1=g.convertURL(t.source1,"source");t.source2=g.convertURL(t.source2,"source");t.source1mime=a(t.source1);t.source2mime=a(t.source2);t.poster=g.convertURL(t.poster,"poster");t.flashPlayerUrl=g.convertURL(c+"/moxieplayer.swf","movie");tinymce.each(p,function(x){var v,w,u;if((v=x.regex.exec(t.source1))){u=x.url;for(w=0;v[w];w++){u=u.replace("$"+w,function(){return v[w]})}t.source1=u;t.type=x.type;t.allowFullscreen=x.allowFullscreen;t.width=t.width||x.w;t.height=t.height||x.h}});if(t.embed){s=i(t.embed,t,true)}else{var r=l(t.source1);if(r){t.type="script";t.width=r.width;t.height=r.height}t.width=t.width||300;t.height=t.height||150;tinymce.each(t,function(v,u){t[u]=g.dom.encode(v)});if(t.type=="iframe"){var q=t.allowFullscreen?' allowFullscreen="1"':"";s+='<iframe src="'+t.source1+'" width="'+t.width+'" height="'+t.height+'"'+q+"></iframe>"}else{if(t.source1mime=="application/x-shockwave-flash"){s+='<object data="'+t.source1+'" width="'+t.width+'" height="'+t.height+'" type="application/x-shockwave-flash">';if(t.poster){s+='<img src="'+t.poster+'" width="'+t.width+'" height="'+t.height+'" />'}s+="</object>"}else{if(t.source1mime.indexOf("audio")!=-1){if(g.settings.audio_template_callback){s=g.settings.audio_template_callback(t)}else{s+=('<audio controls="controls" src="'+t.source1+'">'+(t.source2?'\n<source src="'+t.source2+'"'+(t.source2mime?' type="'+t.source2mime+'"':"")+" />\n":"")+"</audio>")}}else{if(t.type=="script"){s+='<script src="'+t.source1+'"><\/script>'}else{if(g.settings.video_template_callback){s=g.settings.video_template_callback(t)}else{s=('<video width="'+t.width+'" height="'+t.height+'"'+(t.poster?' poster="'+t.poster+'"':"")+' controls="controls">\n<source src="'+t.source1+'"'+(t.source1mime?' type="'+t.source1mime+'"':"")+" />\n"+(t.source2?'<source src="'+t.source2+'"'+(t.source2mime?' type="'+t.source2mime+'"':"")+" />\n":"")+"</video>")}}}}}}return s}function o(q){var r={};new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:"script,noscript",start:function(t,s){if(!r.source1&&t=="param"){r.source1=s.map.movie}if(t=="iframe"||t=="object"||t=="embed"||t=="video"||t=="audio"){if(!r.type){r.type=t}r=tinymce.extend(s.map,r)}if(t=="script"){var u=l(s.map.src);if(!u){return}r={type:"script",source1:s.map.src,width:u.width,height:u.height}}if(t=="source"){if(!r.source1){r.source1=s.map.src}else{if(!r.source2){r.source2=s.map.src}}}if(t=="img"&&!r.poster){r.poster=s.map.src}}}).parse(q);r.source1=r.source1||r.src||r.data;r.source2=r.source2||"";r.poster=r.poster||"";return r}function f(q){if(q.getAttribute("data-mce-object")){return o(g.serializer.serialize(q,{selection:true}))}return{}}function d(r){if(g.settings.media_filter_html===false){return r}var s=new tinymce.html.Writer(),q;new tinymce.html.SaxParser({validate:false,allow_conditional_comments:false,special:"script,noscript",comment:function(t){s.comment(t)},cdata:function(t){s.cdata(t)},text:function(u,t){s.text(u,t)},start:function(u,t,w){q=true;if(u=="script"||u=="noscript"){return}for(var v=0;v<t.length;v++){if(t[v].name.indexOf("on")===0){return}if(t[v].name=="style"){t[v].value=g.dom.serializeStyle(g.dom.parseStyle(t[v].value),u)}}s.start(u,t,w);q=false},end:function(t){if(q){return}s.end(t)}},new tinymce.html.Schema({})).parse(r);return s.getContent()}function i(s,v,w){var u=new tinymce.html.Writer();var r=0,t;function q(z,C){var y,A,B,x;for(y in C){B=""+C[y];if(z.map[y]){A=z.length;while(A--){x=z[A];if(x.name==y){if(B){z.map[y]=B;x.value=B}else{delete z.map[y];z.splice(A,1)}}}}else{if(B){z.push({name:y,value:B});z.map[y]=B}}}}new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:"script,noscript",comment:function(x){u.comment(x)},cdata:function(x){u.cdata(x)},text:function(y,x){u.text(y,x)},start:function(y,x,z){switch(y){case"video":case"object":case"embed":case"img":case"iframe":q(x,{width:v.width,height:v.height});break}if(w){switch(y){case"video":q(x,{poster:v.poster,src:""});if(v.source2){q(x,{src:""})}break;case"iframe":q(x,{src:v.source1});break;case"source":r++;if(r<=2){q(x,{src:v["source"+r],type:v["source"+r+"mime"]});if(!v["source"+r]){return}}break;case"img":if(!v.poster){return}t=true;break}}u.start(y,x,z)},end:function(A){if(A=="video"&&w){for(var z=1;z<=2;z++){if(v["source"+z]){var y=[];y.map={};if(r<z){q(y,{src:v["source"+z],type:v["source"+z+"mime"]});u.start("source",y,true)}}}}if(v.poster&&A=="object"&&w&&!t){var x=[];x.map={};q(x,{src:v.poster,width:v.width,height:v.height});u.start("img",x,true)}u.end(A)}},new tinymce.html.Schema({})).parse(s);return u.getContent()}g.on("ResolveName",function(r){var q;if(r.target.nodeType==1&&(q=r.target.getAttribute("data-mce-object"))){r.name=q}});function n(t,v){var s,u,w,q,r;w=t.attributes;q=w.length;while(q--){s=w[q].name;u=w[q].value;if(s!=="width"&&s!=="height"&&s!=="style"){if(s=="data"||s=="src"){u=g.convertURL(u,s)}v.attr("data-mce-p-"+s,u)}}r=t.firstChild&&t.firstChild.value;if(r){v.attr("data-mce-html",escape(r));v.firstChild=null}}function e(s){var r,q=s.name;r=new tinymce.html.Node("img",1);r.shortEnded=true;n(s,r);r.attr({width:s.attr("width")||"300",height:s.attr("height")||(q=="audio"?"30":"150"),style:s.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":q,"class":"mce-object mce-object-"+q});return r}function b(u){var t,r,q,s=u.name;t=new tinymce.html.Node("span",1);t.attr({contentEditable:"false",style:u.attr("style"),"data-mce-object":s,"class":"mce-preview-object mce-object-"+s});n(u,t);r=new tinymce.html.Node(s,1);r.attr({src:u.attr("src"),allowfullscreen:u.attr("allowfullscreen"),width:u.attr("width")||"300",height:u.attr("height")||(s=="audio"?"30":"150"),frameborder:"0"});q=new tinymce.html.Node("span",1);q.attr("class","mce-shim");t.append(r);t.append(q);return t}g.on("preInit",function(){var q=g.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(s){q[s]=new RegExp("</"+s+"[^>]*>","gi")});var r=g.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(s){r[s]={}});g.parser.addNodeFilter("iframe,video,audio,object,embed,script",function(s){var u=s.length,w,v,t;while(u--){w=s[u];if(!w.parent){continue}if(w.parent.attr("data-mce-object")){continue}if(w.name=="script"){t=l(w.attr("src"));if(!t){continue}}if(t){if(t.width){w.attr("width",t.width.toString())}if(t.height){w.attr("height",t.height.toString())}}if(w.name=="iframe"&&g.settings.media_live_embeds!==false&&tinymce.Env.ceFalse){v=b(w)}else{v=e(w)}w.replace(v)}});g.serializer.addAttributeFilter("data-mce-object",function(u,t){var x=u.length,w,C,A,s,v,D,B,y;while(x--){w=u[x];if(!w.parent){continue}B=w.attr(t);C=new tinymce.html.Node(B,1);if(B!="audio"&&B!="script"){y=w.attr("class");if(y&&y.indexOf("mce-preview-object")!==-1){C.attr({width:w.firstChild.attr("width"),height:w.firstChild.attr("height")})}else{C.attr({width:w.attr("width"),height:w.attr("height")})}}C.attr({style:w.attr("style")});s=w.attributes;A=s.length;while(A--){var z=s[A].name;if(z.indexOf("data-mce-p-")===0){C.attr(z.substr(11),s[A].value)}}if(B=="script"){C.attr("type","text/javascript")}v=w.attr("data-mce-html");if(v){D=new tinymce.html.Node("#text",3);D.raw=true;D.value=d(unescape(v));C.append(D)}w.replace(C)}})});g.on("click keyup",function(){var q=g.selection.getNode();if(q&&g.dom.hasClass(q,"mce-preview-object")){if(g.dom.getAttrib(q,"data-mce-selected")){q.setAttribute("data-mce-selected","2")}}});g.on("ObjectSelected",function(r){var q=r.target.getAttribute("data-mce-object");if(q=="audio"||q=="script"){r.preventDefault()}});g.on("objectResized",function(s){var r=s.target,q;if(r.getAttribute("data-mce-object")){q=r.getAttribute("data-mce-html");if(q){q=unescape(q);r.setAttribute("data-mce-html",escape(i(q,{width:s.width,height:s.height})))}}});g.addButton("media",{tooltip:"Insert/edit video",onclick:k,stateSelector:["img[data-mce-object]","span[data-mce-object]"]});g.addMenuItem("media",{icon:"media",text:"Insert/edit video",onclick:k,context:"insert",prependToContext:true});g.on("setContent",function(){g.$("span.mce-preview-object").each(function(r,s){var q=g.$(s);if(q.find("span.mce-shim",s).length===0){q.append('<span class="mce-shim"></span>')}})});g.addCommand("mceMedia",k);this.showDialog=k});