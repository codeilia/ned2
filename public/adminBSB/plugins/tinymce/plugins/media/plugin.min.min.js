tinymce.PluginManager.add("media",function(z,D){var q=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:true},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:true},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:true},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:false},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:true}];var t=(tinymce.Env.ie&&tinymce.Env.ie<=8)?"onChange":"onInput";function F(a){a=a.toLowerCase();if(a.indexOf(".mp3")!=-1){return"audio/mpeg"}if(a.indexOf(".wav")!=-1){return"audio/wav"}if(a.indexOf(".mp4")!=-1){return"video/mp4"}if(a.indexOf(".webm")!=-1){return"video/webm"}if(a.indexOf(".ogg")!=-1){return"video/ogg"}if(a.indexOf(".swf")!=-1){return"application/x-shockwave-flash"}return""}function u(a){var b=z.settings.media_scripts;if(b){for(var c=0;c<b.length;c++){if(a.indexOf(b[c].filter)!==-1){return b[c]}}}}function v(){var a,c,g,b;var d=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:true,label:"Source",onchange:function(i){tinymce.each(i.meta,function(j,k){a.find("#"+k).value(j)})}}];function f(k){var j,m,i,l;j=a.find("#width")[0];m=a.find("#height")[0];i=j.value();l=m.value();if(a.find("#constrain")[0].checked()&&c&&g&&i&&l){if(k.control==j){l=Math.round((i/c)*l);if(!isNaN(l)){m.value(l)}}else{i=Math.round((l/g)*i);if(!isNaN(i)){j.value(i)}}}c=i;g=l}if(z.settings.media_alt_source!==false){d.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"})}if(z.settings.media_poster!==false){d.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"})}if(z.settings.media_dimensions!==false){d.push({type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:f,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:f,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:true,text:"Constrain proportions"}]})}b=A(z.selection.getNode());c=b.width;g=b.height;var h={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:y(),multiline:true,label:"Source"};function e(){b=r(this.value());this.parent().parent().fromJSON(b)}h[t]=e;a=z.windowManager.open({title:"Insert/edit video",data:b,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){b=r(this.next().find("#embed").value());this.fromJSON(b)},items:d},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(w(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},h]}],onSubmit:function(){var l,k,i,j;l=z.dom.select("img[data-mce-object]");z.insertContent(w(this.toJSON()));k=z.dom.select("img[data-mce-object]");for(i=0;i<l.length;i++){for(j=k.length-1;j>=0;j--){if(l[i]==k[j]){k.splice(j,1)}}}z.selection.select(k[0]);z.nodeChanged()}})}function y(){var a=z.selection.getNode();if(a.getAttribute("data-mce-object")){return z.selection.getContent()}}function w(a){var b="";if(!a.source1){tinymce.extend(a,r(a.embed));if(!a.source1){return""}}if(!a.source2){a.source2=""}if(!a.poster){a.poster=""}a.source1=z.convertURL(a.source1,"source");a.source2=z.convertURL(a.source2,"source");a.source1mime=F(a.source1);a.source2mime=F(a.source2);a.poster=z.convertURL(a.poster,"poster");a.flashPlayerUrl=z.convertURL(D+"/moxieplayer.swf","movie");tinymce.each(q,function(e){var g,f,h;if((g=e.regex.exec(a.source1))){h=e.url;for(f=0;g[f];f++){h=h.replace("$"+f,function(){return g[f]})}a.source1=h;a.type=e.type;a.allowFullscreen=e.allowFullscreen;a.width=a.width||e.w;a.height=a.height||e.h}});if(a.embed){b=x(a.embed,a,true)}else{var c=u(a.source1);if(c){a.type="script";a.width=c.width;a.height=c.height}a.width=a.width||300;a.height=a.height||150;tinymce.each(a,function(e,f){a[f]=z.dom.encode(e)});if(a.type=="iframe"){var d=a.allowFullscreen?' allowFullscreen="1"':"";b+='<iframe src="'+a.source1+'" width="'+a.width+'" height="'+a.height+'"'+d+"></iframe>"}else{if(a.source1mime=="application/x-shockwave-flash"){b+='<object data="'+a.source1+'" width="'+a.width+'" height="'+a.height+'" type="application/x-shockwave-flash">';if(a.poster){b+='<img src="'+a.poster+'" width="'+a.width+'" height="'+a.height+'" />'}b+="</object>"}else{if(a.source1mime.indexOf("audio")!=-1){if(z.settings.audio_template_callback){b=z.settings.audio_template_callback(a)}else{b+=('<audio controls="controls" src="'+a.source1+'">'+(a.source2?'\n<source src="'+a.source2+'"'+(a.source2mime?' type="'+a.source2mime+'"':"")+" />\n":"")+"</audio>")}}else{if(a.type=="script"){b+='<script src="'+a.source1+'"><\/script>'}else{if(z.settings.video_template_callback){b=z.settings.video_template_callback(a)}else{b=('<video width="'+a.width+'" height="'+a.height+'"'+(a.poster?' poster="'+a.poster+'"':"")+' controls="controls">\n<source src="'+a.source1+'"'+(a.source1mime?' type="'+a.source1mime+'"':"")+" />\n"+(a.source2?'<source src="'+a.source2+'"'+(a.source2mime?' type="'+a.source2mime+'"':"")+" />\n":"")+"</video>")}}}}}}return b}function r(b){var a={};new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:"script,noscript",start:function(d,e){if(!a.source1&&d=="param"){a.source1=e.map.movie}if(d=="iframe"||d=="object"||d=="embed"||d=="video"||d=="audio"){if(!a.type){a.type=d}a=tinymce.extend(e.map,a)}if(d=="script"){var c=u(e.map.src);if(!c){return}a={type:"script",source1:e.map.src,width:c.width,height:c.height}}if(d=="source"){if(!a.source1){a.source1=e.map.src}else{if(!a.source2){a.source2=e.map.src}}}if(d=="img"&&!a.poster){a.poster=e.map.src}}}).parse(b);a.source1=a.source1||a.src||a.data;a.source2=a.source2||"";a.poster=a.poster||"";return a}function A(a){if(a.getAttribute("data-mce-object")){return r(z.serializer.serialize(a,{selection:true}))}return{}}function C(b){if(z.settings.media_filter_html===false){return b}var a=new tinymce.html.Writer(),c;new tinymce.html.SaxParser({validate:false,allow_conditional_comments:false,special:"script,noscript",comment:function(d){a.comment(d)},cdata:function(d){a.cdata(d)},text:function(d,e){a.text(d,e)},start:function(f,g,d){c=true;if(f=="script"||f=="noscript"){return}for(var e=0;e<g.length;e++){if(g[e].name.indexOf("on")===0){return}if(g[e].name=="style"){g[e].value=z.dom.serializeStyle(z.dom.parseStyle(g[e].value),f)}}a.start(f,g,d);c=false},end:function(d){if(c){return}a.end(d)}},new tinymce.html.Schema({})).parse(b);return a.getContent()}function x(e,b,a){var c=new tinymce.html.Writer();var f=0,d;function g(k,j){var m,i,l,h;for(m in j){l=""+j[m];if(k.map[m]){i=k.length;while(i--){h=k[i];if(h.name==m){if(l){k.map[m]=l;h.value=l}else{delete k.map[m];k.splice(i,1)}}}}else{if(l){k.push({name:m,value:l});k.map[m]=l}}}}new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:"script,noscript",comment:function(h){c.comment(h)},cdata:function(h){c.cdata(h)},text:function(i,h){c.text(i,h)},start:function(j,h,i){switch(j){case"video":case"object":case"embed":case"img":case"iframe":g(h,{width:b.width,height:b.height});break}if(a){switch(j){case"video":g(h,{poster:b.poster,src:""});if(b.source2){g(h,{src:""})}break;case"iframe":g(h,{src:b.source1});break;case"source":f++;if(f<=2){g(h,{src:b["source"+f],type:b["source"+f+"mime"]});if(!b["source"+f]){return}}break;case"img":if(!b.poster){return}d=true;break}}c.start(j,h,i)},end:function(i){if(i=="video"&&a){for(var j=1;j<=2;j++){if(b["source"+j]){var k=[];k.map={};if(f<j){g(k,{src:b["source"+j],type:b["source"+j+"mime"]});c.start("source",k,true)}}}}if(b.poster&&i=="object"&&a&&!d){var h=[];h.map={};g(h,{src:b.poster,width:b.width,height:b.height});c.start("img",h,true)}c.end(i)}},new tinymce.html.Schema({})).parse(e);return c.getContent()}z.on("ResolveName",function(a){var b;if(a.target.nodeType==1&&(b=a.target.getAttribute("data-mce-object"))){a.name=b}});function s(d,b){var e,c,a,g,f;a=d.attributes;g=a.length;while(g--){e=a[g].name;c=a[g].value;if(e!=="width"&&e!=="height"&&e!=="style"){if(e=="data"||e=="src"){c=z.convertURL(c,e)}b.attr("data-mce-p-"+e,c)}}f=d.firstChild&&d.firstChild.value;if(f){b.attr("data-mce-html",escape(f));b.firstChild=null}}function B(a){var b,c=a.name;b=new tinymce.html.Node("img",1);b.shortEnded=true;s(a,b);b.attr({width:a.attr("width")||"300",height:a.attr("height")||(c=="audio"?"30":"150"),style:a.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":c,"class":"mce-object mce-object-"+c});return b}function E(a){var b,d,e,c=a.name;b=new tinymce.html.Node("span",1);b.attr({contentEditable:"false",style:a.attr("style"),"data-mce-object":c,"class":"mce-preview-object mce-object-"+c});s(a,b);d=new tinymce.html.Node(c,1);d.attr({src:a.attr("src"),allowfullscreen:a.attr("allowfullscreen"),width:a.attr("width")||"300",height:a.attr("height")||(c=="audio"?"30":"150"),frameborder:"0"});e=new tinymce.html.Node("span",1);e.attr("class","mce-shim");b.append(d);b.append(e);return b}z.on("preInit",function(){var b=z.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(c){b[c]=new RegExp("</"+c+"[^>]*>","gi")});var a=z.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(c){a[c]={}});z.parser.addNodeFilter("iframe,video,audio,object,embed,script",function(g){var e=g.length,c,d,f;while(e--){c=g[e];if(!c.parent){continue}if(c.parent.attr("data-mce-object")){continue}if(c.name=="script"){f=u(c.attr("src"));if(!f){continue}}if(f){if(f.width){c.attr("width",f.width.toString())}if(f.height){c.attr("height",f.height.toString())}}if(c.name=="iframe"&&z.settings.media_live_embeds!==false&&tinymce.Env.ceFalse){d=E(c)}else{d=B(c)}c.replace(d)}});z.serializer.addAttributeFilter("data-mce-object",function(l,m){var i=l.length,j,d,f,n,k,c,e,h;while(i--){j=l[i];if(!j.parent){continue}e=j.attr(m);d=new tinymce.html.Node(e,1);if(e!="audio"&&e!="script"){h=j.attr("class");if(h&&h.indexOf("mce-preview-object")!==-1){d.attr({width:j.firstChild.attr("width"),height:j.firstChild.attr("height")})}else{d.attr({width:j.attr("width"),height:j.attr("height")})}}d.attr({style:j.attr("style")});n=j.attributes;f=n.length;while(f--){var g=n[f].name;if(g.indexOf("data-mce-p-")===0){d.attr(g.substr(11),n[f].value)}}if(e=="script"){d.attr("type","text/javascript")}k=j.attr("data-mce-html");if(k){c=new tinymce.html.Node("#text",3);c.raw=true;c.value=C(unescape(k));d.append(c)}j.replace(d)}})});z.on("click keyup",function(){var a=z.selection.getNode();if(a&&z.dom.hasClass(a,"mce-preview-object")){if(z.dom.getAttrib(a,"data-mce-selected")){a.setAttribute("data-mce-selected","2")}}});z.on("ObjectSelected",function(a){var b=a.target.getAttribute("data-mce-object");if(b=="audio"||b=="script"){a.preventDefault()}});z.on("objectResized",function(a){var b=a.target,c;if(b.getAttribute("data-mce-object")){c=b.getAttribute("data-mce-html");if(c){c=unescape(c);b.setAttribute("data-mce-html",escape(x(c,{width:a.width,height:a.height})))}}});z.addButton("media",{tooltip:"Insert/edit video",onclick:v,stateSelector:["img[data-mce-object]","span[data-mce-object]"]});z.addMenuItem("media",{icon:"media",text:"Insert/edit video",onclick:v,context:"insert",prependToContext:true});z.on("setContent",function(){z.$("span.mce-preview-object").each(function(b,a){var c=z.$(a);if(c.find("span.mce-shim",a).length===0){c.append('<span class="mce-shim"></span>')}})});z.addCommand("mceMedia",v);this.showDialog=v});