tinymce._beforeUnloadHandler=function(){var b;tinymce.each(tinymce.editors,function(a){if(a.plugins.autosave){a.plugins.autosave.storeDraft()}if(!b&&a.isDirty()&&a.getParam("autosave_ask_before_unload",true)){b=a.translate("You have unsaved changes are you sure you want to navigate away?")}});return b};tinymce.PluginManager.add("autosave",function(s){var y=s.settings,r=tinymce.util.LocalStorage,u,p;u=y.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-";u=u.replace(/\{path\}/g,document.location.pathname);u=u.replace(/\{query\}/g,document.location.search);u=u.replace(/\{id\}/g,s.id);function B(a,c){var b={s:1000,m:60000};a=/^(\d+)([ms]?)$/.exec(""+(a||c));return(a[2]?b[a[2]]:1)*parseInt(a,10)}function z(){var a=parseInt(r.getItem(u+"time"),10)||0;if(new Date().getTime()-a>y.autosave_retention){o(false);return false}return true}function o(a){r.removeItem(u+"draft");r.removeItem(u+"time");if(a!==false){s.fire("RemoveDraft")}}function A(){if(!v()&&s.isDirty()){r.setItem(u+"draft",s.getContent({format:"raw",no_events:true}));r.setItem(u+"time",new Date().getTime());s.fire("StoreDraft")}}function q(){if(z()){s.setContent(r.getItem(u+"draft"),{format:"raw"});s.fire("RestoreDraft")}}function w(){if(!p){setInterval(function(){if(!s.removed){A()}},y.autosave_interval);p=true}}y.autosave_interval=B(y.autosave_interval,"30s");y.autosave_retention=B(y.autosave_retention,"20m");function t(){var a=this;a.disabled(!z());s.on("StoreDraft RestoreDraft RemoveDraft",function(){a.disabled(!z())});w()}function x(){s.undoManager.beforeChange();q();o();s.undoManager.add()}s.addButton("restoredraft",{title:"Restore last draft",onclick:x,onPostRender:t});s.addMenuItem("restoredraft",{text:"Restore last draft",onclick:x,onPostRender:t,context:"file"});function v(a){var b=s.settings.forced_root_block;a=tinymce.trim(typeof a=="undefined"?s.getBody().innerHTML:a);return a===""||new RegExp("^<"+b+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+b+">|<br>$","i").test(a)}if(s.settings.autosave_restore_when_empty!==false){s.on("init",function(){if(z()&&v()){q()}});s.on("saveContent",function(){o()})}window.onbeforeunload=tinymce._beforeUnloadHandler;this.hasDraft=z;this.storeDraft=A;this.restoreDraft=q;this.removeDraft=o;this.isEmpty=v});